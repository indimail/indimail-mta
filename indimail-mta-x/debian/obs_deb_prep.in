#!/bin/sh
set -e
#
# Unpacker for OpenSUSE build service
#
libdkim_version=@libdkim_version@
libsrs2_version=@libsrs2_version@
ucspitcp_version=@ucspitcp_version@
version=@version@
for i in indimail-mta-"$version" ucspi-tcp-"$ucspitcp_version" libdkim-"$libdkim_version" libsrs2-"$libsrs2_version"
do
	if [ -d $i ] ; then
		/bin/rm -rf $i
	elif [ -d indimail-mta-x ] ; then
		/bin/rm -rf indimail-mta-x
	fi
	if [ -f ../SOURCES/$i.tar.gz ] ; then
		echo "extracting $i.tar.gz"
		gunzip -c ../SOURCES/$i.tar.gz |tar xf -
	elif [ -f ../SOURCES/$i.tar.xz ] ; then
		echo "extracting $i.tar.xz"
		xz -d -c ../SOURCES/$i.tar.xz|tar xf -
	elif [ -f ../SOURCES/$i.tar.bz2 ] ; then
		echo "extracting $i.tar.bz2"
		bzip2 -d -c ../SOURCES/$i.tar.bz2|tar xf -
	else
		echo "no source archive for $i"
		exit 1
	fi
	if [ -f ../SOURCES/$i.patch.gz ] ; then
		echo "applying patch for $i"
		gunzip -c ../SOURCES/$i.patch.gz | patch -p0 > /dev/null
		continue
	fi
done
if [ -d libdkim-${libdkim_version} ] ; then
	ln -s libdkim-${libdkim_version} libdkim-x
fi
if [ -d libsrs2-${libsrs2_version} ] ; then
	ln -s libsrs2-${libsrs2_version} libsrs2-x
fi
if [ -d ucspi-tcp-${ucspitcp_version} ] ; then
	ln -s ucspi-tcp-${ucspitcp_version} ucspi-tcp-x
fi
exit 0
