.\" vim: tw=75
.TH filterit 1

.SH "NAME"
filterit \- Filter incoming mails based on email headers

.SH "SYNOPSIS"
in
.BR .qmail\fIext :
.B | filterit [ -n ] [ -r ]
-h \fIheader\fR -k \fIkeyword\fR -c \fIcomparision\fR
  -a \fIaction\fR -A \fIaction_val\fR
  -d \fIdefault_action\fR -D \fIdefault_action_val\fR
  [ -b bounce_message ]

.SH "DESCRIPTION"
\fBfilterit\fR is a filter that can be used in \fBdot-qmail\fR(5). It can
be used to deliver mail to a Maildir folder, forward mail to an address or
simple exit with some status when it matches a user-defined criteria
specified on the command line. \fBfilterit\fR can be used to decide if you
want to deliver, deliver to a specific folder, forward to any email
address, drop or bounce the message.

\fBfilterit\fR uses \fBmaildirdeliver\fR(1) to deliver mail to a Maildir
and \fBforward\fR(1) to forward mail to an email address.

When delivering to a Maildir, \fBfilterit\fR expects \fBHOME\fR environment
variable to be present. If \fBRPLINE\fR environment variable is not
present, it expects \fBSENDER\fR environment variable to set the
\fBRPLINE\fR environment variable for maildirdeliver to set the Return-Path
header. If the \fBDTLINE\fR environment variable is not present, it expects
\fBLOCAL\fR, \fBHOST\fR, environment variables to be present to set the
\fBDTLINE\fR environment variable for maildirdeliver to set the the
Delivered-To header. This is not a problem when being called from a
\fB.qmail\fR file as \fBqmail-local\fR sets these environment variables.
But if called from a script that is not executed by qmail-local,
\fBfilterit\fR will exit 100, if these environment variables are not set.
Also, \fBfilterit\fR will exit 100 if it finds the maildir path has ".." in
it. \fIfilterit\fR will create the Maildir if it does not exist.

When bouncing a message (-a bounce -A 100 or -d bounce -D 100), message
will be bounced with the text
.EX
  "message failed to evade a local filter set by recipient"
.EE
You can use the -m option to change the bounce message;

.SH "OPTIONS"
.TP 3
\fB\-n\fR
Do not take any action. Just display the result of filtering

.TP
\fB\-r\fR
Reverse the match. A match becomes no match. No match becomes match

.TP
\fB\-n\fR \fIheader\fR
Use \fIheader\fR to match all headers in a 822-format message.

.TP
\fB\-k\fR \fIkeyword\fR
Use the string \fIkeyword\fR in \fIheader\fR from a 822-format message. The
criteria for a match depends on the type of comparision used (-c option)

.TP
\fB\-c\fR \fIcomparision\fR
Use \fIcomparision\fR as the criteria for deciding a match. This is a
string with one of the following values:
.TS
l l.
Comparision Type             Criteria for match
_
equals                       match happens when header value = keyword
contains                     match happens when header value contains keyword
starts with                  match happens when header value starts with keyword
ends with                    match happens when header value ends with keyword
numerical logical expression Here %p in keyword gets replaced with header
                             value
regexp                       Match happens when a regular expression in
                             keyword matches the header value
.TE

.TP
\fB\-a\fR \fItype\fR -A \fIaction_value\fR
Action to take when there is a match. This has one of the following values:
.TS
l l.
Action type Description
_
exit        Exit with \fIaction_value\fR
forward     Forward to address \fIaction_value\fR
maildir     Deliver to a Maildir \fIaction_value\fR. This has to start with
            './Maildir/' and end with '/' and must not contain '..'
.TE

.TP
\fB\-d\fR \fItype\fR -D \fIaction_value\fR
default action to take when there is no match. This has one of the following values:
.TS
l l.
Action type Description
_
exit        Exit with \fIaction_value\fR
forward     Forward to address \fIaction_value\fR
maildir     Deliver to a Maildir \fIaction_value\fR. This has to start with
            './Maildir/' and end with '/' and must not contain '..'
.TE

.TP
\fB\-b\fR \fIbounce_message\fR
Set \fIbounce_message\fR as the default bounce message.

.SH "SEE ALSO"
dot-qmail(5),
qmail-local(8),
maildir(5),
maildirdeliver(1),
forward(1),
qmail-qfilter(1)
