#
#
%undefine _missing_build_ids_terminate_build
%global _unpackaged_files_terminate_build 1
%global debug_package %{nil}

%define _prefix            @prefix@
%define mandir             @mandir@
%define sysconfdir         @sysconfdir@

%if %{defined _project}
# define to 1 if building on openSUSE build service
%define build_on_obs       1
%define fast_mode          1
%else
%define build_on_obs       0
%define fast_mode          1
%global _hardened_build    1
%endif

Summary: Watch files for specific patterns
Name: logalert
Version: @VERSION@
%if %build_on_obs == 1
Release: 1.<B_CNT>
%else
Release: 1.B_CCNT%{?dist}
%endif

%if %build_on_obs == 1
License: GPL-3.0+
%else
License: GPLv3
%endif
URL: http://www.indimail.org
Group: Productivity/Networking/Email/Utilities
Source0: http://downloads.sourceforge.net/indimail/%{name}-%{version}.tar.gz
#Source1: http://downloads.sourceforge.net/indimail/%{name}-%{version}-rpmlintrc

%if %{defined suse_version} || %{defined sles_version}
BuildRequires: bison
%endif
BuildRequires: flex  
%if %build_on_obs == 1
BuildRequires: -post-build-checks  
%endif

%if %build_on_obs == 1
%define packager Manvendra Bhangui <manvendra@indimail.org>
BuildRequires: libidn-devel
BuildRequires: coreutils
%endif

Requires: coreutils grep /bin/sh glibc
BuildRoot: %(mktemp -ud %{_tmppath}/%{name}-%{version}-%{release}-XXXXXX)

%description
logalert is a logfile monitoring tool which executes a specific action whenever it
matches a string (pattern) occurrence.

It reads an entire file (or starts at the end, just like tail -f), keeps track  of
any changes, waiting for a specific pattern (a syslog process error, a user login,
...) and fires an action you define when that happens.

logalert uses regular expression to match the pattern occurrence and executes com‚Äê
mands  via shell interaction. It deals fine with logrotation and temporary removal
normally used by sysadmins.

%prep
%setup

%build
%configure --prefix=%{_prefix}  --sysconfdir=%{sysconfdir} --mandir=%{mandir}

%install
[ "$RPM_BUILD_ROOT" != "/" ] && %{__rm} -fr $RPM_BUILD_ROOT
%{__make} -s DESTDIR=%{buildroot}
%{__make} -s DESTDIR=%{buildroot} install-strip
find %{buildroot}%{mandir} -type f -exec gzip -q {} \;

%files
%attr(0511,root,root)            %{_prefix}/bin/logalert
%attr(0511,root,root)            %{_prefix}/bin/logclient
%attr(0511,root,root)            %{_prefix}/bin/incrmesg
%attr(0511,root,root)            %{_prefix}/bin/showbytes
%attr(0511,root,root)            %{_prefix}/sbin/rpclog
%attr(0511,root,root)            %{_prefix}/sbin/logsrv
%attr(444,root,root)             %{sysconfdir}/logalert_perm_list
%defattr(-,root,root)
%doc %attr(444,root,root)        %{_mandir}/man1/incrmesg.1.gz
%doc %attr(444,root,root)        %{_mandir}/man1/logclient.1.gz
%doc %attr(444,root,root)        %{_mandir}/man1/showbytes.1.gz
%doc %attr(444,root,root)        %{_mandir}/man8/logalert.8.gz
%doc %attr(444,root,root)        %{_mandir}/man8/logsrv.8.gz
%doc %attr(444,root,root)        %{_mandir}/man8/rpclog.8.gz

%changelog

