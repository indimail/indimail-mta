# $Log: upstart.in,v $
# Revision 1.4  2010-07-22 19:01:16+05:30  Cprogrammer
# handle upstart bug on shutdown (svscan getting respawned)
#
# Revision 1.3  2008-09-08 15:24:34+05:30  Cprogrammer
# use the shorter notation for denoting multiple run levels
#
# Revision 1.2  2008-07-25 16:56:09+05:30  Cprogrammer
# added respawn
#
# Revision 1.1  2008-06-24 22:23:35+05:30  Cprogrammer
# Initial revision
#
# Start deamontools watcher
# console output, owner, none
# to start - initctl emit qmailstart
# to stop  - initctl emit qmailstop
# start svscan
# stop  svscan
# $Id: upstart.in,v 1.4 2010-07-22 19:01:16+05:30 Cprogrammer Exp mbhangui $
description "Start IndiMail Services"
author      "$Author: Cprogrammer $"
version     "$Revision: 1.4 $"

start on runlevel [345]
start on qmailstart

stop on runlevel [0126]
stop on runlevel r
stop on starting shutdown
stop on qmailstop

console none
emits indimail

respawn
respawn limit 10 5

pre-start script
	if [ -d /var/lock/subsys ] ; then
		touch /var/lock/subsys/svscan
	fi
end script

script
	if [ -d /var/lock/subsys ] ; then
		while true
		do
			if [ -f /var/lock/subsys/indimail ] ; then
				break;
			fi
			sleep 5
		done
	fi
	exec QMAIL/bin/svscanboot /service /service1
end script

post-stop script
	if [ -d /var/lock/subsys ] ; then
		rm -f /var/lock/subsys/svscan
	fi
end script
