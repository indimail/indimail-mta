diff -Naur Fetchmail-6.3.9/ChangeLog fetchmail-6.3.9/ChangeLog
--- Fetchmail-6.3.9/ChangeLog	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/ChangeLog	2009-02-07 13:23:20.000000000 +0530
@@ -0,0 +1,56 @@
+1.  conf.c - authmeth
+2.  configure.ac - --enable-indimaildir=dir
+3.  fetchmail.c - authmeth
+4.  fetchmailconf.py - authmeth
+5.  fetchmail.h - authmeth
+6.  lock.c - use /var/tmp instead of home directory
+7.  odmr.c - odmr_up, use SMTP authentication as defined by AUTHMETHOD instead
+    of only CRAM-MD5
+8.  options.c - authmeth
+9.  rcfile_y.y - authmeth
+10. rcfile_l.l - authmeth
+11. smtp.c
+12. Makefile.am
+
+10. rcfile_y.c - authmeth
+11. rcfile_y.h - authmeth
+                          Checklist for Adding Options
+
+   Adding a control option is not complicated in principle, but there are
+   a lot of fiddly details in the process. You'll need to do the following
+   minimum steps.
+     * Add a field to represent the control in struct run, struct query,
+       or struct hostdata.
+     * Go to rcfile_y.y. Add the token to the grammar. Don't forget the
+       %token declaration.
+     * Pick an actual string to declare the option in the .fetchmailrc
+       file. Add the token to rcfile_l.
+     * Pick a long-form option name, and a one-letter short option if any
+       are left. Go to options.c. Pick a new LA_ value. Hack the
+       longoptions table to set up the association. Hack the big switch
+       statement to set the option. Hack the `?' message to describe it.
+     * If the default is nonzero, set it in def_opts near the top of
+       load_params in fetchmail.c.
+     * Add code to dump the option value in fetchmail.c:dump_params.
+     * For a per-site or per-user option, add proper FLAG_MERGE actions in
+       fetchmail.c's optmerge() function. For a global option, add an
+       override at the end of load_params; this will involve copying a
+       "cmd_run." field to a corresponding "run." field, see the existing
+       code for models.
+     * Document the option in fetchmail.man. This will require at least
+       two changes; one to the collected table of options, and one full
+       text description of the option.
+     * Hack fetchmailconf to configure it. Bump the fetchmailconf version.
+     * Hack conf.c to dump the option so we won't have a version-skew
+       problem.
+     * Add an entry to NEWS.
+     * If the option implements a new feature, add a note to the feature
+       list.
+
+   There may be other things you have to do in the way of logic, of
+   course.
+
+   Before you implement an option, though, think hard. Is there any way to
+   make fetchmail automatically detect the circumstances under which it
+   should change its behavior? If so, don't write an option. Just do the
+   check!
diff -Naur Fetchmail-6.3.9/conf.c fetchmail-6.3.9/conf.c
--- Fetchmail-6.3.9/conf.c	2008-03-06 13:55:43.000000000 +0530
+++ fetchmail-6.3.9/conf.c	2009-02-07 13:23:20.000000000 +0530
@@ -310,6 +310,10 @@
 	        stringdump("esmtpname",ctl->server.esmtp_name);
 	    if (ctl->server.esmtp_password)
 	        stringdump("esmtppassword",ctl->server.esmtp_password);
+#ifdef INDIMAIL
+		if (ctl->server.authmeth)
+	    	stringdump("authmethod", ctl->server.authmeth);
+#endif
 	    booldump("tracepolls", ctl->server.tracepolls);
 
 	    indent(0);
diff -Naur Fetchmail-6.3.9/configure.ac fetchmail-6.3.9/configure.ac
--- Fetchmail-6.3.9/configure.ac	2008-11-16 19:46:59.000000000 +0530
+++ fetchmail-6.3.9/configure.ac	2009-02-07 13:23:20.000000000 +0530
@@ -414,6 +414,14 @@
 test "$with_RPA" = "yes" && AC_DEFINE(RPA_ENABLE,1,Define if you want RPA support compiled in)
 AM_CONDITIONAL(RPA_ENABLE, test "$with_RPA" = yes)
 
+###	use option --enable-indimail to compile in the INDIMAIL support
+AC_ARG_ENABLE(indimail,
+	[  --enable-indimail            compile in INDIMAIL protocol support],
+	[with_INDIMAIL=$enableval],
+	[with_INDIMAIL=no])
+test "$with_INDIMAIL" = "yes" && AC_DEFINE(INDIMAIL,1,Define if you want INDIMAIL support compiled in)
+AM_CONDITIONAL(INDIMAIL, test "$with_INDIMAIL" = yes)
+
 ###	use option --enable-NTLM to compile in the NTLM support
 AC_ARG_ENABLE(NTLM,
 	[  --enable-NTLM           compile in NTLM authentication support],
@@ -801,6 +809,26 @@
     LIBS="-lsocks $LIBS"
 fi])
 
+indimaildir=""
+for f in /var/indimail
+do
+	if test -d $f
+	then
+		indimaildir=$f
+	fi
+done
+
+AC_ARG_ENABLE(indimaildir, [  --enable-indimaildir=dir   directory where IndiMail is installed.],
+	indimaildir="$enableval",
+	[
+		if test "$indimaildir" = ""
+		then
+			AC_MSG_ERROR([Unable to find your indimaildir directory, specify --enable-indimaildir.])
+		fi
+	])
+AC_DEFINE_UNQUOTED(INDIMAILDIR,"$indimaildir", directory for IndiMail installation)
+AC_SUBST(indimaildir)
+
 ###     use option --with-socks5=DIR to point at SOCKS library
 AC_ARG_WITH(socks5,
         [  --with-socks5[=DIR]     add built-in SOCKS5 firewall access],
diff -Naur Fetchmail-6.3.9/fetchmail.c fetchmail-6.3.9/fetchmail.c
--- Fetchmail-6.3.9/fetchmail.c	2008-03-06 14:46:05.000000000 +0530
+++ fetchmail-6.3.9/fetchmail.c	2009-02-07 13:23:20.000000000 +0530
@@ -61,6 +61,9 @@
 
 /* controls the detail level of status/progress messages written to stderr */
 int outlevel;    	    /* see the O_.* constants above */
+#ifdef INDIMAIL
+int             is_odmr = 0;
+#endif
 
 /* miscellaneous global controls */
 struct runctl run;	    /* global controls for this run */
@@ -914,6 +917,9 @@
     FLAG_MERGE(server.envelope);
     FLAG_MERGE(server.envskip);
     FLAG_MERGE(server.qvirtual);
+#ifdef INDIMAIL
+    FLAG_MERGE(server.authmeth);
+#endif
     FLAG_MERGE(server.skip);
     FLAG_MERGE(server.dns);
     FLAG_MERGE(server.checkalias);
@@ -996,6 +1002,9 @@
     def_opts.server.protocol = P_AUTO;
     def_opts.server.timeout = CLIENT_TIMEOUT;
     def_opts.server.esmtp_name = user;
+#ifdef INDIMAIL
+    def_opts.server.authmeth = "PLAIN";
+#endif
     def_opts.warnings = WARNING_INTERVAL;
     def_opts.remotename = user;
     def_opts.listener = SMTP_MODE;
@@ -1747,6 +1756,10 @@
 	{
 	    struct idlist *idp;
 
+#ifdef INDIMAIL
+		if (ctl->server.authmeth)
+			printf(GT_("  Auth Method = %s\n"), ctl->server.authmeth);
+#endif
 	    printf(GT_("  Domains for which mail will be fetched are:"));
 	    for (idp = ctl->domainlist; idp; idp = idp->next)
 	    {
diff -Naur Fetchmail-6.3.9/fetchmailconf.py fetchmail-6.3.9/fetchmailconf.py
--- Fetchmail-6.3.9/fetchmailconf.py	2008-03-07 18:47:00.000000000 +0530
+++ fetchmail-6.3.9/fetchmailconf.py	2009-02-07 13:23:20.000000000 +0530
@@ -96,6 +96,8 @@
 	self.principal = None		# Kerberos principal
 	self.esmtpname = None		# ESMTP 2554 name
 	self.esmtppassword = None	# ESMTP 2554 password
+#INDIMAIL
+	self.authmeth = "PLAIN"	    # OMDR Authentication
 	self.tracepolls = FALSE		# Add trace-poll info to headers
 	self.users = []			# List of user entries for site
 	Server.typemap = (
@@ -120,6 +122,8 @@
 	    ('plugout',   'String'),
 	    ('esmtpname', 'String'),
 	    ('esmtppassword', 'String'),
+#INDIMAIL
+	    ('authmeth', 'String'),
 	    ('principal', 'String'),
 	    ('tracepolls','Boolean'))
 
@@ -188,6 +192,9 @@
 	    res = res + " esmtpname " + `self.esmtpname`
 	if self.esmtppassword:
 	    res = res + " esmtppassword " + `self.esmtppassword`
+#INDIMAIL
+	if self.authmeth:
+	    res = res + (" authmeth " + str(self.authtype) + "\n");
 	if self.interface or self.monitor or self.principal or self.plugin or self.plugout:
 	    if folded:
 		res = res + "\n"
@@ -1132,6 +1139,8 @@
 	    protolist.append("ETRN")
 	if 'odmr' in feature_options:
 	    protolist.append("ODMR")
+#INDIMAIL
+	authmeth_list = ['LOGIN', "PLAIN", "CRAM-MD5"]
 
 	protwin = Frame(leftwin, relief=RAISED, bd=5)
 	Label(protwin, text="Protocol").pack(side=TOP)
@@ -1145,6 +1154,9 @@
 	    Checkbutton(protwin,
 		text="POP3: track `seen' with client-side UIDLs?",
 		variable=self.uidl).pack(side=TOP)
+#INDIMAIL
+	LabeledEntry(protwin, 'Auth Method:', self.authmeth, '20').pack(side=TOP)
+	ButtonBar(protwin, '', self.authmeth, authmeth_list, 1, None)
 	Button(protwin, text='Probe for supported protocols', fg='blue',
 	       command=self.autoprobe).pack(side=LEFT)
 	Button(protwin, text='Help', fg='blue',
@@ -1947,8 +1959,9 @@
 # The `optional' fields are the ones we can ignore for purposes of
 # conformability checking; they'll still get copied if they are
 # present in the dictionary.
+#INDIMAIL
     optional = ('interface', 'monitor',
-		'esmtpname', 'esmtppassword',
+		'esmtpname', 'esmtppassword', 'authmeth',
 		'ssl', 'sslkey', 'sslcert', 'sslproto', 'sslcertck',
 		'sslcertpath', 'sslcommonname', 'sslfingerprint', 'showdots')
     class_sig = setdiff(toclass.__dict__.keys(), optional)
diff -Naur Fetchmail-6.3.9/fetchmail.cron.in fetchmail-6.3.9/fetchmail.cron.in
--- Fetchmail-6.3.9/fetchmail.cron.in	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/fetchmail.cron.in	2009-02-07 13:23:20.000000000 +0530
@@ -0,0 +1,43 @@
+#!/bin/sh
+#
+# $Log: slemslite.cron.in,v $
+# Revision 1.2  2005-06-26 12:56:17+05:30  Cprogrammer
+# added comments
+#
+# Revision 1.1  2003-12-13 16:10:29+05:30  Cprogrammer
+# Initial revision
+#
+#
+trap "" 1
+WHOAMI=`/usr/bin/whoami`
+if [ -f /tmp/slemscron.pid ] ; then
+	pid=`cat /tmp/slemscron"$WHOAMI".pid`
+	kill -0 $pid > /dev/null 2>&1
+	if [ $? = 0 ] ; then
+		exit 0
+	fi
+fi
+if [ -d /service1 ] ; then
+	SERVICEDIR=/service1
+elif [ -d /service2 ] ; then
+	SERVICEDIR=/service2
+else
+	SERVICEDIR=/service
+fi
+echo $$ > /tmp/slemscron"$WHOAMI".pid
+if [ -p /tmp/.wakeup ] ; then
+	@prefix@/bin/writefifo /tmp/.wakeup
+fi
+
+if [ " $1" = " dialup" ] ; then
+	touch /tmp/.dialup
+else
+	rm -f /tmp/.dialup
+fi
+@prefix@/bin/slemsPrivate @prefix@/bin/svstat $SERVICEDIR/slemslite
+if [ $? = 0 ] ; then
+	exec @prefix@/bin/slemslite # Send wakeup signal to slemslite
+else # Do not start slemslite if down in /service directory
+	/bin/rm -f /tmp/slemscron"$WHOAMI".pid
+	exit 0
+fi
diff -Naur Fetchmail-6.3.9/fetchmail.down.in fetchmail-6.3.9/fetchmail.down.in
--- Fetchmail-6.3.9/fetchmail.down.in	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/fetchmail.down.in	2009-02-07 13:23:20.000000000 +0530
@@ -0,0 +1,69 @@
+#!/bin/sh
+#
+# $Log: fetchmail.down.in,v $
+# Revision 1.5  2008-06-20 20:49:48+05:30  Cprogrammer
+# moved slemsPrivate to sbin
+#
+# Revision 1.4  2005-06-26 12:56:28+05:30  Cprogrammer
+# exit for non-dialup setups
+# bug fix for servicedir
+#
+# Revision 1.3  2005-02-18 23:55:04+05:30  Cprogrammer
+# added comments
+#
+# Revision 1.2  2004-05-12 23:03:39+05:30  Cprogrammer
+# added comments
+#
+# Revision 1.1  2003-12-13 16:10:43+05:30  Cprogrammer
+# Initial revision
+#
+#
+trap "" 1
+if [ ! -f /tmp/.dialup ] ; then
+	exit 0
+fi
+
+if [ -f /sbin/ifconfig ] ; then
+	IFCONFIG=/sbin/ifconfig
+elif [ -f /usr/sbin/ifconfig ] ; then
+	IFCONFIG=/usr/sbin/ifconfig
+elif [ -f /usr/bin/ifconfig ] ; then
+	IFCONFIG=/usr/bin/ifconfig
+fi
+$IFCONFIG ppp0 >/dev/null 2>&1
+if [ $? -ne 0 ] ; then
+	exit 1
+fi
+if [ -d /service1 ] ; then
+	SERVICEDIR=/service1
+elif [ -d /service2 ] ; then
+	SERVICEDIR=/service2
+else
+	SERVICEDIR=/service
+fi
+#
+# send out all outgoing mails
+#
+@prefix@/sbin/slemsPrivate @prefix@/bin/qmail-tcpok > /dev/null
+@prefix@/sbin/slemsPrivate @prefix@/bin/svc -a $SERVICEDIR/qmail-send*
+sleep 3
+#
+# Die when there are no mails in queue
+# keep on sleeping for 10 seconds if there are mails in queue
+# die if even after 10 tries, mails are still in queue
+#
+check=0
+while true
+do
+  	count=`@prefix@/sbin/slemsPrivate @prefix@/bin/qmail-qstat | grep Total | grep -v remote | grep -v todo | grep -v local | awk '{print $5}'`
+	check=`expr $check + 1`
+	if [ " $count" = " 0" ] ; then
+		@prefix@/sbin/slemsPrivate @prefix@/sbin/ppp-off
+		exit 0
+	fi
+	sleep 10
+	if [ " $check" = " 10" ] ; then
+		@prefix@/sbin/slemsPrivate @prefix@/sbin/ppp-off
+		exit 1
+	fi
+done
diff -Naur Fetchmail-6.3.9/fetchmail.h fetchmail-6.3.9/fetchmail.h
--- Fetchmail-6.3.9/fetchmail.h	2008-03-06 14:25:12.000000000 +0530
+++ fetchmail-6.3.9/fetchmail.h	2009-02-07 13:22:33.000000000 +0530
@@ -267,6 +267,7 @@
     flag checkalias;			/* resolve aliases by comparing IPs? */
     flag tracepolls;			/* if TRUE, add poll trace info to Received */
     char *principal;			/* Kerberos principal for mail service */
+	char *authmeth;
     char *esmtp_name, *esmtp_password;	/* ESMTP AUTH information */
 
 #if defined(linux) || defined(__FreeBSD__)
diff -Naur Fetchmail-6.3.9/fetchmail.man fetchmail-6.3.9/fetchmail.man
--- Fetchmail-6.3.9/fetchmail.man	2008-11-16 21:00:53.000000000 +0530
+++ fetchmail-6.3.9/fetchmail.man	2009-02-07 13:23:20.000000000 +0530
@@ -256,7 +256,7 @@
 with standard server daemons to fetch mail already delivered to a
 mailbox on the server) except ETRN and ODMR.  The ETRN mode
 allows you to ask a compliant ESMTP server (such as BSD sendmail at
-release 8.8.0 or higher) to immediately open a sender-SMTP connection
+release 8.8.0 or higher or indimail) to immediately open a sender-SMTP connection
 to your client machine and begin forwarding any items addressed to
 your client machine in the server's queue of undelivered mail.   The
 ODMR mode requires an ODMR-capable server and works similarly to
@@ -886,6 +886,10 @@
 \&'mbox\-userstr\-' prefix to deliver to the correct user.
 This is what this option is for.
 .TP
+.B \-O <type> | \-\-authmethod <type>
+(Keyword: authmethod; ODMR only)
+set authentication to AUTH, LOGIN or PLAIN for ODMR.
+.TP
 .B \-\-configdump
 Parse the
 .I ~/.fetchmailrc
@@ -1630,6 +1634,9 @@
 qvirtual	\-Q	m	T{
 Qmail virtual domain prefix to remove from user name
 T}
+authmeth	\-O	\&	T{
+Set AUTH, LOGIN or PLAIN for ODMR authentication
+T}
 aka      	\&	m	T{
 Specify alternate DNS names of mailserver
 T}
diff -Naur Fetchmail-6.3.9/fetchmail.up.in fetchmail-6.3.9/fetchmail.up.in
--- Fetchmail-6.3.9/fetchmail.up.in	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/fetchmail.up.in	2009-02-07 13:23:20.000000000 +0530
@@ -0,0 +1,75 @@
+#!/bin/sh
+#
+# $Log: fetchmail.up.in,v $
+# Revision 1.4  2008-06-20 20:50:22+05:30  Cprogrammer
+# moved slemsPrivate, fixwvdialconf to sbin
+#
+# Revision 1.3  2005-06-26 12:56:57+05:30  Cprogrammer
+# added comments
+#
+# Revision 1.2  2004-05-12 23:03:45+05:30  Cprogrammer
+# added comments
+#
+# Revision 1.1  2003-12-13 16:10:54+05:30  Cprogrammer
+# Initial revision
+#
+#
+trap "" 1
+if [ ! -f /tmp/.dialup ] ; then
+	exit 0
+fi
+if [ -f /sbin/ifconfig ] ; then
+	IFCONFIG=/sbin/ifconfig
+elif [ -f /usr/sbin/ifconfig ] ; then
+	IFCONFIG=/usr/sbin/ifconfig
+elif [ -f /usr/bin/ifconfig ] ; then
+	IFCONFIG=/usr/bin/ifconfig
+fi
+#
+# Attempt to bring up the PPP interface using wvdial
+# If PPP is up, we do not need to do anyting
+# If PPP is down, we need to wait till the IP comes
+# up. This is done by creating the fifo .wakeup and
+# waiting on read on .wakeup to return. The return
+# happens when a byte is written to .wakeup by ip-up.local
+# .wakeup is deleted after the read
+#
+$IFCONFIG ppp0 >/dev/null 2>&1
+if [ $? -ne 0 ] ; then
+	status=0
+	MYPID=$$
+	(
+	@prefix@/sbin/slemsPrivate @prefix@/sbin/fixwvdialconf
+	@prefix@/sbin/slemsPrivate /usr/bin/killall -9 wvdial
+	@prefix@/sbin/slemsPrivate /usr/bin/wvdial INDI
+	if [ $? -ne 0 ] ; then
+		kill -9 $MYPID
+		exit 1
+	fi
+	) > /tmp/wvdial.log 2>&1 &
+	i=1
+	while true
+	do
+		$IFCONFIG ppp0 >/dev/null 2>&1
+		if [ $? -eq 0 ] ; then
+			if [ -p /tmp/.wakeup ] ; then # May have been created by ip-up.local
+				read < /tmp/.wakeup
+				if [ $? -ne 0 ] ; then
+					sleep 5
+				fi
+			else
+				/bin/rm -f /tmp/.wakeup
+				/usr/bin/mkfifo /tmp/.wakeup
+				read < /tmp/.wakeup
+			fi
+			/bin/rm -f /tmp/.wakeup
+			break
+		fi
+		i=`expr $i + 1`
+		sleep 2
+		if [ $i -eq 60 ] ; then
+			exit 1
+		fi
+	done
+fi
+exit 0
diff -Naur Fetchmail-6.3.9/fixwvdialconf.c fetchmail-6.3.9/fixwvdialconf.c
--- Fetchmail-6.3.9/fixwvdialconf.c	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/fixwvdialconf.c	2009-02-07 13:23:20.000000000 +0530
@@ -0,0 +1,51 @@
+/*
+ * $Log: fixwvdialconf.c,v $
+ * Revision 1.3  2008-06-20 22:21:58+05:30  Cprogrammer
+ * made return type of main as int
+ *
+ * Revision 1.2  2008-06-20 20:50:43+05:30  Cprogrammer
+ * fixed compilation warning
+ *
+ * Revision 1.1  2003-12-13 17:46:42+05:30  Cprogrammer
+ * Initial revision
+ *
+ */
+
+#include <stdio.h>
+#include <string.h>
+int
+main()
+{
+	FILE           *fp;
+	char            buffer[1024];
+	int             found;
+
+	if (!(fp = fopen("/etc/wvdial.conf", "r")))
+	{
+		perror("/etc/wvdial.conf");
+		return (1);
+	}
+	for (found = 0;;)
+	{
+		if (!fgets(buffer, sizeof(buffer), fp))
+			break;
+		if (strstr(buffer, "Auto Reconnect"))
+		{
+			found = 1;
+			break;
+		}
+	}
+	if (found)
+	{
+		fclose(fp);
+		return (0);
+	}
+	if (!(fp = freopen("/etc/wvdial.conf", "a", fp)))
+	{
+		perror("freopen: /etc/wvdial.conf");
+		return (1);
+	}
+	fprintf(fp, "Auto Reconnect = 0\n");
+	fclose(fp);
+	return (0);
+}
diff -Naur Fetchmail-6.3.9/ip-down.local.in fetchmail-6.3.9/ip-down.local.in
--- Fetchmail-6.3.9/ip-down.local.in	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/ip-down.local.in	2009-02-07 13:23:21.000000000 +0530
@@ -0,0 +1,19 @@
+#!/bin/sh
+#
+# $Log: ip-down.local.in,v $
+# Revision 1.2  2005-06-26 12:54:44+05:30  Cprogrammer
+# added restoration of resolv.conf
+#
+# Revision 1.1  2005-02-15 14:48:47+05:30  Cprogrammer
+# Initial revision
+#
+#
+ID=`/usr/bin/whoami`
+if [ " $ID" = " root" ] ; then
+	mv /etc/ppp/resolv.conf.org /etc/resolv.conf
+	kill -9 `/bin/cat /var/run/slemslite.pid`
+else
+	home_dir=`awk -F: '{print $6}' /etc/passwd|grep $ID|head -1`
+	kill -9 `/bin/cat $home_dir/.slemslite.pid`
+fi
+exit $?
diff -Naur Fetchmail-6.3.9/ip-up.local.in fetchmail-6.3.9/ip-up.local.in
--- Fetchmail-6.3.9/ip-up.local.in	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/ip-up.local.in	2009-02-07 13:23:21.000000000 +0530
@@ -0,0 +1,36 @@
+#!/bin/sh
+#
+# $Log: ip-up.local.in,v $
+# Revision 1.3  2008-06-20 20:51:11+05:30  Cprogrammer
+# moved writefifo to sbin
+#
+# Revision 1.2  2005-06-26 12:55:19+05:30  Cprogrammer
+# create FIFO if ppp0 brings up IP faster than slemslite.up script creates .wakeup fifo
+#
+# Revision 1.1  2003-12-13 16:14:23+05:30  Cprogrammer
+# Initial revision
+#
+#
+if [ " $IPLOCAL" = " " ] ; then
+	exit 1
+else
+	route add default gw $IPLOCAL
+	i=1
+	while true
+	do
+		if [ -p /tmp/.wakeup ] ; then
+			@prefix@/sbin/writefifo /tmp/.wakeup
+			break
+		fi
+		sleep 1
+		i=`expr $i + 1`
+		if [ $i -eq 60 ] ; then
+			if [ ! -p /tmp/.wakeup ] ; then
+				mkfifo /tmp/.wakeup
+			fi
+			echo > /tmp/.wakeup &
+			exit 1
+		fi
+	done
+	exit 0
+fi
diff -Naur Fetchmail-6.3.9/lock.c fetchmail-6.3.9/lock.c
--- Fetchmail-6.3.9/lock.c	2006-11-20 00:00:02.000000000 +0530
+++ fetchmail-6.3.9/lock.c	2009-02-07 13:23:21.000000000 +0530
@@ -46,9 +46,17 @@
 	strcat(lockfile, "/");
 	strcat(lockfile, FETCHMAIL_PIDFILE);
     } else {
+#ifdef INDIMAIL
+	lockfile = (char *)xmalloc(strlen("/var/tmp")
+#else
 	lockfile = (char *)xmalloc(strlen(fmhome)
+#endif
 		+ strlen(FETCHMAIL_PIDFILE) + 3); /* 3: "/", "." and NUL */
+#ifdef INDIMAIL
+	strcpy(lockfile, "/var/tmp");
+#else
 	strcpy(lockfile, fmhome);
+#endif
 	strcat(lockfile, "/");
 	if (fmhome == home)
 	   strcat(lockfile, ".");
diff -Naur Fetchmail-6.3.9/Makefile.am fetchmail-6.3.9/Makefile.am
--- Fetchmail-6.3.9/Makefile.am	2008-06-13 22:31:59.000000000 +0530
+++ fetchmail-6.3.9/Makefile.am	2009-02-07 21:37:44.000000000 +0530
@@ -3,12 +3,19 @@
 SUBDIRS=		m4 po
 AUTOMAKE_OPTIONS=	1.8 foreign no-dist-gzip dist-bzip2
 
+COFLAGS=-z+05:30
 AM_CPPFLAGS=		-I$(srcdir)/libesmtp
 ACLOCAL_AMFLAGS=	-I m4 -I m4-local
 AM_YFLAGS=		-d
 BUILT_SOURCES=		rcfile_y.h
 
 bin_PROGRAMS=		fetchmail
+sbin_PROGRAMS=      slemsPrivate writefifo fixwvdialconf
+sbin_SCRIPTS=       fetchmail.up fetchmail.down ip-down.local ip-up.local ppp-off fetchmail.cron
+ 
+MOSTLYCLEANFILES=fetchmail.up fetchmail.down fetchmail.cron ip-up.local ip-down.local
+
+mandir=@prefix@/man
 
 dist_noinst_SCRIPTS=	specgen.sh
 dist_man1_MANS=		fetchmail.man
@@ -119,6 +126,10 @@
 SHELL = /bin/sh
 @SET_MAKE@
 
+edit = sed \
+	-e 's,@indimaildir\@,$(indimaildir),g' \
+	-e 's,@prefix\@,$(prefix),g'
+
 fetchmail.spec: Makefile.in specgen.sh
 	$(srcdir)/specgen.sh $(VERSION) >fetchmail.spec
 
@@ -184,6 +195,30 @@
 	cd $(distdir) && find $(distdirs) po -name .svn -type d -prune -exec rm -rf '{}' ';'
 	cd $(distdir) && find $(distdirs) po -name '*~' -exec rm -f '{}' ';'
 
+slemsPrivate: slemsPrivate.o
+	$(CC) -o $@ $@.o
+slemsPrivate.o: slemsPrivate.c config.h
+	$(CC) $(CFLAGS) -c slemsPrivate.c
+fixwvdialconf: fixwvdialconf.o
+	$(CC) -o $@ $@.o
+fixwvdialconf.o: fixwvdialconf.c config.h
+	$(CC) $(CFLAGS) -c fixwvdialconf.c
+writefifo: writefifo.o
+	$(CC) -o $@ $@.o
+writefifo.o: writefifo.c
+	$(CC) -c writefifo.c
+fetchmail.up: fetchmail.up.in
+	$(edit) $@.in > $@
+fetchmail.down: fetchmail.down.in
+	$(edit) $@.in > $@
+fetchmail.cron: fetchmail.cron.in
+	$(edit) $@.in > $@
+ip-up.local: ip-up.local.in
+	$(edit) $@.in > $@
+ip-down.local: ip-down.local.in
+	$(edit) $@.in > $@
+
+
 .PHONY: lsm
 lsm: genlsm.sh dist
 	$(SHELL) genlsm.sh >$(PACKAGE)-$(VERSION).lsm
diff -Naur Fetchmail-6.3.9/odmr.c fetchmail-6.3.9/odmr.c
--- Fetchmail-6.3.9/odmr.c	2006-08-11 04:12:27.000000000 +0530
+++ fetchmail-6.3.9/odmr.c	2009-02-07 13:23:21.000000000 +0530
@@ -30,17 +30,17 @@
 #include  "smtp.h"
 #include  "socket.h"
 
-static int odmr_ok (int sock, char *argbuf)
+#ifdef INDIMAIL
+int             SMTP_auth(int, char, char *, char *, char *);
+#endif
+
 /* parse command response */
+static int odmr_ok (int sock, char *argbuf)
 {
     int ok;
 
     (void)argbuf;
-    ok = SMTP_ok(sock, SMTP_MODE);
-    if (ok == SM_UNRECOVERABLE)
-	return(PS_PROTOCOL);
-    else
-	return(ok);
+	return ((ok = SMTP_ok(sock, SMTP_MODE)) == SM_UNRECOVERABLE ? PS_PROTOCOL : ok);
 }
 
 static int odmr_getrange(int sock, struct query *ctl, const char *id, 
@@ -51,6 +51,10 @@
     int doing_smtp_data = 0;   /* Are we in SMTP DATA state? */
     char buf [MSGBUFSIZE+1];
     struct idlist *qnp;		/* pointer to Q names */
+#ifdef INDIMAIL
+	int             odmr_up;
+	char           *ptr;
+#endif
 
     (void)id;
     if ((ok = SMTP_ehlo(sock, SMTP_MODE, fetchmailhost, 
@@ -70,12 +74,15 @@
 
     /* make sure we don't enter the fetch loop */
     *bytes = *countp = *newp = -1;
-
-    /* authenticate via CRAM-MD5 */
-    ok = do_cram_md5(sock, "AUTH", ctl, "334 ");
-    if (ok)
-	return(ok);
-
+#ifdef INDIMAIL
+	if ((ok = SMTP_auth(sock, SMTP_MODE, ctl->remotename, ctl->password, !(ptr = getenv("AUTHMETHOD")) ? ctl->server.authmeth : ptr)))
+		return (1);
+#else
+	/*- authenticate via CRAM-MD5 */
+	ok = do_cram_md5(sock, "AUTH", ctl, "334 ");
+	if (ok)
+		return (ok);
+#endif
     /*
      * By default, the hostlist has a single entry, the fetchmail host's
      * canonical DNS name.
@@ -144,7 +151,11 @@
     {
 	int	maxfd = (sock > smtp_sock) ? sock : smtp_sock;
 
+#ifdef INDIMAIL
+	for (odmr_up = 1;;)
+#else
 	for (;;)
+#endif
 	{
 	    fd_set	readfds;
 	    struct timeval timeout;
@@ -160,7 +171,12 @@
 	    if (select(maxfd+1, &readfds, NULL, NULL, &timeout) == -1)
 		return(PS_PROTOCOL);		/* timeout */
 
-	    if (FD_ISSET(sock, &readfds))
+#ifdef INDIMAIL
+		/*- Remote SMTP - ODMR */
+		if (odmr_up && FD_ISSET(sock, &readfds))
+#else
+		if (FD_ISSET(sock, &readfds))
+#endif
 	    {
 		int n = SockRead(sock, buf, sizeof(buf));
 		if (n <= 0)
@@ -170,6 +186,7 @@
 		if (outlevel >= O_MONITOR && !doing_smtp_data)
 		    report(stdout, "ODMR< %s", buf);
 	    }
+		/*- Local SMTP */
 	    if (FD_ISSET(smtp_sock, &readfds))
 	    {
 		int n = SockRead(smtp_sock, buf, sizeof(buf));
diff -Naur Fetchmail-6.3.9/options.c fetchmail-6.3.9/options.c
--- Fetchmail-6.3.9/options.c	2008-03-06 14:24:50.000000000 +0530
+++ fetchmail-6.3.9/options.c	2009-02-07 13:23:21.000000000 +0530
@@ -51,7 +51,12 @@
     LA_FETCHSIZELIMIT,
     LA_FASTUIDL,
     LA_LIMITFLUSH,
+#ifdef INDIMAIL
+    LA_IDLE,
+	LA_AUTHMETH
+#else
     LA_IDLE
+#endif
 };
 
 /* options still left: CgGhHjJoORTWxXYz */
@@ -89,6 +94,9 @@
   {"timeout",	required_argument, (int *) 0, 't' },
   {"envelope",	required_argument, (int *) 0, 'E' },
   {"qvirtual",	required_argument, (int *) 0, 'Q' },
+#ifdef INDIMAIL
+  {"authmeth",	required_argument, (int *) 0, 'O' },
+#endif
 
   {"user",	required_argument, (int *) 0, 'u' },
   {"username",	required_argument, (int *) 0, 'u' },
@@ -399,6 +407,11 @@
 	    ctl->server.qvirtual = xstrdup(optarg);
 	    break;
 
+#ifdef INDIMAIL
+	case 'O':    
+	    ctl->server.authmeth = xstrdup(optarg);
+	    break;
+#endif
 	case 'u':
 	    ctl->remotename = xstrdup(optarg);
 	    break;
@@ -632,6 +645,9 @@
 	P(GT_("  -t, --timeout     server nonresponse timeout\n"));
 	P(GT_("  -E, --envelope    envelope address header\n"));
 	P(GT_("  -Q, --qvirtual    prefix to remove from local user id\n"));
+#ifdef INDIMAIL
+	P(GT_("  -O, --authmethod  set AUTH, LOGIN or PLAIN for ODMR authentication\n"));
+#endif
 	P(GT_("      --principal   mail service principal\n"));
 	P(GT_("      --tracepolls  add poll-tracing information to Received header\n"));
 
diff -Naur Fetchmail-6.3.9/ppp-off fetchmail-6.3.9/ppp-off
--- Fetchmail-6.3.9/ppp-off	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/ppp-off	2009-02-07 13:23:21.000000000 +0530
@@ -0,0 +1,34 @@
+#!/bin/sh
+######################################################################
+#
+# Determine the device to be terminated.
+#
+if [ "$1" = "" ]; then
+	DEVICE=ppp0
+else
+	DEVICE=$1
+fi
+
+######################################################################
+#
+# If the ppp0 pid file is present then the program is running. Stop it.
+if [ -r /var/run/$DEVICE.pid ]; then
+        kill -INT `cat /var/run/$DEVICE.pid`
+#
+# If the kill did not work then there is no process running for this
+# pid. It may also mean that the lock file will be left. You may wish
+# to delete the lock file at the same time.
+        if [ ! "$?" = "0" ]; then
+                rm -f /var/run/$DEVICE.pid
+                echo "ERROR: Removed stale pid file"
+                exit 1
+        fi
+#
+# Success. Let pppd clean up its own junk.
+        echo "PPP link to $DEVICE terminated."
+        exit 0
+fi
+#
+# The ppp process is not running for ppp0
+echo "ERROR: PPP link is not active on $DEVICE"
+exit 1
diff -Naur Fetchmail-6.3.9/rcfile_l.l fetchmail-6.3.9/rcfile_l.l
--- Fetchmail-6.3.9/rcfile_l.l	2008-03-06 13:55:43.000000000 +0530
+++ fetchmail-6.3.9/rcfile_l.l	2009-02-07 13:23:21.000000000 +0530
@@ -111,6 +111,7 @@
 principal	{ return PRINCIPAL; }
 esmtpname	{ return ESMTPNAME; }
 esmtppassword	{ return ESMTPPASSWORD; }
+authmeth	{ return AUTHMETH; }
 
 
 user(name)?	{SETSTATE(NAME); return USERNAME; }
diff -Naur Fetchmail-6.3.9/rcfile_y.c fetchmail-6.3.9/rcfile_y.c
--- Fetchmail-6.3.9/rcfile_y.c	2008-07-03 20:17:36.000000000 +0530
+++ fetchmail-6.3.9/rcfile_y.c	2009-02-07 13:23:21.000000000 +0530
@@ -155,7 +155,8 @@
      PRINCIPAL = 344,
      ESMTPNAME = 345,
      ESMTPPASSWORD = 346,
-     TRACEPOLLS = 347
+     AUTHMETH = 347,
+     TRACEPOLLS = 348
    };
 #endif
 /* Tokens.  */
diff -Naur Fetchmail-6.3.9/rcfile_y.h fetchmail-6.3.9/rcfile_y.h
--- Fetchmail-6.3.9/rcfile_y.h	2008-03-06 14:13:52.000000000 +0530
+++ fetchmail-6.3.9/rcfile_y.h	2009-02-07 13:23:21.000000000 +0530
@@ -221,7 +221,8 @@
 #define PRINCIPAL 344
 #define ESMTPNAME 345
 #define ESMTPPASSWORD 346
-#define TRACEPOLLS 347
+#define AUTHMETH 347
+#define TRACEPOLLS 348
 
 
 
diff -Naur Fetchmail-6.3.9/rcfile_y.y fetchmail-6.3.9/rcfile_y.y
--- Fetchmail-6.3.9/rcfile_y.y	2008-06-30 19:09:36.000000000 +0530
+++ fetchmail-6.3.9/rcfile_y.y	2009-02-07 13:23:21.000000000 +0530
@@ -77,7 +77,7 @@
 %token DROPSTATUS DROPDELIVERED
 %token DNS SERVICE PORT UIDL INTERVAL MIMEDECODE IDLE CHECKALIAS 
 %token SSL SSLKEY SSLCERT SSLPROTO SSLCERTCK SSLCERTPATH SSLCOMMONNAME SSLFINGERPRINT
-%token PRINCIPAL ESMTPNAME ESMTPPASSWORD
+%token PRINCIPAL ESMTPNAME ESMTPPASSWORD AUTHMETH
 %token TRACEPOLLS
 
 %%
@@ -159,6 +159,7 @@
 		| PRINCIPAL STRING	{current.server.principal = xstrdup($2);}
 		| ESMTPNAME STRING	{current.server.esmtp_name = xstrdup($2);}
 		| ESMTPPASSWORD STRING	{current.server.esmtp_password = xstrdup($2);}
+		| AUTHMETH STRING	{current.server.authmeth = xstrdup($2);}
 		| PROTOCOL SDPS		{
 #ifdef SDPS_ENABLE
 					    current.server.protocol = P_POP3;
diff -Naur Fetchmail-6.3.9/sink.c fetchmail-6.3.9/sink.c
--- Fetchmail-6.3.9/sink.c	2007-08-08 01:46:28.000000000 +0530
+++ fetchmail-6.3.9/sink.c	2009-02-09 12:16:31.000000000 +0530
@@ -535,6 +535,31 @@
 	free(responses[0]);
 	return(PS_REFUSED);
 
+    case 530: /* must issue STARTTLS error */  
+   /*  
+    * Some SMTP servers insist on encrypted communication  
+    * Let's set PS_TRANSIENT, otherwise all messages to be sent   
+    * over such server would be blackholed  
+    */  
+   free(responses[0]);  
+   if (outlevel > O_SILENT)  
+       report_complete(stdout,   
+               GT_(" SMTP server requires STARTTLS, keeping message.\n"));  
+   return(PS_TRANSIENT);  
+      
+    case 501: /* Syntax error in parameters or arguments */  
+   /*  
+    * Some SMTP servers use this error code to refuse spam, however  
+    * as we don't want to delete message if e.g. the address is (possibly   
+    * by mistake) malformed, user has to use the 'antispam' option to  
+    * treat this as spam symptom  
+    */  
+   free(responses[0]);  
+   if (outlevel > O_SILENT)  
+       report_complete(stdout,   
+               GT_(" SMTP 501 error - if the server uses this code to report spam, include '501' in the 'antispam' option .\n"));  
+   return(PS_TRANSIENT);  
+      
     default:
 	/* bounce non-transient errors back to the sender */
 	if (smtperr >= 500 && smtperr <= 599)
@@ -1320,7 +1345,7 @@
     int smtp_err;
     if (ctl->mda)
     {
-	int rc,e,e2,err = 0;
+	int rc,e,e2 = 0,err = 0;
 
 	/* close the delivery pipe, we'll reopen before next message */
 	if (sinkfp)
diff -Naur Fetchmail-6.3.9/slemsPrivate.c fetchmail-6.3.9/slemsPrivate.c
--- Fetchmail-6.3.9/slemsPrivate.c	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/slemsPrivate.c	2009-02-07 13:23:21.000000000 +0530
@@ -0,0 +1,62 @@
+/*
+ * $Log: slemsPrivate.c,v $
+ * Revision 1.3  2008-06-20 22:21:42+05:30  Cprogrammer
+ * fixed compilation warnings
+ *
+ * Revision 1.2  2008-06-20 20:51:46+05:30  Cprogrammer
+ * added stdlib.h to fix compiler warning
+ * moved programs to INDIMAILDIR
+ *
+ * Revision 1.1  2003-12-13 18:45:45+05:30  Cprogrammer
+ * Initial revision
+ *
+ */
+#include <stdio.h>
+#include <stdlib.h>
+#include <errno.h>
+#include <string.h>
+#include <unistd.h>
+#include "config.h"
+
+int
+main(int argc, char **argv)
+{
+	int             i;
+	static char    *priv_cmds[] = {
+		INDIMAILDIR "/bin/qmail-tcpok",
+		INDIMAILDIR "/bin/svc",
+		INDIMAILDIR "/bin/svstat",
+		INDIMAILDIR "/bin/ppp-off",
+		INDIMAILDIR "/bin/fixwvdialconf",
+		INDIMAILDIR "/bin/qmail-qstat",
+		"/usr/bin/killall",
+		"/usr/bin/wvdial",
+		0
+	};
+
+	if (argc < 2)
+		return (1);
+	for (i = 0; priv_cmds[i]; i++)
+	{
+		if (!strcmp(priv_cmds[i], argv[1]))
+			break;
+	}
+	if (!priv_cmds[i])
+	{
+		fprintf(stderr, "%s: Invalid command\n", argv[1]);
+		return (1);
+	}
+	if (setuid(0))
+	{
+		perror("setuid");
+		return (1);
+	} else
+	if (setgid(0))
+	{
+		perror("setgid");
+		return (1);
+	}
+	execv(argv[1], argv + 1);
+	perror(argv[1]);
+	exit(1);
+}
diff -Naur Fetchmail-6.3.9/smtp.c fetchmail-6.3.9/smtp.c
--- Fetchmail-6.3.9/smtp.c	2005-12-20 06:17:50.000000000 +0530
+++ fetchmail-6.3.9/smtp.c	2009-02-07 13:22:33.000000000 +0530
@@ -12,6 +12,7 @@
 #include "fetchmail.h"
 
 #include <stdio.h>
+#include <stdlib.h>
 #include <unistd.h>
 #include <string.h>
 #include <signal.h>
@@ -19,340 +20,506 @@
 #include "smtp.h"
 #include "i18n.h"
 
-struct opt
-{
-    const char *name;
-    int value;
+struct opt {
+	const char     *name;
+	int             value;
 };
 
-static struct opt extensions[] =
-{
-    {"8BITMIME",	ESMTP_8BITMIME},
-    {"SIZE",    	ESMTP_SIZE},
-    {"ETRN",		ESMTP_ETRN},
-    {"AUTH ",		ESMTP_AUTH},
+static struct opt extensions[] = {
+	{"8BITMIME", ESMTP_8BITMIME},
+	{"SIZE", ESMTP_SIZE},
+	{"ETRN", ESMTP_ETRN},
+	{"AUTH ", ESMTP_AUTH},
 #ifdef ODMR_ENABLE
-    {"ATRN",		ESMTP_ATRN},
-#endif /* ODMR_ENABLE */
-    {(char *)NULL, 0},
+	{"ATRN", ESMTP_ATRN},
+#endif	/* ODMR_ENABLE */
+	{(char *) NULL, 0},
 };
 
-char smtp_response[MSGBUFSIZE];
+char            smtp_response[MSGBUFSIZE];
 
-int SMTP_helo(int sock, char smtp_mode, const char *host)
-/* send a "HELO" message to the SMTP listener */
+int
+SMTP_helo(int sock, char smtp_mode, const char *host)
+/*
+ * send a "HELO" message to the SMTP listener 
+ */
 {
-  int ok;
+	int             ok;
 
-  SockPrintf(sock,"HELO %s\r\n", host);
-  if (outlevel >= O_MONITOR)
-      report(stdout, "%cMTP> HELO %s\n", smtp_mode, host);
-  ok = SMTP_ok(sock, smtp_mode);
-  return ok;
+	SockPrintf(sock, "HELO %s\r\n", host);
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP> HELO %s\n", smtp_mode, host);
+	ok = SMTP_ok(sock, smtp_mode);
+	return ok;
 }
 
-static void SMTP_auth_error(int sock, const char *msg)
+static void
+SMTP_auth_error(int sock, const char *msg)
 {
-    SockPrintf(sock, "*\r\n");
-    SockRead(sock, smtp_response, sizeof(smtp_response) - 1);
-    if (outlevel >= O_MONITOR) report(stdout, msg);
+	SockPrintf(sock, "*\r\n");
+	SockRead(sock, smtp_response, sizeof (smtp_response) - 1);
+	if (outlevel >= O_MONITOR)
+		report(stdout, msg);
 }
 
-static void SMTP_auth(int sock, char smtp_mode, char *username, char *password, char *buf)
-/* ESMTP Authentication support for fetchmail by Wojciech Polak */
-{	
-	int c;
-	char *p = 0;
-	char b64buf[512];
-	char tmp[512];
-
-	if (!username || !password) return;
-
-	memset(b64buf, 0, sizeof(b64buf));
-	memset(tmp, 0, sizeof(tmp));
-
-	if (strstr(buf, "CRAM-MD5")) {
-		unsigned char digest[16];
-		memset(digest, 0, sizeof(digest));
-
+/*
+ * ESMTP Authentication support for fetchmail by Wojciech Polak 
+ */
+#ifdef INDIMAIL
+int
+#else
+static void
+#endif
+SMTP_auth(int sock, char smtp_mode, char *username, char *password, char *buf)
+{
+	int             c;
+#ifdef INDIMAIL
+	int             ok = -1;
+	extern int      is_odmr;
+	char           *ptr;
+#endif
+	char           *p = 0;
+	char            b64buf[512];
+	char            tmp[512];
+
+	if (!username || !password)
+#ifdef INDIMAIL
+		return (1);
+#else
+		return;
+#endif
+	memset(b64buf, 0, sizeof (b64buf));
+	memset(tmp, 0, sizeof (tmp));
+#ifdef INDIMAIL
+	ptr = (char *) getenv("AUTHTYPE");
+	if (strstr(buf, "CRAM-MD5") || (ptr && *ptr && !strcmp(ptr, "CRAM-MD5")))
+#else
+	if (strstr(buf, "CRAM-MD5"))
+#endif
+	{
+		unsigned char   digest[16];
+		memset(digest, 0, sizeof (digest));
 		if (outlevel >= O_MONITOR)
+#ifdef INDIMAIL
+			report(stdout, is_odmr ? GT_("ODMR> AUTH CRAM-MD5\n"): GT_("ESMTP> AUTH CRAM-MD5"));
+#else
 			report(stdout, GT_("ESMTP CRAM-MD5 Authentication...\n"));
+#endif
 		SockPrintf(sock, "AUTH CRAM-MD5\r\n");
-		SockRead(sock, smtp_response, sizeof(smtp_response) - 1);
-		strncpy(tmp, smtp_response, sizeof(tmp));
-		tmp[sizeof(tmp)-1] = '\0';
-
-		if (strncmp(tmp, "334 ", 4)) { /* Server rejects AUTH */
+		SockRead(sock, smtp_response, sizeof (smtp_response) - 1);
+		strncpy(tmp, smtp_response, sizeof (tmp));
+		tmp[sizeof (tmp) - 1] = '\0';
+#ifdef INDIMAIL
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR< %s") : GT_("ESMTP< %s"), (tmp));
+#endif
+		/*- Server rejects AUTH */
+		if (strncmp(tmp, "334 ", 4))
+		{
 			SMTP_auth_error(sock, GT_("Server rejected the AUTH command.\n"));
+#ifdef INDIMAIL
+			return (1);
+#else
 			return;
+#endif
 		}
 
 		p = strchr(tmp, ' ');
 		p++;
-		/* (hmh) from64tobits will not NULL-terminate strings! */
-		if (from64tobits(b64buf, p, sizeof(b64buf) - 1) <= 0) {
+		/*- (hmh) from64tobits will not NULL-terminate strings!  */
+		if (from64tobits(b64buf, p, sizeof (b64buf) - 1) <= 0)
+		{
 			SMTP_auth_error(sock, GT_("Bad base64 reply from server.\n"));
+#ifdef INDIMAIL
+			return (1);
+#else
 			return;
+#endif
 		}
 		if (outlevel >= O_DEBUG)
 			report(stdout, GT_("Challenge decoded: %s\n"), b64buf);
-		hmac_md5(password, strlen(password),
-			 b64buf, strlen(b64buf), digest, sizeof(digest));
-		snprintf(tmp, sizeof(tmp),
-		"%s %02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x",
-		username,  digest[0], digest[1], digest[2], digest[3],
-		digest[4], digest[5], digest[6], digest[7], digest[8],
-		digest[9], digest[10], digest[11], digest[12], digest[13],
-		digest[14], digest[15]);
-
+		hmac_md5(password, strlen(password), b64buf, strlen(b64buf), digest, sizeof (digest));
+		snprintf(tmp, sizeof (tmp), "%s %02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x", username, digest[0],
+				 digest[1], digest[2], digest[3], digest[4], digest[5], digest[6], digest[7], digest[8], digest[9], digest[10],
+				 digest[11], digest[12], digest[13], digest[14], digest[15]);
 		to64frombits(b64buf, tmp, strlen(tmp));
 		SockPrintf(sock, "%s\r\n", b64buf);
+#ifdef INDIMAIL
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR> %s\n") : GT_("ESMTP> %s\n"), (b64buf));
+		ok = SMTP_ok(sock, smtp_mode);
+#else
 		SMTP_ok(sock, smtp_mode);
-	}
-	else if (strstr(buf, "PLAIN")) {
-		int len;
+#endif
+#ifdef INDIMAIL
+	} else
+	if (strstr(buf, "PLAIN") || (ptr && *ptr && !strcmp(ptr, "PLAIN")))
+#else
+	} else
+	if (strstr(buf, "PLAIN"))
+#endif
+	{
+		int             len;
 		if (outlevel >= O_MONITOR)
+#ifdef INDIMAIL
+			report(stdout, is_odmr ? GT_("ODMR> AUTH PLAIN\n") : GT_("ESMTP> AUTH PLAIN\n"));
+#else
 			report(stdout, GT_("ESMTP PLAIN Authentication...\n"));
-		snprintf(tmp, sizeof(tmp), "^%s^%s", username, password);
-
+#endif
+		snprintf(tmp, sizeof (tmp), "^%s^%s", username, password);
 		len = strlen(tmp);
-		for (c = len - 1; c >= 0; c--)
-		{
+		for (c = len - 1; c >= 0; c--) {
 			if (tmp[c] == '^')
 				tmp[c] = '\0';
 		}
 		to64frombits(b64buf, tmp, len);
 		SockPrintf(sock, "AUTH PLAIN %s\r\n", b64buf);
-		SMTP_ok(sock, smtp_mode);
-	}
-	else if (strstr(buf, "LOGIN")) {
+#ifdef INDIMAIL
 		if (outlevel >= O_MONITOR)
-			report(stdout, GT_("ESMTP LOGIN Authentication...\n"));
-		SockPrintf(sock, "AUTH LOGIN\r\n");
+			report(stdout, is_odmr ? GT_("ODMR> %s\n") : GT_("ESMTP> %s\n"), (b64buf));
 		SockRead(sock, smtp_response, sizeof(smtp_response) - 1);
 		strncpy(tmp, smtp_response, sizeof(tmp));
-		tmp[sizeof(tmp)-1] = '\0';
+		tmp[sizeof(tmp) - 1] = '\0';
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR< %s") : GT_("SMTP< %s"), (tmp));
+		if (strncmp(tmp, "235 ", 4)) /*- Server rejects AUTH */
+		{
+			SMTP_auth_error(sock, GT_("Server rejected the AUTH command.\n"));
+			return (1);
 
-		if (strncmp(tmp, "334 ", 4)) { /* Server rejects AUTH */
+		}
+		ok = 0;
+#else
+		SMTP_ok(sock, smtp_mode);
+#endif
+#ifdef INDIMAIL
+	} else
+	if (strstr(buf, "LOGIN") || (ptr && *ptr && !strcmp(ptr, "LOGIN")))
+#else
+	} else
+	if (strstr(buf, "LOGIN"))
+#endif
+	{
+		if (outlevel >= O_MONITOR)
+#ifdef INDIMAIL
+			report(stdout, is_odmr ? GT_("ODMR> AUTH LOGIN\n") : GT_("ESMTP> AUTH LOGIN\n"));
+#else
+			report(stdout, GT_("ESMTP LOGIN Authentication...\n"));
+#endif
+		SockPrintf(sock, "AUTH LOGIN\r\n");
+		/*- Step 1 */
+		SockRead(sock, smtp_response, sizeof (smtp_response) - 1);
+		strncpy(tmp, smtp_response, sizeof (tmp));
+		tmp[sizeof (tmp) - 1] = '\0';
+#ifdef INDIMAIL
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR< %s") : GT_("ESMTP< %s"), (tmp));
+#endif
+		if (strncmp(tmp, "334 ", 4)) {	/* Server rejects AUTH */
 			SMTP_auth_error(sock, GT_("Server rejected the AUTH command.\n"));
+#ifdef INDIMAIL
+			return (1);
+#else
 			return;
+#endif
 		}
-
 		p = strchr(tmp, ' ');
 		p++;
-		if (from64tobits(b64buf, p, sizeof(b64buf) - 1) <= 0) {
+		if (from64tobits(b64buf, p, sizeof (b64buf) - 1) <= 0) {
 			SMTP_auth_error(sock, GT_("Bad base64 reply from server.\n"));
+#ifdef INDIMAIL
+			return (1);
+#else
 			return;
+#endif
 		}
+		/*- Step 2 */
 		to64frombits(b64buf, username, strlen(username));
-		SockPrintf(sock, "%s\r\n", b64buf);
-		SockRead(sock, smtp_response, sizeof(smtp_response) - 1);
-		strncpy(tmp, smtp_response, sizeof(tmp));
-		tmp[sizeof(tmp)-1] = '\0';
+		SockPrintf(sock, "%s\r\n", b64buf); /*- Username */
+#ifdef INDIMAIL
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR> %s\n") : GT_("ESMTP> %s\n"), (b64buf));
+#endif
+		SockRead(sock, smtp_response, sizeof (smtp_response) - 1);
+		strncpy(tmp, smtp_response, sizeof (tmp));
+		tmp[sizeof (tmp) - 1] = '\0';
+#ifdef INDIMAIL
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR< %s") : GT_("ESMTP< %s"), (tmp));
+		/*- Server rejects AUTH */
+		if (strncmp(tmp, "334 ", 4))
+		{
+			SMTP_auth_error(sock, GT_("Server rejected the AUTH command.\n"));
+			return (1);
+		}
+#endif
 		p = strchr(tmp, ' ');
 		if (!p) {
 			SMTP_auth_error(sock, GT_("Bad base64 reply from server.\n"));
+#ifdef INDIMAIL
+			return (1);
+#else
 			return;
+#endif
 		}
 		p++;
-		memset(b64buf, 0, sizeof(b64buf));
-		if (from64tobits(b64buf, p, sizeof(b64buf) - 1) <= 0) {
+		memset(b64buf, 0, sizeof (b64buf));
+		if (from64tobits(b64buf, p, sizeof (b64buf) - 1) <= 0) {
 			SMTP_auth_error(sock, GT_("Bad base64 reply from server.\n"));
+#ifdef INDIMAIL
+			return (1);
+#else
 			return;
+#endif
 		}
+		/*- Step 3 */
 		to64frombits(b64buf, password, strlen(password));
-		SockPrintf(sock, "%s\r\n", b64buf);
+		SockPrintf(sock, "%s\r\n", b64buf); /*- Password */
+#ifdef INDIMAIL
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR> %s\n") : GT_("ESMTP> %s\n"), (b64buf));
+		SockRead(sock, smtp_response, sizeof(smtp_response) - 1);
+		strncpy(tmp, smtp_response, sizeof(tmp));
+		tmp[sizeof(tmp) - 1] = '\0';
+		if (outlevel >= O_MONITOR)
+			report(stdout, is_odmr ? GT_("ODMR< %s") : GT_("ESMTP< %s"), (tmp));
+		/*- Server rejects AUTH */
+		if (strncmp(tmp, "235 ", 4))
+		{
+			SMTP_auth_error(sock, GT_("Server rejected the AUTH command.\n"));
+			return (1);
+		}
+		p = strchr(tmp, ' ');
+		if (!p)
+		{
+			SMTP_auth_error(sock, GT_("Bad base64 reply from server.\n"));
+			return (1);
+		}
+		ok = 0;
+#else
 		SMTP_ok(sock, smtp_mode);
+#endif
 	}
+#ifdef INDIMAIL
+	return (ok);
+#else
 	return;
+#endif
 }
 
-int SMTP_ehlo(int sock, char smtp_mode, const char *host, char *name, char *password, int *opt)
-/* send a "EHLO" message to the SMTP listener, return extension status bits */
+int
+SMTP_ehlo(int sock, char smtp_mode, const char *host, char *name, char *password, int *opt)
+/*
+ * send a "EHLO" message to the SMTP listener, return extension status bits 
+ */
 {
-  struct opt *hp;
-  char auth_response[511];
-
-  SockPrintf(sock,"%cHLO %s\r\n", (smtp_mode == 'S') ? 'E' : smtp_mode, host);
-  if (outlevel >= O_MONITOR)
-      report(stdout, "%cMTP> %cHLO %s\n", 
-	    smtp_mode, (smtp_mode == 'S') ? 'E' : smtp_mode, host);
+	struct opt     *hp;
+	char            auth_response[511];
 
-  *opt = 0;
-  while ((SockRead(sock, smtp_response, sizeof(smtp_response)-1)) != -1)
-  {
-      int  n = strlen(smtp_response);
+	SockPrintf(sock, "%cHLO %s\r\n", (smtp_mode == 'S') ? 'E' : smtp_mode, host);
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP> %cHLO %s\n", smtp_mode, (smtp_mode == 'S') ? 'E' : smtp_mode, host);
 
-      if (smtp_response[strlen(smtp_response)-1] == '\n')
-	  smtp_response[strlen(smtp_response)-1] = '\0';
-      if (smtp_response[strlen(smtp_response)-1] == '\r')
-	  smtp_response[strlen(smtp_response)-1] = '\0';
-      if (n < 4)
-	  return SM_ERROR;
-      smtp_response[n] = '\0';
-      if (outlevel >= O_MONITOR)
-	  report(stdout, "%cMTP< %s\n", smtp_mode, smtp_response);
-      for (hp = extensions; hp->name; hp++)
-	  if (!strncasecmp(hp->name, smtp_response+4, strlen(hp->name))) {
-	      *opt |= hp->value;
-	      if (strncmp(hp->name, "AUTH ", 5) == 0)
-		strncpy(auth_response, smtp_response, sizeof(auth_response));
-		auth_response[sizeof(auth_response)-1] = '\0';
-	  }
-      if ((smtp_response[0] == '1' || smtp_response[0] == '2' || smtp_response[0] == '3') && smtp_response[3] == ' ') {
-	  if (*opt & ESMTP_AUTH)
-		SMTP_auth(sock, smtp_mode, name, password, auth_response);
-	  return SM_OK;
-      }
-      else if (smtp_response[3] != '-')
-	  return SM_ERROR;
-  }
-  return SM_UNRECOVERABLE;
+	*opt = 0;
+	while ((SockRead(sock, smtp_response, sizeof (smtp_response) - 1)) != -1) {
+		int             n = strlen(smtp_response);
+
+		if (smtp_response[strlen(smtp_response) - 1] == '\n')
+			smtp_response[strlen(smtp_response) - 1] = '\0';
+		if (smtp_response[strlen(smtp_response) - 1] == '\r')
+			smtp_response[strlen(smtp_response) - 1] = '\0';
+		if (n < 4)
+			return SM_ERROR;
+		smtp_response[n] = '\0';
+		if (outlevel >= O_MONITOR)
+			report(stdout, "%cMTP< %s\n", smtp_mode, smtp_response);
+		for (hp = extensions; hp->name; hp++)
+			if (!strncasecmp(hp->name, smtp_response + 4, strlen(hp->name))) {
+				*opt |= hp->value;
+				if (strncmp(hp->name, "AUTH ", 5) == 0)
+					strncpy(auth_response, smtp_response, sizeof (auth_response));
+				auth_response[sizeof (auth_response) - 1] = '\0';
+			}
+		if ((smtp_response[0] == '1' || smtp_response[0] == '2' || smtp_response[0] == '3') && smtp_response[3] == ' ') {
+			if (*opt & ESMTP_AUTH)
+				SMTP_auth(sock, smtp_mode, name, password, auth_response);
+			return SM_OK;
+		} else if (smtp_response[3] != '-')
+			return SM_ERROR;
+	}
+	return SM_UNRECOVERABLE;
 }
 
-int SMTP_from(int sock, char smtp_mode, const char *from, const char *opts)
-/* send a "MAIL FROM:" message to the SMTP listener */
-{
-    int ok;
-    char buf[MSGBUFSIZE];
-
-    if (from[0]=='<')
-	snprintf(buf, sizeof(buf), "MAIL FROM:%s", from);
-    else
-	snprintf(buf, sizeof(buf), "MAIL FROM:<%s>", from);
-    if (opts)
-	snprintf(buf+strlen(buf), sizeof(buf)-strlen(buf), "%s", opts);
-    SockPrintf(sock,"%s\r\n", buf);
-    if (outlevel >= O_MONITOR)
-	report(stdout, "%cMTP> %s\n", smtp_mode, buf);
-    ok = SMTP_ok(sock, smtp_mode);
-    return ok;
+int
+SMTP_from(int sock, char smtp_mode, const char *from, const char *opts)
+/*
+ * send a "MAIL FROM:" message to the SMTP listener 
+ */
+{
+	int             ok;
+	char            buf[MSGBUFSIZE];
+
+	if (from[0] == '<')
+		snprintf(buf, sizeof (buf), "MAIL FROM:%s", from);
+	else
+		snprintf(buf, sizeof (buf), "MAIL FROM:<%s>", from);
+	if (opts)
+		snprintf(buf + strlen(buf), sizeof (buf) - strlen(buf), "%s", opts);
+	SockPrintf(sock, "%s\r\n", buf);
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP> %s\n", smtp_mode, buf);
+	ok = SMTP_ok(sock, smtp_mode);
+	return ok;
 }
 
-int SMTP_rcpt(int sock, char smtp_mode, const char *to)
-/* send a "RCPT TO:" message to the SMTP listener */
+int
+SMTP_rcpt(int sock, char smtp_mode, const char *to)
+/*
+ * send a "RCPT TO:" message to the SMTP listener 
+ */
 {
-  int ok;
+	int             ok;
 
-  SockPrintf(sock,"RCPT TO:<%s>\r\n", to);
-  if (outlevel >= O_MONITOR)
-      report(stdout, "%cMTP> RCPT TO:<%s>\n", smtp_mode, to);
-  ok = SMTP_ok(sock, smtp_mode);
-  return ok;
+	SockPrintf(sock, "RCPT TO:<%s>\r\n", to);
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP> RCPT TO:<%s>\n", smtp_mode, to);
+	ok = SMTP_ok(sock, smtp_mode);
+	return ok;
 }
 
-int SMTP_data(int sock, char smtp_mode)
-/* send a "DATA" message to the SMTP listener */
+int
+SMTP_data(int sock, char smtp_mode)
+/*
+ * send a "DATA" message to the SMTP listener 
+ */
 {
-  int ok;
+	int             ok;
 
-  SockPrintf(sock,"DATA\r\n");
-  if (outlevel >= O_MONITOR)
-      report(stdout, "%cMTP> DATA\n", smtp_mode);
-  ok = SMTP_ok(sock, smtp_mode);
-  return ok;
+	SockPrintf(sock, "DATA\r\n");
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP> DATA\n", smtp_mode);
+	ok = SMTP_ok(sock, smtp_mode);
+	return ok;
 }
 
-int SMTP_rset(int sock, char smtp_mode)
-/* send a "RSET" message to the SMTP listener */
+int
+SMTP_rset(int sock, char smtp_mode)
+/*
+ * send a "RSET" message to the SMTP listener 
+ */
 {
-  int ok;
+	int             ok;
 
-  SockPrintf(sock,"RSET\r\n");
-  if (outlevel >= O_MONITOR)
-      report(stdout, "%cMTP> RSET\n", smtp_mode);
-  ok = SMTP_ok(sock, smtp_mode);
-  return ok;
+	SockPrintf(sock, "RSET\r\n");
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP> RSET\n", smtp_mode);
+	ok = SMTP_ok(sock, smtp_mode);
+	return ok;
 }
 
-int SMTP_quit(int sock, char smtp_mode)
-/* send a "QUIT" message to the SMTP listener */
+int
+SMTP_quit(int sock, char smtp_mode)
+/*
+ * send a "QUIT" message to the SMTP listener 
+ */
 {
-  int ok;
+	int             ok;
 
-  SockPrintf(sock,"QUIT\r\n");
-  if (outlevel >= O_MONITOR)
-      report(stdout, "%cMTP> QUIT\n", smtp_mode);
-  ok = SMTP_ok(sock, smtp_mode);
-  return ok;
+	SockPrintf(sock, "QUIT\r\n");
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP> QUIT\n", smtp_mode);
+	ok = SMTP_ok(sock, smtp_mode);
+	return ok;
 }
 
-int SMTP_eom(int sock, char smtp_mode)
-/* send a message data terminator to the SMTP listener */
+int
+SMTP_eom(int sock, char smtp_mode)
+/*
+ * send a message data terminator to the SMTP listener 
+ */
 {
-  int ok;
+	int             ok;
 
-  SockPrintf(sock,".\r\n");
-  if (outlevel >= O_MONITOR)
-      report(stdout, "%cMTP>. (EOM)\n", smtp_mode);
+	SockPrintf(sock, ".\r\n");
+	if (outlevel >= O_MONITOR)
+		report(stdout, "%cMTP>. (EOM)\n", smtp_mode);
 
-  /* 
-   * When doing LMTP, must process many of these at the outer level. 
-   */
-  if (smtp_mode == 'S')
-      ok = SMTP_ok(sock, smtp_mode);
-  else
-      ok = SM_OK;
+/*
+ * When doing LMTP, must process many of these at the outer level. 
+ */
+	if (smtp_mode == 'S')
+		ok = SMTP_ok(sock, smtp_mode);
+	else
+		ok = SM_OK;
 
-  return ok;
+	return ok;
 }
 
-time_t last_smtp_ok = 0;
+time_t          last_smtp_ok = 0;
 
-int SMTP_ok(int sock, char smtp_mode)
-/* returns status of SMTP connection */
+int
+SMTP_ok(int sock, char smtp_mode)
+/*
+ * returns status of SMTP connection 
+ */
 {
-    SIGHANDLERTYPE alrmsave;
+	SIGHANDLERTYPE  alrmsave;
 
-    /* set an alarm for smtp ok */
-    alrmsave = set_signal_handler(SIGALRM, null_signal_handler);
-    set_timeout(mytimeout);
+/*
+ * set an alarm for smtp ok 
+ */
+	alrmsave = set_signal_handler(SIGALRM, null_signal_handler);
+	set_timeout(mytimeout);
 
-    while ((SockRead(sock, smtp_response, sizeof(smtp_response)-1)) != -1)
-    {
-	int n;
+	while ((SockRead(sock, smtp_response, sizeof (smtp_response) - 1)) != -1) {
+		int             n;
 
-	/* restore alarm */
-	set_timeout(0);
-	set_signal_handler(SIGALRM, alrmsave);
-
-	n = strlen(smtp_response);
-	if (n > 0 && smtp_response[n-1] == '\n')
-	    n--;
-	if (n > 0 && smtp_response[n-1] == '\r')
-	    n--;
-	smtp_response[n] = '\0';
-	if (outlevel >= O_MONITOR)
-	    report(stdout, "%cMTP< %s\n", smtp_mode, smtp_response);
-	if (n < 4 ||
-	    (smtp_response[3] != ' ' && smtp_response[3] != '-'))
-	{
-	    if (outlevel >= O_MONITOR)
-		report(stderr, GT_("smtp listener protocol error\n"));
-	    return SM_UNRECOVERABLE;
-	}
-
-	last_smtp_ok = time((time_t *) NULL);
+	/*
+	 * restore alarm 
+	 */
+		set_timeout(0);
+		set_signal_handler(SIGALRM, alrmsave);
+
+		n = strlen(smtp_response);
+		if (n > 0 && smtp_response[n - 1] == '\n')
+			n--;
+		if (n > 0 && smtp_response[n - 1] == '\r')
+			n--;
+		smtp_response[n] = '\0';
+		if (outlevel >= O_MONITOR)
+			report(stdout, "%cMTP< %s\n", smtp_mode, smtp_response);
+		if (n < 4 || (smtp_response[3] != ' ' && smtp_response[3] != '-')) {
+			if (outlevel >= O_MONITOR)
+				report(stderr, GT_("smtp listener protocol error\n"));
+			return SM_UNRECOVERABLE;
+		}
 
-	if ((smtp_response[0] == '1' || smtp_response[0] == '2' || smtp_response[0] == '3') &&
-	    smtp_response[3] == ' ')
-	    return SM_OK;
-	else if (smtp_response[3] != '-')
-	    return SM_ERROR;
+		last_smtp_ok = time((time_t *) NULL);
 
-	/* set an alarm for smtp ok */
-	set_signal_handler(SIGALRM, null_signal_handler);
-	set_timeout(mytimeout);
+		if ((smtp_response[0] == '1' || smtp_response[0] == '2' || smtp_response[0] == '3') && smtp_response[3] == ' ')
+			return SM_OK;
+		else if (smtp_response[3] != '-')
+			return SM_ERROR;
+
+	/*
+	 * set an alarm for smtp ok 
+	 */
+		set_signal_handler(SIGALRM, null_signal_handler);
+		set_timeout(mytimeout);
 
-    }
+	}
 
-    /* restore alarm */
-    set_timeout(0);
-    set_signal_handler(SIGALRM, alrmsave);
+/*
+ * restore alarm 
+ */
+	set_timeout(0);
+	set_signal_handler(SIGALRM, alrmsave);
 
-    if (outlevel >= O_MONITOR)
-	report(stderr, GT_("smtp listener protocol error\n"));
-    return SM_UNRECOVERABLE;
+	if (outlevel >= O_MONITOR)
+		report(stderr, GT_("smtp listener protocol error\n"));
+	return SM_UNRECOVERABLE;
 }
 
-/* smtp.c ends here */
+/*
+ * smtp.c ends here 
+ */
diff -Naur Fetchmail-6.3.9/writefifo.c fetchmail-6.3.9/writefifo.c
--- Fetchmail-6.3.9/writefifo.c	1970-01-01 05:30:00.000000000 +0530
+++ fetchmail-6.3.9/writefifo.c	2009-02-07 13:23:21.000000000 +0530
@@ -0,0 +1,33 @@
+/*
+ * $Log: writefifo.c,v $
+ * Revision 1.1  2003-12-13 16:05:40+05:30  Cprogrammer
+ * Initial revision
+ *
+ */
+#include <stdio.h>
+#include <fcntl.h>
+#include <errno.h>
+
+int
+main(int argc, char **argv)
+{
+	int             fd;
+
+	if (argc != 2)
+	{
+		fprintf(stderr, "writefifo filename\n");
+		return (1);
+	}
+	if ((fd = open(argv[1], O_WRONLY | O_NDELAY)) == -1)
+	{
+		fprintf(stderr, "open: %s: %s\n", argv[1], strerror(errno));
+		return (1);
+	}
+	if (write(fd, "", 1) == -1)
+	{
+		fprintf(stderr, "write: %s: %s\n", argv[1], strerror(errno));
+		return (1);
+	}
+	close(fd);
+	return (0);
+}
diff -Naur Fetchmail-6.3.9/aclocal.m4 fetchmail-6.3.9/aclocal.m4
--- Fetchmail-6.3.9/aclocal.m4	2009-06-23 15:06:56.000000000 +0530
+++ fetchmail-6.3.9/aclocal.m4	2009-06-23 15:07:17.000000000 +0530
@@ -1,7 +1,7 @@
-# generated automatically by aclocal 1.10.1 -*- Autoconf -*-
+# generated automatically by aclocal 1.11 -*- Autoconf -*-
 
 # Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2007, 2008  Free Software Foundation, Inc.
+# 2005, 2006, 2007, 2008, 2009  Free Software Foundation, Inc.
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -13,13 +13,2210 @@
 
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
-m4_if(AC_AUTOCONF_VERSION, [2.61],,
-[m4_warning([this file was generated for autoconf 2.61.
+m4_if(m4_defn([AC_AUTOCONF_VERSION]), [2.63],,
+[m4_warning([this file was generated for autoconf 2.63.
 You have another version of autoconf.  It may work, but is not guaranteed to.
 If you have problems, you may need to regenerate the build system entirely.
 To do so, use the procedure documented by the package, typically `autoreconf'.])])
 
-# Copyright (C) 2002, 2003, 2005, 2006, 2007  Free Software Foundation, Inc.
+# gettext.m4 serial 60 (gettext-0.17)
+dnl Copyright (C) 1995-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+dnl Authors:
+dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.
+dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2006.
+
+dnl Macro to add for using GNU gettext.
+
+dnl Usage: AM_GNU_GETTEXT([INTLSYMBOL], [NEEDSYMBOL], [INTLDIR]).
+dnl INTLSYMBOL can be one of 'external', 'no-libtool', 'use-libtool'. The
+dnl    default (if it is not specified or empty) is 'no-libtool'.
+dnl    INTLSYMBOL should be 'external' for packages with no intl directory,
+dnl    and 'no-libtool' or 'use-libtool' for packages with an intl directory.
+dnl    If INTLSYMBOL is 'use-libtool', then a libtool library
+dnl    $(top_builddir)/intl/libintl.la will be created (shared and/or static,
+dnl    depending on --{enable,disable}-{shared,static} and on the presence of
+dnl    AM-DISABLE-SHARED). If INTLSYMBOL is 'no-libtool', a static library
+dnl    $(top_builddir)/intl/libintl.a will be created.
+dnl If NEEDSYMBOL is specified and is 'need-ngettext', then GNU gettext
+dnl    implementations (in libc or libintl) without the ngettext() function
+dnl    will be ignored.  If NEEDSYMBOL is specified and is
+dnl    'need-formatstring-macros', then GNU gettext implementations that don't
+dnl    support the ISO C 99 <inttypes.h> formatstring macros will be ignored.
+dnl INTLDIR is used to find the intl libraries.  If empty,
+dnl    the value `$(top_builddir)/intl/' is used.
+dnl
+dnl The result of the configuration is one of three cases:
+dnl 1) GNU gettext, as included in the intl subdirectory, will be compiled
+dnl    and used.
+dnl    Catalog format: GNU --> install in $(datadir)
+dnl    Catalog extension: .mo after installation, .gmo in source tree
+dnl 2) GNU gettext has been found in the system's C library.
+dnl    Catalog format: GNU --> install in $(datadir)
+dnl    Catalog extension: .mo after installation, .gmo in source tree
+dnl 3) No internationalization, always use English msgid.
+dnl    Catalog format: none
+dnl    Catalog extension: none
+dnl If INTLSYMBOL is 'external', only cases 2 and 3 can occur.
+dnl The use of .gmo is historical (it was needed to avoid overwriting the
+dnl GNU format catalogs when building on a platform with an X/Open gettext),
+dnl but we keep it in order not to force irrelevant filename changes on the
+dnl maintainers.
+dnl
+AC_DEFUN([AM_GNU_GETTEXT],
+[
+  dnl Argument checking.
+  ifelse([$1], [], , [ifelse([$1], [external], , [ifelse([$1], [no-libtool], , [ifelse([$1], [use-libtool], ,
+    [errprint([ERROR: invalid first argument to AM_GNU_GETTEXT
+])])])])])
+  ifelse([$2], [], , [ifelse([$2], [need-ngettext], , [ifelse([$2], [need-formatstring-macros], ,
+    [errprint([ERROR: invalid second argument to AM_GNU_GETTEXT
+])])])])
+  define([gt_included_intl],
+    ifelse([$1], [external],
+      ifdef([AM_GNU_GETTEXT_][INTL_SUBDIR], [yes], [no]),
+      [yes]))
+  define([gt_libtool_suffix_prefix], ifelse([$1], [use-libtool], [l], []))
+  gt_NEEDS_INIT
+  AM_GNU_GETTEXT_NEED([$2])
+
+  AC_REQUIRE([AM_PO_SUBDIRS])dnl
+  ifelse(gt_included_intl, yes, [
+    AC_REQUIRE([AM_INTL_SUBDIR])dnl
+  ])
+
+  dnl Prerequisites of AC_LIB_LINKFLAGS_BODY.
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  AC_REQUIRE([AC_LIB_RPATH])
+
+  dnl Sometimes libintl requires libiconv, so first search for libiconv.
+  dnl Ideally we would do this search only after the
+  dnl      if test "$USE_NLS" = "yes"; then
+  dnl        if { eval "gt_val=\$$gt_func_gnugettext_libc"; test "$gt_val" != "yes"; }; then
+  dnl tests. But if configure.in invokes AM_ICONV after AM_GNU_GETTEXT
+  dnl the configure script would need to contain the same shell code
+  dnl again, outside any 'if'. There are two solutions:
+  dnl - Invoke AM_ICONV_LINKFLAGS_BODY here, outside any 'if'.
+  dnl - Control the expansions in more detail using AC_PROVIDE_IFELSE.
+  dnl Since AC_PROVIDE_IFELSE is only in autoconf >= 2.52 and not
+  dnl documented, we avoid it.
+  ifelse(gt_included_intl, yes, , [
+    AC_REQUIRE([AM_ICONV_LINKFLAGS_BODY])
+  ])
+
+  dnl Sometimes, on MacOS X, libintl requires linking with CoreFoundation.
+  gt_INTL_MACOSX
+
+  dnl Set USE_NLS.
+  AC_REQUIRE([AM_NLS])
+
+  ifelse(gt_included_intl, yes, [
+    BUILD_INCLUDED_LIBINTL=no
+    USE_INCLUDED_LIBINTL=no
+  ])
+  LIBINTL=
+  LTLIBINTL=
+  POSUB=
+
+  dnl Add a version number to the cache macros.
+  case " $gt_needs " in
+    *" need-formatstring-macros "*) gt_api_version=3 ;;
+    *" need-ngettext "*) gt_api_version=2 ;;
+    *) gt_api_version=1 ;;
+  esac
+  gt_func_gnugettext_libc="gt_cv_func_gnugettext${gt_api_version}_libc"
+  gt_func_gnugettext_libintl="gt_cv_func_gnugettext${gt_api_version}_libintl"
+
+  dnl If we use NLS figure out what method
+  if test "$USE_NLS" = "yes"; then
+    gt_use_preinstalled_gnugettext=no
+    ifelse(gt_included_intl, yes, [
+      AC_MSG_CHECKING([whether included gettext is requested])
+      AC_ARG_WITH(included-gettext,
+        [  --with-included-gettext use the GNU gettext library included here],
+        nls_cv_force_use_gnu_gettext=$withval,
+        nls_cv_force_use_gnu_gettext=no)
+      AC_MSG_RESULT($nls_cv_force_use_gnu_gettext)
+
+      nls_cv_use_gnu_gettext="$nls_cv_force_use_gnu_gettext"
+      if test "$nls_cv_force_use_gnu_gettext" != "yes"; then
+    ])
+        dnl User does not insist on using GNU NLS library.  Figure out what
+        dnl to use.  If GNU gettext is available we use this.  Else we have
+        dnl to fall back to GNU NLS library.
+
+        if test $gt_api_version -ge 3; then
+          gt_revision_test_code='
+#ifndef __GNU_GETTEXT_SUPPORTED_REVISION
+#define __GNU_GETTEXT_SUPPORTED_REVISION(major) ((major) == 0 ? 0 : -1)
+#endif
+changequote(,)dnl
+typedef int array [2 * (__GNU_GETTEXT_SUPPORTED_REVISION(0) >= 1) - 1];
+changequote([,])dnl
+'
+        else
+          gt_revision_test_code=
+        fi
+        if test $gt_api_version -ge 2; then
+          gt_expression_test_code=' + * ngettext ("", "", 0)'
+        else
+          gt_expression_test_code=
+        fi
+
+        AC_CACHE_CHECK([for GNU gettext in libc], [$gt_func_gnugettext_libc],
+         [AC_TRY_LINK([#include <libintl.h>
+$gt_revision_test_code
+extern int _nl_msg_cat_cntr;
+extern int *_nl_domain_bindings;],
+            [bindtextdomain ("", "");
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_domain_bindings],
+            [eval "$gt_func_gnugettext_libc=yes"],
+            [eval "$gt_func_gnugettext_libc=no"])])
+
+        if { eval "gt_val=\$$gt_func_gnugettext_libc"; test "$gt_val" != "yes"; }; then
+          dnl Sometimes libintl requires libiconv, so first search for libiconv.
+          ifelse(gt_included_intl, yes, , [
+            AM_ICONV_LINK
+          ])
+          dnl Search for libintl and define LIBINTL, LTLIBINTL and INCINTL
+          dnl accordingly. Don't use AC_LIB_LINKFLAGS_BODY([intl],[iconv])
+          dnl because that would add "-liconv" to LIBINTL and LTLIBINTL
+          dnl even if libiconv doesn't exist.
+          AC_LIB_LINKFLAGS_BODY([intl])
+          AC_CACHE_CHECK([for GNU gettext in libintl],
+            [$gt_func_gnugettext_libintl],
+           [gt_save_CPPFLAGS="$CPPFLAGS"
+            CPPFLAGS="$CPPFLAGS $INCINTL"
+            gt_save_LIBS="$LIBS"
+            LIBS="$LIBS $LIBINTL"
+            dnl Now see whether libintl exists and does not depend on libiconv.
+            AC_TRY_LINK([#include <libintl.h>
+$gt_revision_test_code
+extern int _nl_msg_cat_cntr;
+extern
+#ifdef __cplusplus
+"C"
+#endif
+const char *_nl_expand_alias (const char *);],
+              [bindtextdomain ("", "");
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_expand_alias ("")],
+              [eval "$gt_func_gnugettext_libintl=yes"],
+              [eval "$gt_func_gnugettext_libintl=no"])
+            dnl Now see whether libintl exists and depends on libiconv.
+            if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" != yes; } && test -n "$LIBICONV"; then
+              LIBS="$LIBS $LIBICONV"
+              AC_TRY_LINK([#include <libintl.h>
+$gt_revision_test_code
+extern int _nl_msg_cat_cntr;
+extern
+#ifdef __cplusplus
+"C"
+#endif
+const char *_nl_expand_alias (const char *);],
+                [bindtextdomain ("", "");
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_expand_alias ("")],
+               [LIBINTL="$LIBINTL $LIBICONV"
+                LTLIBINTL="$LTLIBINTL $LTLIBICONV"
+                eval "$gt_func_gnugettext_libintl=yes"
+               ])
+            fi
+            CPPFLAGS="$gt_save_CPPFLAGS"
+            LIBS="$gt_save_LIBS"])
+        fi
+
+        dnl If an already present or preinstalled GNU gettext() is found,
+        dnl use it.  But if this macro is used in GNU gettext, and GNU
+        dnl gettext is already preinstalled in libintl, we update this
+        dnl libintl.  (Cf. the install rule in intl/Makefile.in.)
+        if { eval "gt_val=\$$gt_func_gnugettext_libc"; test "$gt_val" = "yes"; } \
+           || { { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; } \
+                && test "$PACKAGE" != gettext-runtime \
+                && test "$PACKAGE" != gettext-tools; }; then
+          gt_use_preinstalled_gnugettext=yes
+        else
+          dnl Reset the values set by searching for libintl.
+          LIBINTL=
+          LTLIBINTL=
+          INCINTL=
+        fi
+
+    ifelse(gt_included_intl, yes, [
+        if test "$gt_use_preinstalled_gnugettext" != "yes"; then
+          dnl GNU gettext is not found in the C library.
+          dnl Fall back on included GNU gettext library.
+          nls_cv_use_gnu_gettext=yes
+        fi
+      fi
+
+      if test "$nls_cv_use_gnu_gettext" = "yes"; then
+        dnl Mark actions used to generate GNU NLS library.
+        BUILD_INCLUDED_LIBINTL=yes
+        USE_INCLUDED_LIBINTL=yes
+        LIBINTL="ifelse([$3],[],\${top_builddir}/intl,[$3])/libintl.[]gt_libtool_suffix_prefix[]a $LIBICONV $LIBTHREAD"
+        LTLIBINTL="ifelse([$3],[],\${top_builddir}/intl,[$3])/libintl.[]gt_libtool_suffix_prefix[]a $LTLIBICONV $LTLIBTHREAD"
+        LIBS=`echo " $LIBS " | sed -e 's/ -lintl / /' -e 's/^ //' -e 's/ $//'`
+      fi
+
+      CATOBJEXT=
+      if test "$gt_use_preinstalled_gnugettext" = "yes" \
+         || test "$nls_cv_use_gnu_gettext" = "yes"; then
+        dnl Mark actions to use GNU gettext tools.
+        CATOBJEXT=.gmo
+      fi
+    ])
+
+    if test -n "$INTL_MACOSX_LIBS"; then
+      if test "$gt_use_preinstalled_gnugettext" = "yes" \
+         || test "$nls_cv_use_gnu_gettext" = "yes"; then
+        dnl Some extra flags are needed during linking.
+        LIBINTL="$LIBINTL $INTL_MACOSX_LIBS"
+        LTLIBINTL="$LTLIBINTL $INTL_MACOSX_LIBS"
+      fi
+    fi
+
+    if test "$gt_use_preinstalled_gnugettext" = "yes" \
+       || test "$nls_cv_use_gnu_gettext" = "yes"; then
+      AC_DEFINE(ENABLE_NLS, 1,
+        [Define to 1 if translation of program messages to the user's native language
+   is requested.])
+    else
+      USE_NLS=no
+    fi
+  fi
+
+  AC_MSG_CHECKING([whether to use NLS])
+  AC_MSG_RESULT([$USE_NLS])
+  if test "$USE_NLS" = "yes"; then
+    AC_MSG_CHECKING([where the gettext function comes from])
+    if test "$gt_use_preinstalled_gnugettext" = "yes"; then
+      if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; }; then
+        gt_source="external libintl"
+      else
+        gt_source="libc"
+      fi
+    else
+      gt_source="included intl directory"
+    fi
+    AC_MSG_RESULT([$gt_source])
+  fi
+
+  if test "$USE_NLS" = "yes"; then
+
+    if test "$gt_use_preinstalled_gnugettext" = "yes"; then
+      if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; }; then
+        AC_MSG_CHECKING([how to link with libintl])
+        AC_MSG_RESULT([$LIBINTL])
+        AC_LIB_APPENDTOVAR([CPPFLAGS], [$INCINTL])
+      fi
+
+      dnl For backward compatibility. Some packages may be using this.
+      AC_DEFINE(HAVE_GETTEXT, 1,
+       [Define if the GNU gettext() function is already present or preinstalled.])
+      AC_DEFINE(HAVE_DCGETTEXT, 1,
+       [Define if the GNU dcgettext() function is already present or preinstalled.])
+    fi
+
+    dnl We need to process the po/ directory.
+    POSUB=po
+  fi
+
+  ifelse(gt_included_intl, yes, [
+    dnl If this is used in GNU gettext we have to set BUILD_INCLUDED_LIBINTL
+    dnl to 'yes' because some of the testsuite requires it.
+    if test "$PACKAGE" = gettext-runtime || test "$PACKAGE" = gettext-tools; then
+      BUILD_INCLUDED_LIBINTL=yes
+    fi
+
+    dnl Make all variables we use known to autoconf.
+    AC_SUBST(BUILD_INCLUDED_LIBINTL)
+    AC_SUBST(USE_INCLUDED_LIBINTL)
+    AC_SUBST(CATOBJEXT)
+
+    dnl For backward compatibility. Some configure.ins may be using this.
+    nls_cv_header_intl=
+    nls_cv_header_libgt=
+
+    dnl For backward compatibility. Some Makefiles may be using this.
+    DATADIRNAME=share
+    AC_SUBST(DATADIRNAME)
+
+    dnl For backward compatibility. Some Makefiles may be using this.
+    INSTOBJEXT=.mo
+    AC_SUBST(INSTOBJEXT)
+
+    dnl For backward compatibility. Some Makefiles may be using this.
+    GENCAT=gencat
+    AC_SUBST(GENCAT)
+
+    dnl For backward compatibility. Some Makefiles may be using this.
+    INTLOBJS=
+    if test "$USE_INCLUDED_LIBINTL" = yes; then
+      INTLOBJS="\$(GETTOBJS)"
+    fi
+    AC_SUBST(INTLOBJS)
+
+    dnl Enable libtool support if the surrounding package wishes it.
+    INTL_LIBTOOL_SUFFIX_PREFIX=gt_libtool_suffix_prefix
+    AC_SUBST(INTL_LIBTOOL_SUFFIX_PREFIX)
+  ])
+
+  dnl For backward compatibility. Some Makefiles may be using this.
+  INTLLIBS="$LIBINTL"
+  AC_SUBST(INTLLIBS)
+
+  dnl Make all documented variables known to autoconf.
+  AC_SUBST(LIBINTL)
+  AC_SUBST(LTLIBINTL)
+  AC_SUBST(POSUB)
+])
+
+
+dnl gt_NEEDS_INIT ensures that the gt_needs variable is initialized.
+m4_define([gt_NEEDS_INIT],
+[
+  m4_divert_text([DEFAULTS], [gt_needs=])
+  m4_define([gt_NEEDS_INIT], [])
+])
+
+
+dnl Usage: AM_GNU_GETTEXT_NEED([NEEDSYMBOL])
+AC_DEFUN([AM_GNU_GETTEXT_NEED],
+[
+  m4_divert_text([INIT_PREPARE], [gt_needs="$gt_needs $1"])
+])
+
+
+dnl Usage: AM_GNU_GETTEXT_VERSION([gettext-version])
+AC_DEFUN([AM_GNU_GETTEXT_VERSION], [])
+
+# iconv.m4 serial AM6 (gettext-0.17)
+dnl Copyright (C) 2000-2002, 2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+AC_DEFUN([AM_ICONV_LINKFLAGS_BODY],
+[
+  dnl Prerequisites of AC_LIB_LINKFLAGS_BODY.
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  AC_REQUIRE([AC_LIB_RPATH])
+
+  dnl Search for libiconv and define LIBICONV, LTLIBICONV and INCICONV
+  dnl accordingly.
+  AC_LIB_LINKFLAGS_BODY([iconv])
+])
+
+AC_DEFUN([AM_ICONV_LINK],
+[
+  dnl Some systems have iconv in libc, some have it in libiconv (OSF/1 and
+  dnl those with the standalone portable GNU libiconv installed).
+  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles
+
+  dnl Search for libiconv and define LIBICONV, LTLIBICONV and INCICONV
+  dnl accordingly.
+  AC_REQUIRE([AM_ICONV_LINKFLAGS_BODY])
+
+  dnl Add $INCICONV to CPPFLAGS before performing the following checks,
+  dnl because if the user has installed libiconv and not disabled its use
+  dnl via --without-libiconv-prefix, he wants to use it. The first
+  dnl AC_TRY_LINK will then fail, the second AC_TRY_LINK will succeed.
+  am_save_CPPFLAGS="$CPPFLAGS"
+  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INCICONV])
+
+  AC_CACHE_CHECK([for iconv], am_cv_func_iconv, [
+    am_cv_func_iconv="no, consider installing GNU libiconv"
+    am_cv_lib_iconv=no
+    AC_TRY_LINK([#include <stdlib.h>
+#include <iconv.h>],
+      [iconv_t cd = iconv_open("","");
+       iconv(cd,NULL,NULL,NULL,NULL);
+       iconv_close(cd);],
+      am_cv_func_iconv=yes)
+    if test "$am_cv_func_iconv" != yes; then
+      am_save_LIBS="$LIBS"
+      LIBS="$LIBS $LIBICONV"
+      AC_TRY_LINK([#include <stdlib.h>
+#include <iconv.h>],
+        [iconv_t cd = iconv_open("","");
+         iconv(cd,NULL,NULL,NULL,NULL);
+         iconv_close(cd);],
+        am_cv_lib_iconv=yes
+        am_cv_func_iconv=yes)
+      LIBS="$am_save_LIBS"
+    fi
+  ])
+  if test "$am_cv_func_iconv" = yes; then
+    AC_CACHE_CHECK([for working iconv], am_cv_func_iconv_works, [
+      dnl This tests against bugs in AIX 5.1 and HP-UX 11.11.
+      am_save_LIBS="$LIBS"
+      if test $am_cv_lib_iconv = yes; then
+        LIBS="$LIBS $LIBICONV"
+      fi
+      AC_TRY_RUN([
+#include <iconv.h>
+#include <string.h>
+int main ()
+{
+  /* Test against AIX 5.1 bug: Failures are not distinguishable from successful
+     returns.  */
+  {
+    iconv_t cd_utf8_to_88591 = iconv_open ("ISO8859-1", "UTF-8");
+    if (cd_utf8_to_88591 != (iconv_t)(-1))
+      {
+        static const char input[] = "\342\202\254"; /* EURO SIGN */
+        char buf[10];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_utf8_to_88591,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if (res == 0)
+          return 1;
+      }
+  }
+#if 0 /* This bug could be worked around by the caller.  */
+  /* Test against HP-UX 11.11 bug: Positive return value instead of 0.  */
+  {
+    iconv_t cd_88591_to_utf8 = iconv_open ("utf8", "iso88591");
+    if (cd_88591_to_utf8 != (iconv_t)(-1))
+      {
+        static const char input[] = "\304rger mit b\366sen B\374bchen ohne Augenma\337";
+        char buf[50];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_88591_to_utf8,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if ((int)res > 0)
+          return 1;
+      }
+  }
+#endif
+  /* Test against HP-UX 11.11 bug: No converter from EUC-JP to UTF-8 is
+     provided.  */
+  if (/* Try standardized names.  */
+      iconv_open ("UTF-8", "EUC-JP") == (iconv_t)(-1)
+      /* Try IRIX, OSF/1 names.  */
+      && iconv_open ("UTF-8", "eucJP") == (iconv_t)(-1)
+      /* Try AIX names.  */
+      && iconv_open ("UTF-8", "IBM-eucJP") == (iconv_t)(-1)
+      /* Try HP-UX names.  */
+      && iconv_open ("utf8", "eucJP") == (iconv_t)(-1))
+    return 1;
+  return 0;
+}], [am_cv_func_iconv_works=yes], [am_cv_func_iconv_works=no],
+        [case "$host_os" in
+           aix* | hpux*) am_cv_func_iconv_works="guessing no" ;;
+           *)            am_cv_func_iconv_works="guessing yes" ;;
+         esac])
+      LIBS="$am_save_LIBS"
+    ])
+    case "$am_cv_func_iconv_works" in
+      *no) am_func_iconv=no am_cv_lib_iconv=no ;;
+      *)   am_func_iconv=yes ;;
+    esac
+  else
+    am_func_iconv=no am_cv_lib_iconv=no
+  fi
+  if test "$am_func_iconv" = yes; then
+    AC_DEFINE(HAVE_ICONV, 1,
+      [Define if you have the iconv() function and it works.])
+  fi
+  if test "$am_cv_lib_iconv" = yes; then
+    AC_MSG_CHECKING([how to link with libiconv])
+    AC_MSG_RESULT([$LIBICONV])
+  else
+    dnl If $LIBICONV didn't lead to a usable library, we don't need $INCICONV
+    dnl either.
+    CPPFLAGS="$am_save_CPPFLAGS"
+    LIBICONV=
+    LTLIBICONV=
+  fi
+  AC_SUBST(LIBICONV)
+  AC_SUBST(LTLIBICONV)
+])
+
+AC_DEFUN([AM_ICONV],
+[
+  AM_ICONV_LINK
+  if test "$am_cv_func_iconv" = yes; then
+    AC_MSG_CHECKING([for iconv declaration])
+    AC_CACHE_VAL(am_cv_proto_iconv, [
+      AC_TRY_COMPILE([
+#include <stdlib.h>
+#include <iconv.h>
+extern
+#ifdef __cplusplus
+"C"
+#endif
+#if defined(__STDC__) || defined(__cplusplus)
+size_t iconv (iconv_t cd, char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);
+#else
+size_t iconv();
+#endif
+], [], am_cv_proto_iconv_arg1="", am_cv_proto_iconv_arg1="const")
+      am_cv_proto_iconv="extern size_t iconv (iconv_t cd, $am_cv_proto_iconv_arg1 char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);"])
+    am_cv_proto_iconv=`echo "[$]am_cv_proto_iconv" | tr -s ' ' | sed -e 's/( /(/'`
+    AC_MSG_RESULT([$]{ac_t:-
+         }[$]am_cv_proto_iconv)
+    AC_DEFINE_UNQUOTED(ICONV_CONST, $am_cv_proto_iconv_arg1,
+      [Define as const if the declaration of iconv() needs const.])
+  fi
+])
+
+# intlmacosx.m4 serial 1 (gettext-0.17)
+dnl Copyright (C) 2004-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+dnl Checks for special options needed on MacOS X.
+dnl Defines INTL_MACOSX_LIBS.
+AC_DEFUN([gt_INTL_MACOSX],
+[
+  dnl Check for API introduced in MacOS X 10.2.
+  AC_CACHE_CHECK([for CFPreferencesCopyAppValue],
+    gt_cv_func_CFPreferencesCopyAppValue,
+    [gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     AC_TRY_LINK([#include <CoreFoundation/CFPreferences.h>],
+       [CFPreferencesCopyAppValue(NULL, NULL)],
+       [gt_cv_func_CFPreferencesCopyAppValue=yes],
+       [gt_cv_func_CFPreferencesCopyAppValue=no])
+     LIBS="$gt_save_LIBS"])
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes; then
+    AC_DEFINE([HAVE_CFPREFERENCESCOPYAPPVALUE], 1,
+      [Define to 1 if you have the MacOS X function CFPreferencesCopyAppValue in the CoreFoundation framework.])
+  fi
+  dnl Check for API introduced in MacOS X 10.3.
+  AC_CACHE_CHECK([for CFLocaleCopyCurrent], gt_cv_func_CFLocaleCopyCurrent,
+    [gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     AC_TRY_LINK([#include <CoreFoundation/CFLocale.h>], [CFLocaleCopyCurrent();],
+       [gt_cv_func_CFLocaleCopyCurrent=yes],
+       [gt_cv_func_CFLocaleCopyCurrent=no])
+     LIBS="$gt_save_LIBS"])
+  if test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+    AC_DEFINE([HAVE_CFLOCALECOPYCURRENT], 1,
+      [Define to 1 if you have the MacOS X function CFLocaleCopyCurrent in the CoreFoundation framework.])
+  fi
+  INTL_MACOSX_LIBS=
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes || test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+    INTL_MACOSX_LIBS="-Wl,-framework -Wl,CoreFoundation"
+  fi
+  AC_SUBST([INTL_MACOSX_LIBS])
+])
+
+# lib-ld.m4 serial 3 (gettext-0.13)
+dnl Copyright (C) 1996-2003 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl Subroutines of libtool.m4,
+dnl with replacements s/AC_/AC_LIB/ and s/lt_cv/acl_cv/ to avoid collision
+dnl with libtool.m4.
+
+dnl From libtool-1.4. Sets the variable with_gnu_ld to yes or no.
+AC_DEFUN([AC_LIB_PROG_LD_GNU],
+[AC_CACHE_CHECK([if the linker ($LD) is GNU ld], acl_cv_prog_gnu_ld,
+[# I'd rather use --version here, but apparently some GNU ld's only accept -v.
+case `$LD -v 2>&1 </dev/null` in
+*GNU* | *'with BFD'*)
+  acl_cv_prog_gnu_ld=yes ;;
+*)
+  acl_cv_prog_gnu_ld=no ;;
+esac])
+with_gnu_ld=$acl_cv_prog_gnu_ld
+])
+
+dnl From libtool-1.4. Sets the variable LD.
+AC_DEFUN([AC_LIB_PROG_LD],
+[AC_ARG_WITH(gnu-ld,
+[  --with-gnu-ld           assume the C compiler uses GNU ld [default=no]],
+test "$withval" = no || with_gnu_ld=yes, with_gnu_ld=no)
+AC_REQUIRE([AC_PROG_CC])dnl
+AC_REQUIRE([AC_CANONICAL_HOST])dnl
+# Prepare PATH_SEPARATOR.
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+ac_prog=ld
+if test "$GCC" = yes; then
+  # Check if gcc -print-prog-name=ld gives a path.
+  AC_MSG_CHECKING([for ld used by GCC])
+  case $host in
+  *-*-mingw*)
+    # gcc leaves a trailing carriage return which upsets mingw
+    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
+  *)
+    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
+  esac
+  case $ac_prog in
+    # Accept absolute paths.
+    [[\\/]* | [A-Za-z]:[\\/]*)]
+      [re_direlt='/[^/][^/]*/\.\./']
+      # Canonicalize the path of ld
+      ac_prog=`echo $ac_prog| sed 's%\\\\%/%g'`
+      while echo $ac_prog | grep "$re_direlt" > /dev/null 2>&1; do
+	ac_prog=`echo $ac_prog| sed "s%$re_direlt%/%"`
+      done
+      test -z "$LD" && LD="$ac_prog"
+      ;;
+  "")
+    # If it fails, then pretend we aren't using GCC.
+    ac_prog=ld
+    ;;
+  *)
+    # If it is relative, then search for the first ld in PATH.
+    with_gnu_ld=unknown
+    ;;
+  esac
+elif test "$with_gnu_ld" = yes; then
+  AC_MSG_CHECKING([for GNU ld])
+else
+  AC_MSG_CHECKING([for non-GNU ld])
+fi
+AC_CACHE_VAL(acl_cv_path_LD,
+[if test -z "$LD"; then
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}${PATH_SEPARATOR-:}"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
+      acl_cv_path_LD="$ac_dir/$ac_prog"
+      # Check to see if the program is GNU ld.  I'd rather use --version,
+      # but apparently some GNU ld's only accept -v.
+      # Break only if it was the GNU/non-GNU ld that we prefer.
+      case `"$acl_cv_path_LD" -v 2>&1 < /dev/null` in
+      *GNU* | *'with BFD'*)
+	test "$with_gnu_ld" != no && break ;;
+      *)
+	test "$with_gnu_ld" != yes && break ;;
+      esac
+    fi
+  done
+  IFS="$ac_save_ifs"
+else
+  acl_cv_path_LD="$LD" # Let the user override the test with a path.
+fi])
+LD="$acl_cv_path_LD"
+if test -n "$LD"; then
+  AC_MSG_RESULT($LD)
+else
+  AC_MSG_RESULT(no)
+fi
+test -z "$LD" && AC_MSG_ERROR([no acceptable ld found in \$PATH])
+AC_LIB_PROG_LD_GNU
+])
+
+# lib-link.m4 serial 13 (gettext-0.17)
+dnl Copyright (C) 2001-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+AC_PREREQ(2.54)
+
+dnl AC_LIB_LINKFLAGS(name [, dependencies]) searches for libname and
+dnl the libraries corresponding to explicit and implicit dependencies.
+dnl Sets and AC_SUBSTs the LIB${NAME} and LTLIB${NAME} variables and
+dnl augments the CPPFLAGS variable.
+dnl Sets and AC_SUBSTs the LIB${NAME}_PREFIX variable to nonempty if libname
+dnl was found in ${LIB${NAME}_PREFIX}/$acl_libdirstem.
+AC_DEFUN([AC_LIB_LINKFLAGS],
+[
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  AC_REQUIRE([AC_LIB_RPATH])
+  define([Name],[translit([$1],[./-], [___])])
+  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],
+                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])
+  AC_CACHE_CHECK([how to link with lib[]$1], [ac_cv_lib[]Name[]_libs], [
+    AC_LIB_LINKFLAGS_BODY([$1], [$2])
+    ac_cv_lib[]Name[]_libs="$LIB[]NAME"
+    ac_cv_lib[]Name[]_ltlibs="$LTLIB[]NAME"
+    ac_cv_lib[]Name[]_cppflags="$INC[]NAME"
+    ac_cv_lib[]Name[]_prefix="$LIB[]NAME[]_PREFIX"
+  ])
+  LIB[]NAME="$ac_cv_lib[]Name[]_libs"
+  LTLIB[]NAME="$ac_cv_lib[]Name[]_ltlibs"
+  INC[]NAME="$ac_cv_lib[]Name[]_cppflags"
+  LIB[]NAME[]_PREFIX="$ac_cv_lib[]Name[]_prefix"
+  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INC]NAME)
+  AC_SUBST([LIB]NAME)
+  AC_SUBST([LTLIB]NAME)
+  AC_SUBST([LIB]NAME[_PREFIX])
+  dnl Also set HAVE_LIB[]NAME so that AC_LIB_HAVE_LINKFLAGS can reuse the
+  dnl results of this search when this library appears as a dependency.
+  HAVE_LIB[]NAME=yes
+  undefine([Name])
+  undefine([NAME])
+])
+
+dnl AC_LIB_HAVE_LINKFLAGS(name, dependencies, includes, testcode)
+dnl searches for libname and the libraries corresponding to explicit and
+dnl implicit dependencies, together with the specified include files and
+dnl the ability to compile and link the specified testcode. If found, it
+dnl sets and AC_SUBSTs HAVE_LIB${NAME}=yes and the LIB${NAME} and
+dnl LTLIB${NAME} variables and augments the CPPFLAGS variable, and
+dnl #defines HAVE_LIB${NAME} to 1. Otherwise, it sets and AC_SUBSTs
+dnl HAVE_LIB${NAME}=no and LIB${NAME} and LTLIB${NAME} to empty.
+dnl Sets and AC_SUBSTs the LIB${NAME}_PREFIX variable to nonempty if libname
+dnl was found in ${LIB${NAME}_PREFIX}/$acl_libdirstem.
+AC_DEFUN([AC_LIB_HAVE_LINKFLAGS],
+[
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  AC_REQUIRE([AC_LIB_RPATH])
+  define([Name],[translit([$1],[./-], [___])])
+  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],
+                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])
+
+  dnl Search for lib[]Name and define LIB[]NAME, LTLIB[]NAME and INC[]NAME
+  dnl accordingly.
+  AC_LIB_LINKFLAGS_BODY([$1], [$2])
+
+  dnl Add $INC[]NAME to CPPFLAGS before performing the following checks,
+  dnl because if the user has installed lib[]Name and not disabled its use
+  dnl via --without-lib[]Name-prefix, he wants to use it.
+  ac_save_CPPFLAGS="$CPPFLAGS"
+  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INC]NAME)
+
+  AC_CACHE_CHECK([for lib[]$1], [ac_cv_lib[]Name], [
+    ac_save_LIBS="$LIBS"
+    LIBS="$LIBS $LIB[]NAME"
+    AC_TRY_LINK([$3], [$4], [ac_cv_lib[]Name=yes], [ac_cv_lib[]Name=no])
+    LIBS="$ac_save_LIBS"
+  ])
+  if test "$ac_cv_lib[]Name" = yes; then
+    HAVE_LIB[]NAME=yes
+    AC_DEFINE([HAVE_LIB]NAME, 1, [Define if you have the $1 library.])
+    AC_MSG_CHECKING([how to link with lib[]$1])
+    AC_MSG_RESULT([$LIB[]NAME])
+  else
+    HAVE_LIB[]NAME=no
+    dnl If $LIB[]NAME didn't lead to a usable library, we don't need
+    dnl $INC[]NAME either.
+    CPPFLAGS="$ac_save_CPPFLAGS"
+    LIB[]NAME=
+    LTLIB[]NAME=
+    LIB[]NAME[]_PREFIX=
+  fi
+  AC_SUBST([HAVE_LIB]NAME)
+  AC_SUBST([LIB]NAME)
+  AC_SUBST([LTLIB]NAME)
+  AC_SUBST([LIB]NAME[_PREFIX])
+  undefine([Name])
+  undefine([NAME])
+])
+
+dnl Determine the platform dependent parameters needed to use rpath:
+dnl   acl_libext,
+dnl   acl_shlibext,
+dnl   acl_hardcode_libdir_flag_spec,
+dnl   acl_hardcode_libdir_separator,
+dnl   acl_hardcode_direct,
+dnl   acl_hardcode_minus_L.
+AC_DEFUN([AC_LIB_RPATH],
+[
+  dnl Tell automake >= 1.10 to complain if config.rpath is missing.
+  m4_ifdef([AC_REQUIRE_AUX_FILE], [AC_REQUIRE_AUX_FILE([config.rpath])])
+  AC_REQUIRE([AC_PROG_CC])                dnl we use $CC, $GCC, $LDFLAGS
+  AC_REQUIRE([AC_LIB_PROG_LD])            dnl we use $LD, $with_gnu_ld
+  AC_REQUIRE([AC_CANONICAL_HOST])         dnl we use $host
+  AC_REQUIRE([AC_CONFIG_AUX_DIR_DEFAULT]) dnl we use $ac_aux_dir
+  AC_CACHE_CHECK([for shared library run path origin], acl_cv_rpath, [
+    CC="$CC" GCC="$GCC" LDFLAGS="$LDFLAGS" LD="$LD" with_gnu_ld="$with_gnu_ld" \
+    ${CONFIG_SHELL-/bin/sh} "$ac_aux_dir/config.rpath" "$host" > conftest.sh
+    . ./conftest.sh
+    rm -f ./conftest.sh
+    acl_cv_rpath=done
+  ])
+  wl="$acl_cv_wl"
+  acl_libext="$acl_cv_libext"
+  acl_shlibext="$acl_cv_shlibext"
+  acl_libname_spec="$acl_cv_libname_spec"
+  acl_library_names_spec="$acl_cv_library_names_spec"
+  acl_hardcode_libdir_flag_spec="$acl_cv_hardcode_libdir_flag_spec"
+  acl_hardcode_libdir_separator="$acl_cv_hardcode_libdir_separator"
+  acl_hardcode_direct="$acl_cv_hardcode_direct"
+  acl_hardcode_minus_L="$acl_cv_hardcode_minus_L"
+  dnl Determine whether the user wants rpath handling at all.
+  AC_ARG_ENABLE(rpath,
+    [  --disable-rpath         do not hardcode runtime library paths],
+    :, enable_rpath=yes)
+])
+
+dnl AC_LIB_LINKFLAGS_BODY(name [, dependencies]) searches for libname and
+dnl the libraries corresponding to explicit and implicit dependencies.
+dnl Sets the LIB${NAME}, LTLIB${NAME} and INC${NAME} variables.
+dnl Also, sets the LIB${NAME}_PREFIX variable to nonempty if libname was found
+dnl in ${LIB${NAME}_PREFIX}/$acl_libdirstem.
+AC_DEFUN([AC_LIB_LINKFLAGS_BODY],
+[
+  AC_REQUIRE([AC_LIB_PREPARE_MULTILIB])
+  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],
+                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])
+  dnl Autoconf >= 2.61 supports dots in --with options.
+  define([N_A_M_E],[m4_if(m4_version_compare(m4_defn([m4_PACKAGE_VERSION]),[2.61]),[-1],[translit([$1],[.],[_])],[$1])])
+  dnl By default, look in $includedir and $libdir.
+  use_additional=yes
+  AC_LIB_WITH_FINAL_PREFIX([
+    eval additional_includedir=\"$includedir\"
+    eval additional_libdir=\"$libdir\"
+  ])
+  AC_LIB_ARG_WITH([lib]N_A_M_E[-prefix],
+[  --with-lib]N_A_M_E[-prefix[=DIR]  search for lib$1 in DIR/include and DIR/lib
+  --without-lib]N_A_M_E[-prefix     don't search for lib$1 in includedir and libdir],
+[
+    if test "X$withval" = "Xno"; then
+      use_additional=no
+    else
+      if test "X$withval" = "X"; then
+        AC_LIB_WITH_FINAL_PREFIX([
+          eval additional_includedir=\"$includedir\"
+          eval additional_libdir=\"$libdir\"
+        ])
+      else
+        additional_includedir="$withval/include"
+        additional_libdir="$withval/$acl_libdirstem"
+      fi
+    fi
+])
+  dnl Search the library and its dependencies in $additional_libdir and
+  dnl $LDFLAGS. Using breadth-first-seach.
+  LIB[]NAME=
+  LTLIB[]NAME=
+  INC[]NAME=
+  LIB[]NAME[]_PREFIX=
+  rpathdirs=
+  ltrpathdirs=
+  names_already_handled=
+  names_next_round='$1 $2'
+  while test -n "$names_next_round"; do
+    names_this_round="$names_next_round"
+    names_next_round=
+    for name in $names_this_round; do
+      already_handled=
+      for n in $names_already_handled; do
+        if test "$n" = "$name"; then
+          already_handled=yes
+          break
+        fi
+      done
+      if test -z "$already_handled"; then
+        names_already_handled="$names_already_handled $name"
+        dnl See if it was already located by an earlier AC_LIB_LINKFLAGS
+        dnl or AC_LIB_HAVE_LINKFLAGS call.
+        uppername=`echo "$name" | sed -e 'y|abcdefghijklmnopqrstuvwxyz./-|ABCDEFGHIJKLMNOPQRSTUVWXYZ___|'`
+        eval value=\"\$HAVE_LIB$uppername\"
+        if test -n "$value"; then
+          if test "$value" = yes; then
+            eval value=\"\$LIB$uppername\"
+            test -z "$value" || LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$value"
+            eval value=\"\$LTLIB$uppername\"
+            test -z "$value" || LTLIB[]NAME="${LTLIB[]NAME}${LTLIB[]NAME:+ }$value"
+          else
+            dnl An earlier call to AC_LIB_HAVE_LINKFLAGS has determined
+            dnl that this library doesn't exist. So just drop it.
+            :
+          fi
+        else
+          dnl Search the library lib$name in $additional_libdir and $LDFLAGS
+          dnl and the already constructed $LIBNAME/$LTLIBNAME.
+          found_dir=
+          found_la=
+          found_so=
+          found_a=
+          eval libname=\"$acl_libname_spec\"    # typically: libname=lib$name
+          if test -n "$acl_shlibext"; then
+            shrext=".$acl_shlibext"             # typically: shrext=.so
+          else
+            shrext=
+          fi
+          if test $use_additional = yes; then
+            dir="$additional_libdir"
+            dnl The same code as in the loop below:
+            dnl First look for a shared library.
+            if test -n "$acl_shlibext"; then
+              if test -f "$dir/$libname$shrext"; then
+                found_dir="$dir"
+                found_so="$dir/$libname$shrext"
+              else
+                if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                  ver=`(cd "$dir" && \
+                        for f in "$libname$shrext".*; do echo "$f"; done \
+                        | sed -e "s,^$libname$shrext\\\\.,," \
+                        | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                        | sed 1q ) 2>/dev/null`
+                  if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                    found_dir="$dir"
+                    found_so="$dir/$libname$shrext.$ver"
+                  fi
+                else
+                  eval library_names=\"$acl_library_names_spec\"
+                  for f in $library_names; do
+                    if test -f "$dir/$f"; then
+                      found_dir="$dir"
+                      found_so="$dir/$f"
+                      break
+                    fi
+                  done
+                fi
+              fi
+            fi
+            dnl Then look for a static library.
+            if test "X$found_dir" = "X"; then
+              if test -f "$dir/$libname.$acl_libext"; then
+                found_dir="$dir"
+                found_a="$dir/$libname.$acl_libext"
+              fi
+            fi
+            if test "X$found_dir" != "X"; then
+              if test -f "$dir/$libname.la"; then
+                found_la="$dir/$libname.la"
+              fi
+            fi
+          fi
+          if test "X$found_dir" = "X"; then
+            for x in $LDFLAGS $LTLIB[]NAME; do
+              AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+              case "$x" in
+                -L*)
+                  dir=`echo "X$x" | sed -e 's/^X-L//'`
+                  dnl First look for a shared library.
+                  if test -n "$acl_shlibext"; then
+                    if test -f "$dir/$libname$shrext"; then
+                      found_dir="$dir"
+                      found_so="$dir/$libname$shrext"
+                    else
+                      if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                        ver=`(cd "$dir" && \
+                              for f in "$libname$shrext".*; do echo "$f"; done \
+                              | sed -e "s,^$libname$shrext\\\\.,," \
+                              | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                              | sed 1q ) 2>/dev/null`
+                        if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                          found_dir="$dir"
+                          found_so="$dir/$libname$shrext.$ver"
+                        fi
+                      else
+                        eval library_names=\"$acl_library_names_spec\"
+                        for f in $library_names; do
+                          if test -f "$dir/$f"; then
+                            found_dir="$dir"
+                            found_so="$dir/$f"
+                            break
+                          fi
+                        done
+                      fi
+                    fi
+                  fi
+                  dnl Then look for a static library.
+                  if test "X$found_dir" = "X"; then
+                    if test -f "$dir/$libname.$acl_libext"; then
+                      found_dir="$dir"
+                      found_a="$dir/$libname.$acl_libext"
+                    fi
+                  fi
+                  if test "X$found_dir" != "X"; then
+                    if test -f "$dir/$libname.la"; then
+                      found_la="$dir/$libname.la"
+                    fi
+                  fi
+                  ;;
+              esac
+              if test "X$found_dir" != "X"; then
+                break
+              fi
+            done
+          fi
+          if test "X$found_dir" != "X"; then
+            dnl Found the library.
+            LTLIB[]NAME="${LTLIB[]NAME}${LTLIB[]NAME:+ }-L$found_dir -l$name"
+            if test "X$found_so" != "X"; then
+              dnl Linking with a shared library. We attempt to hardcode its
+              dnl directory into the executable's runpath, unless it's the
+              dnl standard /usr/lib.
+              if test "$enable_rpath" = no || test "X$found_dir" = "X/usr/$acl_libdirstem"; then
+                dnl No hardcoding is needed.
+                LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$found_so"
+              else
+                dnl Use an explicit option to hardcode DIR into the resulting
+                dnl binary.
+                dnl Potentially add DIR to ltrpathdirs.
+                dnl The ltrpathdirs will be appended to $LTLIBNAME at the end.
+                haveit=
+                for x in $ltrpathdirs; do
+                  if test "X$x" = "X$found_dir"; then
+                    haveit=yes
+                    break
+                  fi
+                done
+                if test -z "$haveit"; then
+                  ltrpathdirs="$ltrpathdirs $found_dir"
+                fi
+                dnl The hardcoding into $LIBNAME is system dependent.
+                if test "$acl_hardcode_direct" = yes; then
+                  dnl Using DIR/libNAME.so during linking hardcodes DIR into the
+                  dnl resulting binary.
+                  LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$found_so"
+                else
+                  if test -n "$acl_hardcode_libdir_flag_spec" && test "$acl_hardcode_minus_L" = no; then
+                    dnl Use an explicit option to hardcode DIR into the resulting
+                    dnl binary.
+                    LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$found_so"
+                    dnl Potentially add DIR to rpathdirs.
+                    dnl The rpathdirs will be appended to $LIBNAME at the end.
+                    haveit=
+                    for x in $rpathdirs; do
+                      if test "X$x" = "X$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      rpathdirs="$rpathdirs $found_dir"
+                    fi
+                  else
+                    dnl Rely on "-L$found_dir".
+                    dnl But don't add it if it's already contained in the LDFLAGS
+                    dnl or the already constructed $LIBNAME
+                    haveit=
+                    for x in $LDFLAGS $LIB[]NAME; do
+                      AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+                      if test "X$x" = "X-L$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }-L$found_dir"
+                    fi
+                    if test "$acl_hardcode_minus_L" != no; then
+                      dnl FIXME: Not sure whether we should use
+                      dnl "-L$found_dir -l$name" or "-L$found_dir $found_so"
+                      dnl here.
+                      LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$found_so"
+                    else
+                      dnl We cannot use $acl_hardcode_runpath_var and LD_RUN_PATH
+                      dnl here, because this doesn't fit in flags passed to the
+                      dnl compiler. So give up. No hardcoding. This affects only
+                      dnl very old systems.
+                      dnl FIXME: Not sure whether we should use
+                      dnl "-L$found_dir -l$name" or "-L$found_dir $found_so"
+                      dnl here.
+                      LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }-l$name"
+                    fi
+                  fi
+                fi
+              fi
+            else
+              if test "X$found_a" != "X"; then
+                dnl Linking with a static library.
+                LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$found_a"
+              else
+                dnl We shouldn't come here, but anyway it's good to have a
+                dnl fallback.
+                LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }-L$found_dir -l$name"
+              fi
+            fi
+            dnl Assume the include files are nearby.
+            additional_includedir=
+            case "$found_dir" in
+              */$acl_libdirstem | */$acl_libdirstem/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem/"'*$,,'`
+                LIB[]NAME[]_PREFIX="$basedir"
+                additional_includedir="$basedir/include"
+                ;;
+            esac
+            if test "X$additional_includedir" != "X"; then
+              dnl Potentially add $additional_includedir to $INCNAME.
+              dnl But don't add it
+              dnl   1. if it's the standard /usr/include,
+              dnl   2. if it's /usr/local/include and we are using GCC on Linux,
+              dnl   3. if it's already present in $CPPFLAGS or the already
+              dnl      constructed $INCNAME,
+              dnl   4. if it doesn't exist as a directory.
+              if test "X$additional_includedir" != "X/usr/include"; then
+                haveit=
+                if test "X$additional_includedir" = "X/usr/local/include"; then
+                  if test -n "$GCC"; then
+                    case $host_os in
+                      linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                    esac
+                  fi
+                fi
+                if test -z "$haveit"; then
+                  for x in $CPPFLAGS $INC[]NAME; do
+                    AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+                    if test "X$x" = "X-I$additional_includedir"; then
+                      haveit=yes
+                      break
+                    fi
+                  done
+                  if test -z "$haveit"; then
+                    if test -d "$additional_includedir"; then
+                      dnl Really add $additional_includedir to $INCNAME.
+                      INC[]NAME="${INC[]NAME}${INC[]NAME:+ }-I$additional_includedir"
+                    fi
+                  fi
+                fi
+              fi
+            fi
+            dnl Look for dependencies.
+            if test -n "$found_la"; then
+              dnl Read the .la file. It defines the variables
+              dnl dlname, library_names, old_library, dependency_libs, current,
+              dnl age, revision, installed, dlopen, dlpreopen, libdir.
+              save_libdir="$libdir"
+              case "$found_la" in
+                */* | *\\*) . "$found_la" ;;
+                *) . "./$found_la" ;;
+              esac
+              libdir="$save_libdir"
+              dnl We use only dependency_libs.
+              for dep in $dependency_libs; do
+                case "$dep" in
+                  -L*)
+                    additional_libdir=`echo "X$dep" | sed -e 's/^X-L//'`
+                    dnl Potentially add $additional_libdir to $LIBNAME and $LTLIBNAME.
+                    dnl But don't add it
+                    dnl   1. if it's the standard /usr/lib,
+                    dnl   2. if it's /usr/local/lib and we are using GCC on Linux,
+                    dnl   3. if it's already present in $LDFLAGS or the already
+                    dnl      constructed $LIBNAME,
+                    dnl   4. if it doesn't exist as a directory.
+                    if test "X$additional_libdir" != "X/usr/$acl_libdirstem"; then
+                      haveit=
+                      if test "X$additional_libdir" = "X/usr/local/$acl_libdirstem"; then
+                        if test -n "$GCC"; then
+                          case $host_os in
+                            linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                          esac
+                        fi
+                      fi
+                      if test -z "$haveit"; then
+                        haveit=
+                        for x in $LDFLAGS $LIB[]NAME; do
+                          AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                            dnl Really add $additional_libdir to $LIBNAME.
+                            LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }-L$additional_libdir"
+                          fi
+                        fi
+                        haveit=
+                        for x in $LDFLAGS $LTLIB[]NAME; do
+                          AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                            dnl Really add $additional_libdir to $LTLIBNAME.
+                            LTLIB[]NAME="${LTLIB[]NAME}${LTLIB[]NAME:+ }-L$additional_libdir"
+                          fi
+                        fi
+                      fi
+                    fi
+                    ;;
+                  -R*)
+                    dir=`echo "X$dep" | sed -e 's/^X-R//'`
+                    if test "$enable_rpath" != no; then
+                      dnl Potentially add DIR to rpathdirs.
+                      dnl The rpathdirs will be appended to $LIBNAME at the end.
+                      haveit=
+                      for x in $rpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        rpathdirs="$rpathdirs $dir"
+                      fi
+                      dnl Potentially add DIR to ltrpathdirs.
+                      dnl The ltrpathdirs will be appended to $LTLIBNAME at the end.
+                      haveit=
+                      for x in $ltrpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        ltrpathdirs="$ltrpathdirs $dir"
+                      fi
+                    fi
+                    ;;
+                  -l*)
+                    dnl Handle this in the next round.
+                    names_next_round="$names_next_round "`echo "X$dep" | sed -e 's/^X-l//'`
+                    ;;
+                  *.la)
+                    dnl Handle this in the next round. Throw away the .la's
+                    dnl directory; it is already contained in a preceding -L
+                    dnl option.
+                    names_next_round="$names_next_round "`echo "X$dep" | sed -e 's,^X.*/,,' -e 's,^lib,,' -e 's,\.la$,,'`
+                    ;;
+                  *)
+                    dnl Most likely an immediate library name.
+                    LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$dep"
+                    LTLIB[]NAME="${LTLIB[]NAME}${LTLIB[]NAME:+ }$dep"
+                    ;;
+                esac
+              done
+            fi
+          else
+            dnl Didn't find the library; assume it is in the system directories
+            dnl known to the linker and runtime loader. (All the system
+            dnl directories known to the linker should also be known to the
+            dnl runtime loader, otherwise the system is severely misconfigured.)
+            LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }-l$name"
+            LTLIB[]NAME="${LTLIB[]NAME}${LTLIB[]NAME:+ }-l$name"
+          fi
+        fi
+      fi
+    done
+  done
+  if test "X$rpathdirs" != "X"; then
+    if test -n "$acl_hardcode_libdir_separator"; then
+      dnl Weird platform: only the last -rpath option counts, the user must
+      dnl pass all path elements in one option. We can arrange that for a
+      dnl single library, but not when more than one $LIBNAMEs are used.
+      alldirs=
+      for found_dir in $rpathdirs; do
+        alldirs="${alldirs}${alldirs:+$acl_hardcode_libdir_separator}$found_dir"
+      done
+      dnl Note: acl_hardcode_libdir_flag_spec uses $libdir and $wl.
+      acl_save_libdir="$libdir"
+      libdir="$alldirs"
+      eval flag=\"$acl_hardcode_libdir_flag_spec\"
+      libdir="$acl_save_libdir"
+      LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$flag"
+    else
+      dnl The -rpath options are cumulative.
+      for found_dir in $rpathdirs; do
+        acl_save_libdir="$libdir"
+        libdir="$found_dir"
+        eval flag=\"$acl_hardcode_libdir_flag_spec\"
+        libdir="$acl_save_libdir"
+        LIB[]NAME="${LIB[]NAME}${LIB[]NAME:+ }$flag"
+      done
+    fi
+  fi
+  if test "X$ltrpathdirs" != "X"; then
+    dnl When using libtool, the option that works for both libraries and
+    dnl executables is -R. The -R options are cumulative.
+    for found_dir in $ltrpathdirs; do
+      LTLIB[]NAME="${LTLIB[]NAME}${LTLIB[]NAME:+ }-R$found_dir"
+    done
+  fi
+])
+
+dnl AC_LIB_APPENDTOVAR(VAR, CONTENTS) appends the elements of CONTENTS to VAR,
+dnl unless already present in VAR.
+dnl Works only for CPPFLAGS, not for LIB* variables because that sometimes
+dnl contains two or three consecutive elements that belong together.
+AC_DEFUN([AC_LIB_APPENDTOVAR],
+[
+  for element in [$2]; do
+    haveit=
+    for x in $[$1]; do
+      AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+      if test "X$x" = "X$element"; then
+        haveit=yes
+        break
+      fi
+    done
+    if test -z "$haveit"; then
+      [$1]="${[$1]}${[$1]:+ }$element"
+    fi
+  done
+])
+
+dnl For those cases where a variable contains several -L and -l options
+dnl referring to unknown libraries and directories, this macro determines the
+dnl necessary additional linker options for the runtime path.
+dnl AC_LIB_LINKFLAGS_FROM_LIBS([LDADDVAR], [LIBSVALUE], [USE-LIBTOOL])
+dnl sets LDADDVAR to linker options needed together with LIBSVALUE.
+dnl If USE-LIBTOOL evaluates to non-empty, linking with libtool is assumed,
+dnl otherwise linking without libtool is assumed.
+AC_DEFUN([AC_LIB_LINKFLAGS_FROM_LIBS],
+[
+  AC_REQUIRE([AC_LIB_RPATH])
+  AC_REQUIRE([AC_LIB_PREPARE_MULTILIB])
+  $1=
+  if test "$enable_rpath" != no; then
+    if test -n "$acl_hardcode_libdir_flag_spec" && test "$acl_hardcode_minus_L" = no; then
+      dnl Use an explicit option to hardcode directories into the resulting
+      dnl binary.
+      rpathdirs=
+      next=
+      for opt in $2; do
+        if test -n "$next"; then
+          dir="$next"
+          dnl No need to hardcode the standard /usr/lib.
+          if test "X$dir" != "X/usr/$acl_libdirstem"; then
+            rpathdirs="$rpathdirs $dir"
+          fi
+          next=
+        else
+          case $opt in
+            -L) next=yes ;;
+            -L*) dir=`echo "X$opt" | sed -e 's,^X-L,,'`
+                 dnl No need to hardcode the standard /usr/lib.
+                 if test "X$dir" != "X/usr/$acl_libdirstem"; then
+                   rpathdirs="$rpathdirs $dir"
+                 fi
+                 next= ;;
+            *) next= ;;
+          esac
+        fi
+      done
+      if test "X$rpathdirs" != "X"; then
+        if test -n ""$3""; then
+          dnl libtool is used for linking. Use -R options.
+          for dir in $rpathdirs; do
+            $1="${$1}${$1:+ }-R$dir"
+          done
+        else
+          dnl The linker is used for linking directly.
+          if test -n "$acl_hardcode_libdir_separator"; then
+            dnl Weird platform: only the last -rpath option counts, the user
+            dnl must pass all path elements in one option.
+            alldirs=
+            for dir in $rpathdirs; do
+              alldirs="${alldirs}${alldirs:+$acl_hardcode_libdir_separator}$dir"
+            done
+            acl_save_libdir="$libdir"
+            libdir="$alldirs"
+            eval flag=\"$acl_hardcode_libdir_flag_spec\"
+            libdir="$acl_save_libdir"
+            $1="$flag"
+          else
+            dnl The -rpath options are cumulative.
+            for dir in $rpathdirs; do
+              acl_save_libdir="$libdir"
+              libdir="$dir"
+              eval flag=\"$acl_hardcode_libdir_flag_spec\"
+              libdir="$acl_save_libdir"
+              $1="${$1}${$1:+ }$flag"
+            done
+          fi
+        fi
+      fi
+    fi
+  fi
+  AC_SUBST([$1])
+])
+
+# lib-prefix.m4 serial 5 (gettext-0.15)
+dnl Copyright (C) 2001-2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+dnl AC_LIB_ARG_WITH is synonymous to AC_ARG_WITH in autoconf-2.13, and
+dnl similar to AC_ARG_WITH in autoconf 2.52...2.57 except that is doesn't
+dnl require excessive bracketing.
+ifdef([AC_HELP_STRING],
+[AC_DEFUN([AC_LIB_ARG_WITH], [AC_ARG_WITH([$1],[[$2]],[$3],[$4])])],
+[AC_DEFUN([AC_][LIB_ARG_WITH], [AC_ARG_WITH([$1],[$2],[$3],[$4])])])
+
+dnl AC_LIB_PREFIX adds to the CPPFLAGS and LDFLAGS the flags that are needed
+dnl to access previously installed libraries. The basic assumption is that
+dnl a user will want packages to use other packages he previously installed
+dnl with the same --prefix option.
+dnl This macro is not needed if only AC_LIB_LINKFLAGS is used to locate
+dnl libraries, but is otherwise very convenient.
+AC_DEFUN([AC_LIB_PREFIX],
+[
+  AC_BEFORE([$0], [AC_LIB_LINKFLAGS])
+  AC_REQUIRE([AC_PROG_CC])
+  AC_REQUIRE([AC_CANONICAL_HOST])
+  AC_REQUIRE([AC_LIB_PREPARE_MULTILIB])
+  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
+  dnl By default, look in $includedir and $libdir.
+  use_additional=yes
+  AC_LIB_WITH_FINAL_PREFIX([
+    eval additional_includedir=\"$includedir\"
+    eval additional_libdir=\"$libdir\"
+  ])
+  AC_LIB_ARG_WITH([lib-prefix],
+[  --with-lib-prefix[=DIR] search for libraries in DIR/include and DIR/lib
+  --without-lib-prefix    don't search for libraries in includedir and libdir],
+[
+    if test "X$withval" = "Xno"; then
+      use_additional=no
+    else
+      if test "X$withval" = "X"; then
+        AC_LIB_WITH_FINAL_PREFIX([
+          eval additional_includedir=\"$includedir\"
+          eval additional_libdir=\"$libdir\"
+        ])
+      else
+        additional_includedir="$withval/include"
+        additional_libdir="$withval/$acl_libdirstem"
+      fi
+    fi
+])
+  if test $use_additional = yes; then
+    dnl Potentially add $additional_includedir to $CPPFLAGS.
+    dnl But don't add it
+    dnl   1. if it's the standard /usr/include,
+    dnl   2. if it's already present in $CPPFLAGS,
+    dnl   3. if it's /usr/local/include and we are using GCC on Linux,
+    dnl   4. if it doesn't exist as a directory.
+    if test "X$additional_includedir" != "X/usr/include"; then
+      haveit=
+      for x in $CPPFLAGS; do
+        AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+        if test "X$x" = "X-I$additional_includedir"; then
+          haveit=yes
+          break
+        fi
+      done
+      if test -z "$haveit"; then
+        if test "X$additional_includedir" = "X/usr/local/include"; then
+          if test -n "$GCC"; then
+            case $host_os in
+              linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+            esac
+          fi
+        fi
+        if test -z "$haveit"; then
+          if test -d "$additional_includedir"; then
+            dnl Really add $additional_includedir to $CPPFLAGS.
+            CPPFLAGS="${CPPFLAGS}${CPPFLAGS:+ }-I$additional_includedir"
+          fi
+        fi
+      fi
+    fi
+    dnl Potentially add $additional_libdir to $LDFLAGS.
+    dnl But don't add it
+    dnl   1. if it's the standard /usr/lib,
+    dnl   2. if it's already present in $LDFLAGS,
+    dnl   3. if it's /usr/local/lib and we are using GCC on Linux,
+    dnl   4. if it doesn't exist as a directory.
+    if test "X$additional_libdir" != "X/usr/$acl_libdirstem"; then
+      haveit=
+      for x in $LDFLAGS; do
+        AC_LIB_WITH_FINAL_PREFIX([eval x=\"$x\"])
+        if test "X$x" = "X-L$additional_libdir"; then
+          haveit=yes
+          break
+        fi
+      done
+      if test -z "$haveit"; then
+        if test "X$additional_libdir" = "X/usr/local/$acl_libdirstem"; then
+          if test -n "$GCC"; then
+            case $host_os in
+              linux*) haveit=yes;;
+            esac
+          fi
+        fi
+        if test -z "$haveit"; then
+          if test -d "$additional_libdir"; then
+            dnl Really add $additional_libdir to $LDFLAGS.
+            LDFLAGS="${LDFLAGS}${LDFLAGS:+ }-L$additional_libdir"
+          fi
+        fi
+      fi
+    fi
+  fi
+])
+
+dnl AC_LIB_PREPARE_PREFIX creates variables acl_final_prefix,
+dnl acl_final_exec_prefix, containing the values to which $prefix and
+dnl $exec_prefix will expand at the end of the configure script.
+AC_DEFUN([AC_LIB_PREPARE_PREFIX],
+[
+  dnl Unfortunately, prefix and exec_prefix get only finally determined
+  dnl at the end of configure.
+  if test "X$prefix" = "XNONE"; then
+    acl_final_prefix="$ac_default_prefix"
+  else
+    acl_final_prefix="$prefix"
+  fi
+  if test "X$exec_prefix" = "XNONE"; then
+    acl_final_exec_prefix='${prefix}'
+  else
+    acl_final_exec_prefix="$exec_prefix"
+  fi
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  eval acl_final_exec_prefix=\"$acl_final_exec_prefix\"
+  prefix="$acl_save_prefix"
+])
+
+dnl AC_LIB_WITH_FINAL_PREFIX([statement]) evaluates statement, with the
+dnl variables prefix and exec_prefix bound to the values they will have
+dnl at the end of the configure script.
+AC_DEFUN([AC_LIB_WITH_FINAL_PREFIX],
+[
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  $1
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+])
+
+dnl AC_LIB_PREPARE_MULTILIB creates a variable acl_libdirstem, containing
+dnl the basename of the libdir, either "lib" or "lib64".
+AC_DEFUN([AC_LIB_PREPARE_MULTILIB],
+[
+  dnl There is no formal standard regarding lib and lib64. The current
+  dnl practice is that on a system supporting 32-bit and 64-bit instruction
+  dnl sets or ABIs, 64-bit libraries go under $prefix/lib64 and 32-bit
+  dnl libraries go under $prefix/lib. We determine the compiler's default
+  dnl mode by looking at the compiler's library search path. If at least
+  dnl of its elements ends in /lib64 or points to a directory whose absolute
+  dnl pathname ends in /lib64, we assume a 64-bit ABI. Otherwise we use the
+  dnl default, namely "lib".
+  acl_libdirstem=lib
+  searchpath=`(LC_ALL=C $CC -print-search-dirs) 2>/dev/null | sed -n -e 's,^libraries: ,,p' | sed -e 's,^=,,'`
+  if test -n "$searchpath"; then
+    acl_save_IFS="${IFS= 	}"; IFS=":"
+    for searchdir in $searchpath; do
+      if test -d "$searchdir"; then
+        case "$searchdir" in
+          */lib64/ | */lib64 ) acl_libdirstem=lib64 ;;
+          *) searchdir=`cd "$searchdir" && pwd`
+             case "$searchdir" in
+               */lib64 ) acl_libdirstem=lib64 ;;
+             esac ;;
+        esac
+      fi
+    done
+    IFS="$acl_save_IFS"
+  fi
+])
+
+# nls.m4 serial 3 (gettext-0.15)
+dnl Copyright (C) 1995-2003, 2005-2006 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+dnl Authors:
+dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.
+dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2003.
+
+AC_PREREQ(2.50)
+
+AC_DEFUN([AM_NLS],
+[
+  AC_MSG_CHECKING([whether NLS is requested])
+  dnl Default is enabled NLS
+  AC_ARG_ENABLE(nls,
+    [  --disable-nls           do not use Native Language Support],
+    USE_NLS=$enableval, USE_NLS=yes)
+  AC_MSG_RESULT($USE_NLS)
+  AC_SUBST(USE_NLS)
+])
+
+# po.m4 serial 15 (gettext-0.17)
+dnl Copyright (C) 1995-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+dnl Authors:
+dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.
+dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2003.
+
+AC_PREREQ(2.50)
+
+dnl Checks for all prerequisites of the po subdirectory.
+AC_DEFUN([AM_PO_SUBDIRS],
+[
+  AC_REQUIRE([AC_PROG_MAKE_SET])dnl
+  AC_REQUIRE([AC_PROG_INSTALL])dnl
+  AC_REQUIRE([AM_PROG_MKDIR_P])dnl defined by automake
+  AC_REQUIRE([AM_NLS])dnl
+
+  dnl Release version of the gettext macros. This is used to ensure that
+  dnl the gettext macros and po/Makefile.in.in are in sync.
+  AC_SUBST([GETTEXT_MACRO_VERSION], [0.17])
+
+  dnl Perform the following tests also if --disable-nls has been given,
+  dnl because they are needed for "make dist" to work.
+
+  dnl Search for GNU msgfmt in the PATH.
+  dnl The first test excludes Solaris msgfmt and early GNU msgfmt versions.
+  dnl The second test excludes FreeBSD msgfmt.
+  AM_PATH_PROG_WITH_TEST(MSGFMT, msgfmt,
+    [$ac_dir/$ac_word --statistics /dev/null >&]AS_MESSAGE_LOG_FD[ 2>&1 &&
+     (if $ac_dir/$ac_word --statistics /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi)],
+    :)
+  AC_PATH_PROG(GMSGFMT, gmsgfmt, $MSGFMT)
+
+  dnl Test whether it is GNU msgfmt >= 0.15.
+changequote(,)dnl
+  case `$MSGFMT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) MSGFMT_015=: ;;
+    *) MSGFMT_015=$MSGFMT ;;
+  esac
+changequote([,])dnl
+  AC_SUBST([MSGFMT_015])
+changequote(,)dnl
+  case `$GMSGFMT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) GMSGFMT_015=: ;;
+    *) GMSGFMT_015=$GMSGFMT ;;
+  esac
+changequote([,])dnl
+  AC_SUBST([GMSGFMT_015])
+
+  dnl Search for GNU xgettext 0.12 or newer in the PATH.
+  dnl The first test excludes Solaris xgettext and early GNU xgettext versions.
+  dnl The second test excludes FreeBSD xgettext.
+  AM_PATH_PROG_WITH_TEST(XGETTEXT, xgettext,
+    [$ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null >&]AS_MESSAGE_LOG_FD[ 2>&1 &&
+     (if $ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi)],
+    :)
+  dnl Remove leftover from FreeBSD xgettext call.
+  rm -f messages.po
+
+  dnl Test whether it is GNU xgettext >= 0.15.
+changequote(,)dnl
+  case `$XGETTEXT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) XGETTEXT_015=: ;;
+    *) XGETTEXT_015=$XGETTEXT ;;
+  esac
+changequote([,])dnl
+  AC_SUBST([XGETTEXT_015])
+
+  dnl Search for GNU msgmerge 0.11 or newer in the PATH.
+  AM_PATH_PROG_WITH_TEST(MSGMERGE, msgmerge,
+    [$ac_dir/$ac_word --update -q /dev/null /dev/null >&]AS_MESSAGE_LOG_FD[ 2>&1], :)
+
+  dnl Installation directories.
+  dnl Autoconf >= 2.60 defines localedir. For older versions of autoconf, we
+  dnl have to define it here, so that it can be used in po/Makefile.
+  test -n "$localedir" || localedir='${datadir}/locale'
+  AC_SUBST([localedir])
+
+  dnl Support for AM_XGETTEXT_OPTION.
+  test -n "${XGETTEXT_EXTRA_OPTIONS+set}" || XGETTEXT_EXTRA_OPTIONS=
+  AC_SUBST([XGETTEXT_EXTRA_OPTIONS])
+
+  AC_CONFIG_COMMANDS([po-directories], [[
+    for ac_file in $CONFIG_FILES; do
+      # Support "outfile[:infile[:infile...]]"
+      case "$ac_file" in
+        *:*) ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
+      esac
+      # PO directories have a Makefile.in generated from Makefile.in.in.
+      case "$ac_file" in */Makefile.in)
+        # Adjust a relative srcdir.
+        ac_dir=`echo "$ac_file"|sed 's%/[^/][^/]*$%%'`
+        ac_dir_suffix="/`echo "$ac_dir"|sed 's%^\./%%'`"
+        ac_dots=`echo "$ac_dir_suffix"|sed 's%/[^/]*%../%g'`
+        # In autoconf-2.13 it is called $ac_given_srcdir.
+        # In autoconf-2.50 it is called $srcdir.
+        test -n "$ac_given_srcdir" || ac_given_srcdir="$srcdir"
+        case "$ac_given_srcdir" in
+          .)  top_srcdir=`echo $ac_dots|sed 's%/$%%'` ;;
+          /*) top_srcdir="$ac_given_srcdir" ;;
+          *)  top_srcdir="$ac_dots$ac_given_srcdir" ;;
+        esac
+        # Treat a directory as a PO directory if and only if it has a
+        # POTFILES.in file. This allows packages to have multiple PO
+        # directories under different names or in different locations.
+        if test -f "$ac_given_srcdir/$ac_dir/POTFILES.in"; then
+          rm -f "$ac_dir/POTFILES"
+          test -n "$as_me" && echo "$as_me: creating $ac_dir/POTFILES" || echo "creating $ac_dir/POTFILES"
+          cat "$ac_given_srcdir/$ac_dir/POTFILES.in" | sed -e "/^#/d" -e "/^[ 	]*\$/d" -e "s,.*,     $top_srcdir/& \\\\," | sed -e "\$s/\(.*\) \\\\/\1/" > "$ac_dir/POTFILES"
+          POMAKEFILEDEPS="POTFILES.in"
+          # ALL_LINGUAS, POFILES, UPDATEPOFILES, DUMMYPOFILES, GMOFILES depend
+          # on $ac_dir but don't depend on user-specified configuration
+          # parameters.
+          if test -f "$ac_given_srcdir/$ac_dir/LINGUAS"; then
+            # The LINGUAS file contains the set of available languages.
+            if test -n "$OBSOLETE_ALL_LINGUAS"; then
+              test -n "$as_me" && echo "$as_me: setting ALL_LINGUAS in configure.in is obsolete" || echo "setting ALL_LINGUAS in configure.in is obsolete"
+            fi
+            ALL_LINGUAS_=`sed -e "/^#/d" -e "s/#.*//" "$ac_given_srcdir/$ac_dir/LINGUAS"`
+            # Hide the ALL_LINGUAS assigment from automake < 1.5.
+            eval 'ALL_LINGUAS''=$ALL_LINGUAS_'
+            POMAKEFILEDEPS="$POMAKEFILEDEPS LINGUAS"
+          else
+            # The set of available languages was given in configure.in.
+            # Hide the ALL_LINGUAS assigment from automake < 1.5.
+            eval 'ALL_LINGUAS''=$OBSOLETE_ALL_LINGUAS'
+          fi
+          # Compute POFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).po)
+          # Compute UPDATEPOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(lang).po-update)
+          # Compute DUMMYPOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(lang).nop)
+          # Compute GMOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).gmo)
+          case "$ac_given_srcdir" in
+            .) srcdirpre= ;;
+            *) srcdirpre='$(srcdir)/' ;;
+          esac
+          POFILES=
+          UPDATEPOFILES=
+          DUMMYPOFILES=
+          GMOFILES=
+          for lang in $ALL_LINGUAS; do
+            POFILES="$POFILES $srcdirpre$lang.po"
+            UPDATEPOFILES="$UPDATEPOFILES $lang.po-update"
+            DUMMYPOFILES="$DUMMYPOFILES $lang.nop"
+            GMOFILES="$GMOFILES $srcdirpre$lang.gmo"
+          done
+          # CATALOGS depends on both $ac_dir and the user's LINGUAS
+          # environment variable.
+          INST_LINGUAS=
+          if test -n "$ALL_LINGUAS"; then
+            for presentlang in $ALL_LINGUAS; do
+              useit=no
+              if test "%UNSET%" != "$LINGUAS"; then
+                desiredlanguages="$LINGUAS"
+              else
+                desiredlanguages="$ALL_LINGUAS"
+              fi
+              for desiredlang in $desiredlanguages; do
+                # Use the presentlang catalog if desiredlang is
+                #   a. equal to presentlang, or
+                #   b. a variant of presentlang (because in this case,
+                #      presentlang can be used as a fallback for messages
+                #      which are not translated in the desiredlang catalog).
+                case "$desiredlang" in
+                  "$presentlang"*) useit=yes;;
+                esac
+              done
+              if test $useit = yes; then
+                INST_LINGUAS="$INST_LINGUAS $presentlang"
+              fi
+            done
+          fi
+          CATALOGS=
+          if test -n "$INST_LINGUAS"; then
+            for lang in $INST_LINGUAS; do
+              CATALOGS="$CATALOGS $lang.gmo"
+            done
+          fi
+          test -n "$as_me" && echo "$as_me: creating $ac_dir/Makefile" || echo "creating $ac_dir/Makefile"
+          sed -e "/^POTFILES =/r $ac_dir/POTFILES" -e "/^# Makevars/r $ac_given_srcdir/$ac_dir/Makevars" -e "s|@POFILES@|$POFILES|g" -e "s|@UPDATEPOFILES@|$UPDATEPOFILES|g" -e "s|@DUMMYPOFILES@|$DUMMYPOFILES|g" -e "s|@GMOFILES@|$GMOFILES|g" -e "s|@CATALOGS@|$CATALOGS|g" -e "s|@POMAKEFILEDEPS@|$POMAKEFILEDEPS|g" "$ac_dir/Makefile.in" > "$ac_dir/Makefile"
+          for f in "$ac_given_srcdir/$ac_dir"/Rules-*; do
+            if test -f "$f"; then
+              case "$f" in
+                *.orig | *.bak | *~) ;;
+                *) cat "$f" >> "$ac_dir/Makefile" ;;
+              esac
+            fi
+          done
+        fi
+        ;;
+      esac
+    done]],
+   [# Capture the value of obsolete ALL_LINGUAS because we need it to compute
+    # POFILES, UPDATEPOFILES, DUMMYPOFILES, GMOFILES, CATALOGS. But hide it
+    # from automake < 1.5.
+    eval 'OBSOLETE_ALL_LINGUAS''="$ALL_LINGUAS"'
+    # Capture the value of LINGUAS because we need it to compute CATALOGS.
+    LINGUAS="${LINGUAS-%UNSET%}"
+   ])
+])
+
+dnl Postprocesses a Makefile in a directory containing PO files.
+AC_DEFUN([AM_POSTPROCESS_PO_MAKEFILE],
+[
+  # When this code is run, in config.status, two variables have already been
+  # set:
+  # - OBSOLETE_ALL_LINGUAS is the value of LINGUAS set in configure.in,
+  # - LINGUAS is the value of the environment variable LINGUAS at configure
+  #   time.
+
+changequote(,)dnl
+  # Adjust a relative srcdir.
+  ac_dir=`echo "$ac_file"|sed 's%/[^/][^/]*$%%'`
+  ac_dir_suffix="/`echo "$ac_dir"|sed 's%^\./%%'`"
+  ac_dots=`echo "$ac_dir_suffix"|sed 's%/[^/]*%../%g'`
+  # In autoconf-2.13 it is called $ac_given_srcdir.
+  # In autoconf-2.50 it is called $srcdir.
+  test -n "$ac_given_srcdir" || ac_given_srcdir="$srcdir"
+  case "$ac_given_srcdir" in
+    .)  top_srcdir=`echo $ac_dots|sed 's%/$%%'` ;;
+    /*) top_srcdir="$ac_given_srcdir" ;;
+    *)  top_srcdir="$ac_dots$ac_given_srcdir" ;;
+  esac
+
+  # Find a way to echo strings without interpreting backslash.
+  if test "X`(echo '\t') 2>/dev/null`" = 'X\t'; then
+    gt_echo='echo'
+  else
+    if test "X`(printf '%s\n' '\t') 2>/dev/null`" = 'X\t'; then
+      gt_echo='printf %s\n'
+    else
+      echo_func () {
+        cat <<EOT
+$*
+EOT
+      }
+      gt_echo='echo_func'
+    fi
+  fi
+
+  # A sed script that extracts the value of VARIABLE from a Makefile.
+  sed_x_variable='
+# Test if the hold space is empty.
+x
+s/P/P/
+x
+ta
+# Yes it was empty. Look if we have the expected variable definition.
+/^[	 ]*VARIABLE[	 ]*=/{
+  # Seen the first line of the variable definition.
+  s/^[	 ]*VARIABLE[	 ]*=//
+  ba
+}
+bd
+:a
+# Here we are processing a line from the variable definition.
+# Remove comment, more precisely replace it with a space.
+s/#.*$/ /
+# See if the line ends in a backslash.
+tb
+:b
+s/\\$//
+# Print the line, without the trailing backslash.
+p
+tc
+# There was no trailing backslash. The end of the variable definition is
+# reached. Clear the hold space.
+s/^.*$//
+x
+bd
+:c
+# A trailing backslash means that the variable definition continues in the
+# next line. Put a nonempty string into the hold space to indicate this.
+s/^.*$/P/
+x
+:d
+'
+changequote([,])dnl
+
+  # Set POTFILES to the value of the Makefile variable POTFILES.
+  sed_x_POTFILES=`$gt_echo "$sed_x_variable" | sed -e '/^ *#/d' -e 's/VARIABLE/POTFILES/g'`
+  POTFILES=`sed -n -e "$sed_x_POTFILES" < "$ac_file"`
+  # Compute POTFILES_DEPS as
+  #   $(foreach file, $(POTFILES), $(top_srcdir)/$(file))
+  POTFILES_DEPS=
+  for file in $POTFILES; do
+    POTFILES_DEPS="$POTFILES_DEPS "'$(top_srcdir)/'"$file"
+  done
+  POMAKEFILEDEPS=""
+
+  if test -n "$OBSOLETE_ALL_LINGUAS"; then
+    test -n "$as_me" && echo "$as_me: setting ALL_LINGUAS in configure.in is obsolete" || echo "setting ALL_LINGUAS in configure.in is obsolete"
+  fi
+  if test -f "$ac_given_srcdir/$ac_dir/LINGUAS"; then
+    # The LINGUAS file contains the set of available languages.
+    ALL_LINGUAS_=`sed -e "/^#/d" -e "s/#.*//" "$ac_given_srcdir/$ac_dir/LINGUAS"`
+    POMAKEFILEDEPS="$POMAKEFILEDEPS LINGUAS"
+  else
+    # Set ALL_LINGUAS to the value of the Makefile variable LINGUAS.
+    sed_x_LINGUAS=`$gt_echo "$sed_x_variable" | sed -e '/^ *#/d' -e 's/VARIABLE/LINGUAS/g'`
+    ALL_LINGUAS_=`sed -n -e "$sed_x_LINGUAS" < "$ac_file"`
+  fi
+  # Hide the ALL_LINGUAS assigment from automake < 1.5.
+  eval 'ALL_LINGUAS''=$ALL_LINGUAS_'
+  # Compute POFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).po)
+  # Compute UPDATEPOFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(lang).po-update)
+  # Compute DUMMYPOFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(lang).nop)
+  # Compute GMOFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).gmo)
+  # Compute PROPERTIESFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(top_srcdir)/$(DOMAIN)_$(lang).properties)
+  # Compute CLASSFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(top_srcdir)/$(DOMAIN)_$(lang).class)
+  # Compute QMFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).qm)
+  # Compute MSGFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(frob $(lang)).msg)
+  # Compute RESOURCESDLLFILES
+  # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(frob $(lang))/$(DOMAIN).resources.dll)
+  case "$ac_given_srcdir" in
+    .) srcdirpre= ;;
+    *) srcdirpre='$(srcdir)/' ;;
+  esac
+  POFILES=
+  UPDATEPOFILES=
+  DUMMYPOFILES=
+  GMOFILES=
+  PROPERTIESFILES=
+  CLASSFILES=
+  QMFILES=
+  MSGFILES=
+  RESOURCESDLLFILES=
+  for lang in $ALL_LINGUAS; do
+    POFILES="$POFILES $srcdirpre$lang.po"
+    UPDATEPOFILES="$UPDATEPOFILES $lang.po-update"
+    DUMMYPOFILES="$DUMMYPOFILES $lang.nop"
+    GMOFILES="$GMOFILES $srcdirpre$lang.gmo"
+    PROPERTIESFILES="$PROPERTIESFILES \$(top_srcdir)/\$(DOMAIN)_$lang.properties"
+    CLASSFILES="$CLASSFILES \$(top_srcdir)/\$(DOMAIN)_$lang.class"
+    QMFILES="$QMFILES $srcdirpre$lang.qm"
+    frobbedlang=`echo $lang | sed -e 's/\..*$//' -e 'y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/'`
+    MSGFILES="$MSGFILES $srcdirpre$frobbedlang.msg"
+    frobbedlang=`echo $lang | sed -e 's/_/-/g' -e 's/^sr-CS/sr-SP/' -e 's/@latin$/-Latn/' -e 's/@cyrillic$/-Cyrl/' -e 's/^sr-SP$/sr-SP-Latn/' -e 's/^uz-UZ$/uz-UZ-Latn/'`
+    RESOURCESDLLFILES="$RESOURCESDLLFILES $srcdirpre$frobbedlang/\$(DOMAIN).resources.dll"
+  done
+  # CATALOGS depends on both $ac_dir and the user's LINGUAS
+  # environment variable.
+  INST_LINGUAS=
+  if test -n "$ALL_LINGUAS"; then
+    for presentlang in $ALL_LINGUAS; do
+      useit=no
+      if test "%UNSET%" != "$LINGUAS"; then
+        desiredlanguages="$LINGUAS"
+      else
+        desiredlanguages="$ALL_LINGUAS"
+      fi
+      for desiredlang in $desiredlanguages; do
+        # Use the presentlang catalog if desiredlang is
+        #   a. equal to presentlang, or
+        #   b. a variant of presentlang (because in this case,
+        #      presentlang can be used as a fallback for messages
+        #      which are not translated in the desiredlang catalog).
+        case "$desiredlang" in
+          "$presentlang"*) useit=yes;;
+        esac
+      done
+      if test $useit = yes; then
+        INST_LINGUAS="$INST_LINGUAS $presentlang"
+      fi
+    done
+  fi
+  CATALOGS=
+  JAVACATALOGS=
+  QTCATALOGS=
+  TCLCATALOGS=
+  CSHARPCATALOGS=
+  if test -n "$INST_LINGUAS"; then
+    for lang in $INST_LINGUAS; do
+      CATALOGS="$CATALOGS $lang.gmo"
+      JAVACATALOGS="$JAVACATALOGS \$(DOMAIN)_$lang.properties"
+      QTCATALOGS="$QTCATALOGS $lang.qm"
+      frobbedlang=`echo $lang | sed -e 's/\..*$//' -e 'y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/'`
+      TCLCATALOGS="$TCLCATALOGS $frobbedlang.msg"
+      frobbedlang=`echo $lang | sed -e 's/_/-/g' -e 's/^sr-CS/sr-SP/' -e 's/@latin$/-Latn/' -e 's/@cyrillic$/-Cyrl/' -e 's/^sr-SP$/sr-SP-Latn/' -e 's/^uz-UZ$/uz-UZ-Latn/'`
+      CSHARPCATALOGS="$CSHARPCATALOGS $frobbedlang/\$(DOMAIN).resources.dll"
+    done
+  fi
+
+  sed -e "s|@POTFILES_DEPS@|$POTFILES_DEPS|g" -e "s|@POFILES@|$POFILES|g" -e "s|@UPDATEPOFILES@|$UPDATEPOFILES|g" -e "s|@DUMMYPOFILES@|$DUMMYPOFILES|g" -e "s|@GMOFILES@|$GMOFILES|g" -e "s|@PROPERTIESFILES@|$PROPERTIESFILES|g" -e "s|@CLASSFILES@|$CLASSFILES|g" -e "s|@QMFILES@|$QMFILES|g" -e "s|@MSGFILES@|$MSGFILES|g" -e "s|@RESOURCESDLLFILES@|$RESOURCESDLLFILES|g" -e "s|@CATALOGS@|$CATALOGS|g" -e "s|@JAVACATALOGS@|$JAVACATALOGS|g" -e "s|@QTCATALOGS@|$QTCATALOGS|g" -e "s|@TCLCATALOGS@|$TCLCATALOGS|g" -e "s|@CSHARPCATALOGS@|$CSHARPCATALOGS|g" -e 's,^#distdir:,distdir:,' < "$ac_file" > "$ac_file.tmp"
+  if grep -l '@TCLCATALOGS@' "$ac_file" > /dev/null; then
+    # Add dependencies that cannot be formulated as a simple suffix rule.
+    for lang in $ALL_LINGUAS; do
+      frobbedlang=`echo $lang | sed -e 's/\..*$//' -e 'y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/'`
+      cat >> "$ac_file.tmp" <<EOF
+$frobbedlang.msg: $lang.po
+	@echo "\$(MSGFMT) -c --tcl -d \$(srcdir) -l $lang $srcdirpre$lang.po"; \
+	\$(MSGFMT) -c --tcl -d "\$(srcdir)" -l $lang $srcdirpre$lang.po || { rm -f "\$(srcdir)/$frobbedlang.msg"; exit 1; }
+EOF
+    done
+  fi
+  if grep -l '@CSHARPCATALOGS@' "$ac_file" > /dev/null; then
+    # Add dependencies that cannot be formulated as a simple suffix rule.
+    for lang in $ALL_LINGUAS; do
+      frobbedlang=`echo $lang | sed -e 's/_/-/g' -e 's/^sr-CS/sr-SP/' -e 's/@latin$/-Latn/' -e 's/@cyrillic$/-Cyrl/' -e 's/^sr-SP$/sr-SP-Latn/' -e 's/^uz-UZ$/uz-UZ-Latn/'`
+      cat >> "$ac_file.tmp" <<EOF
+$frobbedlang/\$(DOMAIN).resources.dll: $lang.po
+	@echo "\$(MSGFMT) -c --csharp -d \$(srcdir) -l $lang $srcdirpre$lang.po -r \$(DOMAIN)"; \
+	\$(MSGFMT) -c --csharp -d "\$(srcdir)" -l $lang $srcdirpre$lang.po -r "\$(DOMAIN)" || { rm -f "\$(srcdir)/$frobbedlang.msg"; exit 1; }
+EOF
+    done
+  fi
+  if test -n "$POMAKEFILEDEPS"; then
+    cat >> "$ac_file.tmp" <<EOF
+Makefile: $POMAKEFILEDEPS
+EOF
+  fi
+  mv "$ac_file.tmp" "$ac_file"
+])
+
+dnl Initializes the accumulator used by AM_XGETTEXT_OPTION.
+AC_DEFUN([AM_XGETTEXT_OPTION_INIT],
+[
+  XGETTEXT_EXTRA_OPTIONS=
+])
+
+dnl Registers an option to be passed to xgettext in the po subdirectory.
+AC_DEFUN([AM_XGETTEXT_OPTION],
+[
+  AC_REQUIRE([AM_XGETTEXT_OPTION_INIT])
+  XGETTEXT_EXTRA_OPTIONS="$XGETTEXT_EXTRA_OPTIONS $1"
+])
+
+# progtest.m4 serial 4 (gettext-0.14.2)
+dnl Copyright (C) 1996-2003, 2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+dnl Authors:
+dnl   Ulrich Drepper <drepper@cygnus.com>, 1996.
+
+AC_PREREQ(2.50)
+
+# Search path for a program which passes the given test.
+
+dnl AM_PATH_PROG_WITH_TEST(VARIABLE, PROG-TO-CHECK-FOR,
+dnl   TEST-PERFORMED-ON-FOUND_PROGRAM [, VALUE-IF-NOT-FOUND [, PATH]])
+AC_DEFUN([AM_PATH_PROG_WITH_TEST],
+[
+# Prepare PATH_SEPARATOR.
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
+# Find out how to test for executable files. Don't use a zero-byte file,
+# as systems may use methods other than mode bits to determine executability.
+cat >conf$$.file <<_ASEOF
+#! /bin/sh
+exit 0
+_ASEOF
+chmod +x conf$$.file
+if test -x conf$$.file >/dev/null 2>&1; then
+  ac_executable_p="test -x"
+else
+  ac_executable_p="test -f"
+fi
+rm -f conf$$.file
+
+# Extract the first word of "$2", so it can be a program name with args.
+set dummy $2; ac_word=[$]2
+AC_MSG_CHECKING([for $ac_word])
+AC_CACHE_VAL(ac_cv_path_$1,
+[case "[$]$1" in
+  [[\\/]]* | ?:[[\\/]]*)
+    ac_cv_path_$1="[$]$1" # Let the user override the test with a path.
+    ;;
+  *)
+    ac_save_IFS="$IFS"; IFS=$PATH_SEPARATOR
+    for ac_dir in ifelse([$5], , $PATH, [$5]); do
+      IFS="$ac_save_IFS"
+      test -z "$ac_dir" && ac_dir=.
+      for ac_exec_ext in '' $ac_executable_extensions; do
+        if $ac_executable_p "$ac_dir/$ac_word$ac_exec_ext"; then
+          echo "$as_me: trying $ac_dir/$ac_word..." >&AS_MESSAGE_LOG_FD
+          if [$3]; then
+            ac_cv_path_$1="$ac_dir/$ac_word$ac_exec_ext"
+            break 2
+          fi
+        fi
+      done
+    done
+    IFS="$ac_save_IFS"
+dnl If no 4th arg is given, leave the cache variable unset,
+dnl so AC_PATH_PROGS will keep looking.
+ifelse([$4], , , [  test -z "[$]ac_cv_path_$1" && ac_cv_path_$1="$4"
+])dnl
+    ;;
+esac])dnl
+$1="$ac_cv_path_$1"
+if test ifelse([$4], , [-n "[$]$1"], ["[$]$1" != "$4"]); then
+  AC_MSG_RESULT([$]$1)
+else
+  AC_MSG_RESULT(no)
+fi
+AC_SUBST($1)dnl
+])
+
+# Copyright (C) 2002, 2003, 2005, 2006, 2007, 2008  Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -31,10 +2228,10 @@
 # generated from the m4 files accompanying Automake X.Y.
 # (This private macro should not be called outside this file.)
 AC_DEFUN([AM_AUTOMAKE_VERSION],
-[am__api_version='1.10'
+[am__api_version='1.11'
 dnl Some users find AM_AUTOMAKE_VERSION and mistake it for a way to
 dnl require some minimum version.  Point them to the right macro.
-m4_if([$1], [1.10.1], [],
+m4_if([$1], [1.11], [],
       [AC_FATAL([Do not call $0, use AM_INIT_AUTOMAKE([$1]).])])dnl
 ])
 
@@ -48,12 +2245,12 @@
 # AM_SET_CURRENT_AUTOMAKE_VERSION
 # -------------------------------
 # Call AM_AUTOMAKE_VERSION and AM_AUTOMAKE_VERSION so they can be traced.
-# This function is AC_REQUIREd by AC_INIT_AUTOMAKE.
+# This function is AC_REQUIREd by AM_INIT_AUTOMAKE.
 AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],
-[AM_AUTOMAKE_VERSION([1.10.1])dnl
+[AM_AUTOMAKE_VERSION([1.11])dnl
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
-_AM_AUTOCONF_VERSION(AC_AUTOCONF_VERSION)])
+_AM_AUTOCONF_VERSION(m4_defn([AC_AUTOCONF_VERSION]))])
 
 # AM_AUX_DIR_EXPAND                                         -*- Autoconf -*-
 
@@ -110,14 +2307,14 @@
 
 # AM_CONDITIONAL                                            -*- Autoconf -*-
 
-# Copyright (C) 1997, 2000, 2001, 2003, 2004, 2005, 2006
+# Copyright (C) 1997, 2000, 2001, 2003, 2004, 2005, 2006, 2008
 # Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 8
+# serial 9
 
 # AM_CONDITIONAL(NAME, SHELL-CONDITION)
 # -------------------------------------
@@ -130,6 +2327,7 @@
 AC_SUBST([$1_FALSE])dnl
 _AM_SUBST_NOTMAKE([$1_TRUE])dnl
 _AM_SUBST_NOTMAKE([$1_FALSE])dnl
+m4_define([_AM_COND_VALUE_$1], [$2])dnl
 if $2; then
   $1_TRUE=
   $1_FALSE='#'
@@ -143,14 +2341,14 @@
 Usually this means the macro was only invoked conditionally.]])
 fi])])
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006
+# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2009
 # Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 9
+# serial 10
 
 # There are a few dirty hacks below to avoid letting `AC_PROG_CC' be
 # written in clear, in which case automake, when reading aclocal.m4,
@@ -207,6 +2405,16 @@
   if test "$am_compiler_list" = ""; then
      am_compiler_list=`sed -n ['s/^#*\([a-zA-Z0-9]*\))$/\1/p'] < ./depcomp`
   fi
+  am__universal=false
+  m4_case([$1], [CC],
+    [case " $depcc " in #(
+     *\ -arch\ *\ -arch\ *) am__universal=true ;;
+     esac],
+    [CXX],
+    [case " $depcc " in #(
+     *\ -arch\ *\ -arch\ *) am__universal=true ;;
+     esac])
+
   for depmode in $am_compiler_list; do
     # Setup a source with many dependencies, because some compilers
     # like to wrap large dependency lists on column 80 (with \), and
@@ -224,7 +2432,17 @@
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
+    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle `-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs
+    am__obj=sub/conftest.${OBJEXT-o}
+    am__minus_obj="-o $am__obj"
     case $depmode in
+    gcc)
+      # This depmode causes a compiler race in universal mode.
+      test "$am__universal" = false || continue
+      ;;
     nosideeffect)
       # after this tag, mechanisms are not by side-effect, so they'll
       # only be used when explicitly requested
@@ -234,19 +2452,23 @@
 	break
       fi
       ;;
+    msvisualcpp | msvcmsys)
+      # This compiler won't grok `-c -o', but also, the minuso test has
+      # not run yet.  These depmodes are late enough in the game, and
+      # so weak that their functioning should not be impacted.
+      am__obj=conftest.${OBJEXT-o}
+      am__minus_obj=
+      ;;
     none) break ;;
     esac
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
-    # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.
     if depmode=$depmode \
-       source=sub/conftest.c object=sub/conftest.${OBJEXT-o} \
+       source=sub/conftest.c object=$am__obj \
        depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
-       $SHELL ./depcomp $depcc -c -o sub/conftest.${OBJEXT-o} sub/conftest.c \
+       $SHELL ./depcomp $depcc -c $am__minus_obj sub/conftest.c \
          >/dev/null 2>conftest.err &&
        grep sub/conftst1.h sub/conftest.Po > /dev/null 2>&1 &&
        grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
-       grep sub/conftest.${OBJEXT-o} sub/conftest.Po > /dev/null 2>&1 &&
+       grep $am__obj sub/conftest.Po > /dev/null 2>&1 &&
        ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
       # icc doesn't choke on unknown options, it will just issue warnings
       # or remarks (even with -Werror).  So we grep stderr for any message
@@ -303,57 +2525,68 @@
 
 # Generate code to set up dependency tracking.              -*- Autoconf -*-
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005
+# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2008
 # Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-#serial 3
+#serial 5
 
 # _AM_OUTPUT_DEPENDENCY_COMMANDS
 # ------------------------------
 AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
-[for mf in $CONFIG_FILES; do
-  # Strip MF so we end up with the name of the file.
-  mf=`echo "$mf" | sed -e 's/:.*$//'`
-  # Check whether this is an Automake generated Makefile or not.
-  # We used to match only the files named `Makefile.in', but
-  # some people rename them; so instead we look at the file content.
-  # Grep'ing the first line is not enough: some people post-process
-  # each Makefile.in and add a new line on top of each file to say so.
-  # Grep'ing the whole file is not good either: AIX grep has a line
-  # limit of 2048, but all sed's we know have understand at least 4000.
-  if sed -n 's,^#.*generated by automake.*,X,p' "$mf" | grep X >/dev/null 2>&1; then
-    dirpart=`AS_DIRNAME("$mf")`
-  else
-    continue
-  fi
-  # Extract the definition of DEPDIR, am__include, and am__quote
-  # from the Makefile without running `make'.
-  DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
-  test -z "$DEPDIR" && continue
-  am__include=`sed -n 's/^am__include = //p' < "$mf"`
-  test -z "am__include" && continue
-  am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
-  # When using ansi2knr, U may be empty or an underscore; expand it
-  U=`sed -n 's/^U = //p' < "$mf"`
-  # Find all dependency output files, they are included files with
-  # $(DEPDIR) in their names.  We invoke sed twice because it is the
-  # simplest approach to changing $(DEPDIR) to its actual value in the
-  # expansion.
-  for file in `sed -n "
-    s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
-       sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
-    # Make sure the directory exists.
-    test -f "$dirpart/$file" && continue
-    fdir=`AS_DIRNAME(["$file"])`
-    AS_MKDIR_P([$dirpart/$fdir])
-    # echo "creating $dirpart/$file"
-    echo '# dummy' > "$dirpart/$file"
+[{
+  # Autoconf 2.62 quotes --file arguments for eval, but not when files
+  # are listed without --file.  Let's play safe and only enable the eval
+  # if we detect the quoting.
+  case $CONFIG_FILES in
+  *\'*) eval set x "$CONFIG_FILES" ;;
+  *)   set x $CONFIG_FILES ;;
+  esac
+  shift
+  for mf
+  do
+    # Strip MF so we end up with the name of the file.
+    mf=`echo "$mf" | sed -e 's/:.*$//'`
+    # Check whether this is an Automake generated Makefile or not.
+    # We used to match only the files named `Makefile.in', but
+    # some people rename them; so instead we look at the file content.
+    # Grep'ing the first line is not enough: some people post-process
+    # each Makefile.in and add a new line on top of each file to say so.
+    # Grep'ing the whole file is not good either: AIX grep has a line
+    # limit of 2048, but all sed's we know have understand at least 4000.
+    if sed -n 's,^#.*generated by automake.*,X,p' "$mf" | grep X >/dev/null 2>&1; then
+      dirpart=`AS_DIRNAME("$mf")`
+    else
+      continue
+    fi
+    # Extract the definition of DEPDIR, am__include, and am__quote
+    # from the Makefile without running `make'.
+    DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
+    test -z "$DEPDIR" && continue
+    am__include=`sed -n 's/^am__include = //p' < "$mf"`
+    test -z "am__include" && continue
+    am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
+    # When using ansi2knr, U may be empty or an underscore; expand it
+    U=`sed -n 's/^U = //p' < "$mf"`
+    # Find all dependency output files, they are included files with
+    # $(DEPDIR) in their names.  We invoke sed twice because it is the
+    # simplest approach to changing $(DEPDIR) to its actual value in the
+    # expansion.
+    for file in `sed -n "
+      s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
+	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+      # Make sure the directory exists.
+      test -f "$dirpart/$file" && continue
+      fdir=`AS_DIRNAME(["$file"])`
+      AS_MKDIR_P([$dirpart/$fdir])
+      # echo "creating $dirpart/$file"
+      echo '# dummy' > "$dirpart/$file"
+    done
   done
-done
+}
 ])# _AM_OUTPUT_DEPENDENCY_COMMANDS
 
 
@@ -373,13 +2606,13 @@
 # Do all the work for Automake.                             -*- Autoconf -*-
 
 # Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2008 Free Software Foundation, Inc.
+# 2005, 2006, 2008, 2009 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 13
+# serial 16
 
 # This macro actually does too much.  Some checks are only needed if
 # your package does certain things.  But this isn't really a big deal.
@@ -396,7 +2629,7 @@
 # arguments mandatory, and then we can depend on a new Autoconf
 # release and drop the old call support.
 AC_DEFUN([AM_INIT_AUTOMAKE],
-[AC_PREREQ([2.60])dnl
+[AC_PREREQ([2.62])dnl
 dnl Autoconf wants to disallow AM_ names.  We explicitly allow
 dnl the ones we care about.
 m4_pattern_allow([^AM_[A-Z]+FLAGS$])dnl
@@ -447,8 +2680,8 @@
 AM_MISSING_PROG(AUTOMAKE, automake-${am__api_version})
 AM_MISSING_PROG(AUTOHEADER, autoheader)
 AM_MISSING_PROG(MAKEINFO, makeinfo)
-AM_PROG_INSTALL_SH
-AM_PROG_INSTALL_STRIP
+AC_REQUIRE([AM_PROG_INSTALL_SH])dnl
+AC_REQUIRE([AM_PROG_INSTALL_STRIP])dnl
 AC_REQUIRE([AM_PROG_MKDIR_P])dnl
 # We need awk for the "check" target.  The system "awk" is bad on
 # some platforms.
@@ -456,24 +2689,37 @@
 AC_REQUIRE([AC_PROG_MAKE_SET])dnl
 AC_REQUIRE([AM_SET_LEADING_DOT])dnl
 _AM_IF_OPTION([tar-ustar], [_AM_PROG_TAR([ustar])],
-              [_AM_IF_OPTION([tar-pax], [_AM_PROG_TAR([pax])],
-	      		     [_AM_PROG_TAR([v7])])])
+	      [_AM_IF_OPTION([tar-pax], [_AM_PROG_TAR([pax])],
+			     [_AM_PROG_TAR([v7])])])
 _AM_IF_OPTION([no-dependencies],,
 [AC_PROVIDE_IFELSE([AC_PROG_CC],
-                  [_AM_DEPENDENCIES(CC)],
-                  [define([AC_PROG_CC],
-                          defn([AC_PROG_CC])[_AM_DEPENDENCIES(CC)])])dnl
+		  [_AM_DEPENDENCIES(CC)],
+		  [define([AC_PROG_CC],
+			  defn([AC_PROG_CC])[_AM_DEPENDENCIES(CC)])])dnl
 AC_PROVIDE_IFELSE([AC_PROG_CXX],
-                  [_AM_DEPENDENCIES(CXX)],
-                  [define([AC_PROG_CXX],
-                          defn([AC_PROG_CXX])[_AM_DEPENDENCIES(CXX)])])dnl
+		  [_AM_DEPENDENCIES(CXX)],
+		  [define([AC_PROG_CXX],
+			  defn([AC_PROG_CXX])[_AM_DEPENDENCIES(CXX)])])dnl
 AC_PROVIDE_IFELSE([AC_PROG_OBJC],
-                  [_AM_DEPENDENCIES(OBJC)],
-                  [define([AC_PROG_OBJC],
-                          defn([AC_PROG_OBJC])[_AM_DEPENDENCIES(OBJC)])])dnl
+		  [_AM_DEPENDENCIES(OBJC)],
+		  [define([AC_PROG_OBJC],
+			  defn([AC_PROG_OBJC])[_AM_DEPENDENCIES(OBJC)])])dnl
 ])
+_AM_IF_OPTION([silent-rules], [AC_REQUIRE([AM_SILENT_RULES])])dnl
+dnl The `parallel-tests' driver may need to know about EXEEXT, so add the
+dnl `am__EXEEXT' conditional if _AM_COMPILER_EXEEXT was seen.  This macro
+dnl is hooked onto _AC_COMPILER_EXEEXT early, see below.
+AC_CONFIG_COMMANDS_PRE(dnl
+[m4_provide_if([_AM_COMPILER_EXEEXT],
+  [AM_CONDITIONAL([am__EXEEXT], [test -n "$EXEEXT"])])])dnl
 ])
 
+dnl Hook into `_AC_COMPILER_EXEEXT' early to learn its expansion.  Do not
+dnl add the conditional right here, as _AC_COMPILER_EXEEXT may be further
+dnl mangled by Autoconf and run in a shell conditional statement.
+m4_define([_AC_COMPILER_EXEEXT],
+m4_defn([_AC_COMPILER_EXEEXT])[m4_provide([_AM_COMPILER_EXEEXT])])
+
 
 # When config.status generates a header, we must update the stamp-h file.
 # This file resides in the same directory as the config header
@@ -496,7 +2742,7 @@
 done
 echo "timestamp for $_am_arg" >`AS_DIRNAME(["$_am_arg"])`/stamp-h[]$_am_stamp_count])
 
-# Copyright (C) 2001, 2003, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2001, 2003, 2005, 2008  Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -507,7 +2753,14 @@
 # Define $install_sh.
 AC_DEFUN([AM_PROG_INSTALL_SH],
 [AC_REQUIRE([AM_AUX_DIR_EXPAND])dnl
-install_sh=${install_sh-"\$(SHELL) $am_aux_dir/install-sh"}
+if test x"${install_sh}" != xset; then
+  case $am_aux_dir in
+  *\ * | *\	*)
+    install_sh="\${SHELL} '$am_aux_dir/install-sh'" ;;
+  *)
+    install_sh="\${SHELL} $am_aux_dir/install-sh"
+  esac
+fi
 AC_SUBST(install_sh)])
 
 # Copyright (C) 2003, 2005  Free Software Foundation, Inc.
@@ -554,13 +2807,13 @@
 
 # Check to see how 'make' treats includes.	            -*- Autoconf -*-
 
-# Copyright (C) 2001, 2002, 2003, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2001, 2002, 2003, 2005, 2009  Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 3
+# serial 4
 
 # AM_MAKE_INCLUDE()
 # -----------------
@@ -569,7 +2822,7 @@
 [am_make=${MAKE-make}
 cat > confinc << 'END'
 am__doit:
-	@echo done
+	@echo this is the am__doit target
 .PHONY: am__doit
 END
 # If we don't find an include directive, just comment out the code.
@@ -579,24 +2832,24 @@
 _am_result=none
 # First try GNU make style include.
 echo "include confinc" > confmf
-# We grep out `Entering directory' and `Leaving directory'
-# messages which can occur if `w' ends up in MAKEFLAGS.
-# In particular we don't look at `^make:' because GNU make might
-# be invoked under some other name (usually "gmake"), in which
-# case it prints its new name instead of `make'.
-if test "`$am_make -s -f confmf 2> /dev/null | grep -v 'ing directory'`" = "done"; then
-   am__include=include
-   am__quote=
-   _am_result=GNU
-fi
+# Ignore all kinds of additional output from `make'.
+case `$am_make -s -f confmf 2> /dev/null` in #(
+*the\ am__doit\ target*)
+  am__include=include
+  am__quote=
+  _am_result=GNU
+  ;;
+esac
 # Now try BSD make style include.
 if test "$am__include" = "#"; then
    echo '.include "confinc"' > confmf
-   if test "`$am_make -s -f confmf 2> /dev/null`" = "done"; then
-      am__include=.include
-      am__quote="\""
-      _am_result=BSD
-   fi
+   case `$am_make -s -f confmf 2> /dev/null` in #(
+   *the\ am__doit\ target*)
+     am__include=.include
+     am__quote="\""
+     _am_result=BSD
+     ;;
+   esac
 fi
 AC_SUBST([am__include])
 AC_SUBST([am__quote])
@@ -604,14 +2857,14 @@
 rm -f confinc confmf
 ])
 
-# Copyright (C) 1999, 2000, 2001, 2003, 2004, 2005
+# Copyright (C) 1999, 2000, 2001, 2003, 2004, 2005, 2008
 # Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
+# serial 6
 
 # AM_PROG_CC_C_O
 # --------------
@@ -623,8 +2876,9 @@
 # FIXME: we rely on the cache variable name because
 # there is no other way.
 set dummy $CC
-ac_cc=`echo $[2] | sed ['s/[^a-zA-Z0-9_]/_/g;s/^[0-9]/_/']`
-if eval "test \"`echo '$ac_cv_prog_cc_'${ac_cc}_c_o`\" != yes"; then
+am_cc=`echo $[2] | sed ['s/[^a-zA-Z0-9_]/_/g;s/^[0-9]/_/']`
+eval am_t=\$ac_cv_prog_cc_${am_cc}_c_o
+if test "$am_t" != yes; then
    # Losing compiler, so override with the script.
    # FIXME: It is wrong to rewrite CC.
    # But if we don't then we get into trouble of one sort or another.
@@ -640,14 +2894,14 @@
 
 # Fake the existence of programs that GNU maintainers use.  -*- Autoconf -*-
 
-# Copyright (C) 1997, 1999, 2000, 2001, 2003, 2004, 2005
+# Copyright (C) 1997, 1999, 2000, 2001, 2003, 2004, 2005, 2008
 # Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
+# serial 6
 
 # AM_MISSING_PROG(NAME, PROGRAM)
 # ------------------------------
@@ -664,7 +2918,14 @@
 AC_DEFUN([AM_MISSING_HAS_RUN],
 [AC_REQUIRE([AM_AUX_DIR_EXPAND])dnl
 AC_REQUIRE_AUX_FILE([missing])dnl
-test x"${MISSING+set}" = xset || MISSING="\${SHELL} $am_aux_dir/missing"
+if test x"${MISSING+set}" != xset; then
+  case $am_aux_dir in
+  *\ * | *\	*)
+    MISSING="\${SHELL} \"$am_aux_dir/missing\"" ;;
+  *)
+    MISSING="\${SHELL} $am_aux_dir/missing" ;;
+  esac
+fi
 # Use eval to expand $SHELL
 if eval "$MISSING --run true"; then
   am_missing_run="$MISSING --run "
@@ -702,13 +2963,13 @@
 
 # Helper functions for option handling.                     -*- Autoconf -*-
 
-# Copyright (C) 2001, 2002, 2003, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2001, 2002, 2003, 2005, 2008  Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 3
+# serial 4
 
 # _AM_MANGLE_OPTION(NAME)
 # -----------------------
@@ -725,7 +2986,7 @@
 # ----------------------------------
 # OPTIONS is a space-separated list of Automake options.
 AC_DEFUN([_AM_SET_OPTIONS],
-[AC_FOREACH([_AM_Option], [$1], [_AM_SET_OPTION(_AM_Option)])])
+[m4_foreach_w([_AM_Option], [$1], [_AM_SET_OPTION(_AM_Option)])])
 
 # _AM_IF_OPTION(OPTION, IF-SET, [IF-NOT-SET])
 # -------------------------------------------
@@ -733,7 +2994,7 @@
 AC_DEFUN([_AM_IF_OPTION],
 [m4_ifset(_AM_MANGLE_OPTION([$1]), [$2], [$3])])
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005
+# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2008, 2009
 # Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
@@ -764,13 +3025,11 @@
 # numbers and dots only.
 AC_DEFUN([AM_PATH_PYTHON],
  [
-  dnl Find a Python interpreter.  Python versions prior to 1.5 are not
-  dnl supported because the default installation locations changed from
-  dnl $prefix/lib/site-python in 1.4 to $prefix/lib/python1.5/site-packages
-  dnl in 1.5.
+  dnl Find a Python interpreter.  Python versions prior to 2.0 are not
+  dnl supported. (2.0 was released on October 16, 2000).
   m4_define_default([_AM_PYTHON_INTERPRETER_LIST],
-                    [python python2 python2.5 python2.4 python2.3 python2.2 dnl
-python2.1 python2.0 python1.6 python1.5])
+                    [python python2 python3 python3.0 python2.5 python2.4 python2.3 python2.2 dnl
+python2.1 python2.0])
 
   m4_if([$1],[],[
     dnl No version check is needed.
@@ -817,7 +3076,7 @@
   dnl library.
 
   AC_CACHE_CHECK([for $am_display_PYTHON version], [am_cv_python_version],
-    [am_cv_python_version=`$PYTHON -c "import sys; print sys.version[[:3]]"`])
+    [am_cv_python_version=`$PYTHON -c "import sys; sys.stdout.write(sys.version[[:3]])"`])
   AC_SUBST([PYTHON_VERSION], [$am_cv_python_version])
 
   dnl Use the values of $prefix and $exec_prefix for the corresponding
@@ -832,7 +3091,7 @@
   dnl to know which OS platform Python thinks this is.
 
   AC_CACHE_CHECK([for $am_display_PYTHON platform], [am_cv_python_platform],
-    [am_cv_python_platform=`$PYTHON -c "import sys; print sys.platform"`])
+    [am_cv_python_platform=`$PYTHON -c "import sys; sys.stdout.write(sys.platform)"`])
   AC_SUBST([PYTHON_PLATFORM], [$am_cv_python_platform])
 
 
@@ -847,8 +3106,21 @@
   dnl doesn't work.
   AC_CACHE_CHECK([for $am_display_PYTHON script directory],
     [am_cv_python_pythondir],
-    [am_cv_python_pythondir=`$PYTHON -c "from distutils import sysconfig; print sysconfig.get_python_lib(0,0,prefix='$PYTHON_PREFIX')" 2>/dev/null ||
-     echo "$PYTHON_PREFIX/lib/python$PYTHON_VERSION/site-packages"`])
+    [if test "x$prefix" = xNONE
+     then
+       am_py_prefix=$ac_default_prefix
+     else
+       am_py_prefix=$prefix
+     fi
+     am_cv_python_pythondir=`$PYTHON -c "import sys; from distutils import sysconfig; sys.stdout.write(sysconfig.get_python_lib(0,0,prefix='$am_py_prefix'))" 2>/dev/null ||
+     echo "$PYTHON_PREFIX/lib/python$PYTHON_VERSION/site-packages"`
+     case $am_cv_python_pythondir in
+     $am_py_prefix*)
+       am__strip_prefix=`echo "$am_py_prefix" | sed 's|.|.|g'`
+       am_cv_python_pythondir=`echo "$am_cv_python_pythondir" | sed "s,^$am__strip_prefix,$PYTHON_PREFIX,"`
+       ;;
+     esac
+    ])
   AC_SUBST([pythondir], [$am_cv_python_pythondir])
 
   dnl pkgpythondir -- $PACKAGE directory under pythondir.  Was
@@ -864,8 +3136,21 @@
   dnl doesn't work.
   AC_CACHE_CHECK([for $am_display_PYTHON extension module directory],
     [am_cv_python_pyexecdir],
-    [am_cv_python_pyexecdir=`$PYTHON -c "from distutils import sysconfig; print sysconfig.get_python_lib(1,0,prefix='$PYTHON_EXEC_PREFIX')" 2>/dev/null ||
-     echo "${PYTHON_EXEC_PREFIX}/lib/python${PYTHON_VERSION}/site-packages"`])
+    [if test "x$exec_prefix" = xNONE
+     then
+       am_py_exec_prefix=$am_py_prefix
+     else
+       am_py_exec_prefix=$exec_prefix
+     fi
+     am_cv_python_pyexecdir=`$PYTHON -c "import sys; from distutils import sysconfig; sys.stdout.write(sysconfig.get_python_lib(1,0,prefix='$am_py_exec_prefix'))" 2>/dev/null ||
+     echo "$PYTHON_EXEC_PREFIX/lib/python$PYTHON_VERSION/site-packages"`
+     case $am_cv_python_pyexecdir in
+     $am_py_exec_prefix*)
+       am__strip_prefix=`echo "$am_py_exec_prefix" | sed 's|.|.|g'`
+       am_cv_python_pyexecdir=`echo "$am_cv_python_pyexecdir" | sed "s,^$am__strip_prefix,$PYTHON_EXEC_PREFIX,"`
+       ;;
+     esac
+    ])
   AC_SUBST([pyexecdir], [$am_cv_python_pyexecdir])
 
   dnl pkgpyexecdir -- $(pyexecdir)/$(PACKAGE)
@@ -885,15 +3170,16 @@
 # Run ACTION-IF-FALSE otherwise.
 # This test uses sys.hexversion instead of the string equivalent (first
 # word of sys.version), in order to cope with versions such as 2.2c1.
-# hexversion has been introduced in Python 1.5.2; it's probably not
-# worth to support older versions (1.5.1 was released on October 31, 1998).
+# This supports Python 2.0 or higher. (2.0 was released on October 16, 2000).
 AC_DEFUN([AM_PYTHON_CHECK_VERSION],
- [prog="import sys, string
+ [prog="import sys
 # split strings by '.' and convert to numeric.  Append some zeros
 # because we need at least 4 digits for the hex conversion.
-minver = map(int, string.split('$2', '.')) + [[0, 0, 0]]
+# map returns an iterator in Python 3.0 and a list in 2.x
+minver = list(map(int, '$2'.split('.'))) + [[0, 0, 0]]
 minverhex = 0
-for i in xrange(0, 4): minverhex = (minverhex << 8) + minver[[i]]
+# xrange is not present in Python 3.0 and range returns an iterator
+for i in list(range(0, 4)): minverhex = (minverhex << 8) + minver[[i]]
 sys.exit(sys.hexversion < minverhex)"
   AS_IF([AM_RUN_LOG([$1 -c "$prog"])], [$3], [$4])])
 
@@ -916,14 +3202,14 @@
 
 # Check to make sure that the build environment is sane.    -*- Autoconf -*-
 
-# Copyright (C) 1996, 1997, 2000, 2001, 2003, 2005
+# Copyright (C) 1996, 1997, 2000, 2001, 2003, 2005, 2008
 # Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 4
+# serial 5
 
 # AM_SANITY_CHECK
 # ---------------
@@ -932,16 +3218,29 @@
 # Just in case
 sleep 1
 echo timestamp > conftest.file
+# Reject unsafe characters in $srcdir or the absolute working directory
+# name.  Accept space and tab only in the latter.
+am_lf='
+'
+case `pwd` in
+  *[[\\\"\#\$\&\'\`$am_lf]]*)
+    AC_MSG_ERROR([unsafe absolute working directory name]);;
+esac
+case $srcdir in
+  *[[\\\"\#\$\&\'\`$am_lf\ \	]]*)
+    AC_MSG_ERROR([unsafe srcdir value: `$srcdir']);;
+esac
+
 # Do `set' in a subshell so we don't clobber the current shell's
 # arguments.  Must try -L first in case configure is actually a
 # symlink; some systems play weird games with the mod time of symlinks
 # (eg FreeBSD returns the mod time of the symlink's containing
 # directory).
 if (
-   set X `ls -Lt $srcdir/configure conftest.file 2> /dev/null`
+   set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
    if test "$[*]" = "X"; then
       # -L didn't work.
-      set X `ls -t $srcdir/configure conftest.file`
+      set X `ls -t "$srcdir/configure" conftest.file`
    fi
    rm -f conftest.file
    if test "$[*]" != "X $srcdir/configure conftest.file" \
@@ -994,18 +3293,25 @@
 INSTALL_STRIP_PROGRAM="\$(install_sh) -c -s"
 AC_SUBST([INSTALL_STRIP_PROGRAM])])
 
-# Copyright (C) 2006  Free Software Foundation, Inc.
+# Copyright (C) 2006, 2008  Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
+# serial 2
+
 # _AM_SUBST_NOTMAKE(VARIABLE)
 # ---------------------------
 # Prevent Automake from outputting VARIABLE = @VARIABLE@ in Makefile.in.
 # This macro is traced by Automake.
 AC_DEFUN([_AM_SUBST_NOTMAKE])
 
+# AM_SUBST_NOTMAKE(VARIABLE)
+# ---------------------------
+# Public sister of _AM_SUBST_NOTMAKE.
+AC_DEFUN([AM_SUBST_NOTMAKE], [_AM_SUBST_NOTMAKE($@)])
+
 # Check how to create a tarball.                            -*- Autoconf -*-
 
 # Copyright (C) 2004, 2005  Free Software Foundation, Inc.
