#!/bin/sh
set -e

prefix=@prefix@
sysconfdir=@sysconfdir@

ID=`id -u`
if [ $ID -ne 0 ] ; then
	echo "You are not root" >&2
	exit 1
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

# we are doing upgrade or removal

case "$1" in
    configure)
		if [ " $2" = " " ] ; then
		echo "installing tinydnssec"
		else
		echo "upgrading tinydnssec $2"
		fi
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
	exit 0
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

/bin/rmdir --ignore-fail-on-non-empty ${sysconfdir}/dnscache 2>/dev/null
/bin/rmdir --ignore-fail-on-non-empty ${sysconfdir}/tinydns 2>/dev/null
if [ ! -d ${sysconfdir}/dnscache ] ; then
  ${prefix}/bin/dnscache-conf dnscache dnslog ${sysconfdir}/dnscache 127.0.0.1
  if [ $? -eq 0 ] ; then
    ln -s ${sysconfdir}/dnscache /service/dnscache
  fi
fi
