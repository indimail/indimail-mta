<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><link rel='stylesheet' type='text/css' href='manpage.css'>
  <!-- $Id: maildiracl.sgml,v 1.1 2004/01/11 02:47:33 mrsam Exp $ -->
  <!-- Copyright 2003 Double Precision, Inc.  See COPYING for -->
  <!-- distribution information. -->
<meta name="MSSmartTagsPreventParsing" content="TRUE">
<link rel="icon" href="icon.gif" type="image/gif" />
<TITLE
>maildiracl</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"></HEAD
><BODY
CLASS="REFENTRY"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><H1
><A
NAME="MAILDIRACL"
></A
>maildiracl</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN6"
></A
><H2
>Name</H2
>maildiracl&nbsp;--&nbsp;manage access control lists</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN9"
></A
><H2
>Synopsis</H2
><P
><B
CLASS="COMMAND"
>maildiracl</B
> {-reset} {<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>}</P
><P
><B
CLASS="COMMAND"
>maildiracl</B
> {-list} {<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>} {<VAR
CLASS="REPLACEABLE"
>INBOX[.folder]</VAR
>}</P
><P
><B
CLASS="COMMAND"
>maildiracl</B
> {-set} {<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>} {<VAR
CLASS="REPLACEABLE"
>INBOX[.folder]</VAR
>} {<VAR
CLASS="REPLACEABLE"
>[-]identifier</VAR
>} {<VAR
CLASS="REPLACEABLE"
>[+/-]rights</VAR
>}</P
><P
><B
CLASS="COMMAND"
>maildiracl</B
> {-delete} {<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>} {<VAR
CLASS="REPLACEABLE"
>INBOX[.folder]</VAR
>} {<VAR
CLASS="REPLACEABLE"
>[-]identifier</VAR
>}</P
><P
><B
CLASS="COMMAND"
>maildiracl</B
> {-compute} {<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>} {<VAR
CLASS="REPLACEABLE"
>INBOX[.folder]</VAR
>} {<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>...}</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN51"
></A
><H2
>DESCRIPTION</H2
><P
><B
CLASS="COMMAND"
>maildiracl</B
>
manages <SPAN
CLASS="QUOTE"
>"access control lists"</SPAN
> (or ACLs)
of <TT
CLASS="APPLICATION"
>Courier-IMAP</TT
> maildir folders.
Access control lists are used primarily to provide fine-grained control
for accessing virtual shared folders via IMAP.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
>NOTE:</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>The <TT
CLASS="APPLICATION"
>Courier-IMAP</TT
> server implements two types of shared folders:
filesystem permission-based shared folders,
as well as virtual shared folders based on IMAP access control lists.
Use the <B
CLASS="COMMAND"
>maildiracl</B
>
command to set up access control lists for virtual shared folders.
Use the
<A
HREF="maildirmake.html"
TARGET="_top"
><SPAN
CLASS="CITEREFENTRY"
><SPAN
CLASS="REFENTRYTITLE"
>maildirmake</SPAN
>(1)</SPAN
></A
>,
command
to implement shared folders based on
filesystem permissions.</P
><P
>See the <TT
CLASS="APPLICATION"
>Courier-IMAP</TT
> server documentation for additional information
on setting up virtual shared folders.</P
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="AEN67"
></A
><H3
>ACL overview</H3
><P
>ACLs provide a fine-grained mechanism for controlling
access to shared folders.
ACLs may be used to specify, for example, that
<TT
CLASS="LITERAL"
>user1</TT
> may only open and read the messages in the folder;
and <TT
CLASS="LITERAL"
>user2</TT
> can not only do that, but also delete messages,
and create subfolders.</P
><P
>Each folder maintains its own individual access control list, that specifies
who can do what to the folder.
An ACL is a list of <SPAN
CLASS="QUOTE"
>"identifier"</SPAN
> and <SPAN
CLASS="QUOTE"
>"rights"</SPAN
>
pairs.
Each <SPAN
CLASS="QUOTE"
>"identifier"</SPAN
> and <SPAN
CLASS="QUOTE"
>"rights"</SPAN
> pair means that an
entity called <SPAN
CLASS="QUOTE"
>"identifier"</SPAN
>
(using the <TT
CLASS="LITERAL"
>UTF-8</TT
> character set)
is allowed to do <SPAN
CLASS="QUOTE"
>"rights"</SPAN
>
on this folder.
<SPAN
CLASS="QUOTE"
>"rights"</SPAN
> consists of one or more letters, each letter
signifies a particular action:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>a</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may modify this folder's ACLs.</P
></DD
><DT
>c</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may create subfolders of this folder (this includes renaming another
folder as this folder's subfolders).</P
></DD
><DT
>e</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may remove deleted messages from this folder.</P
></DD
><DT
>i</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may add messages to this folder (either uploading them one by one,
or copying messages from another folder).</P
></DD
><DT
>l</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may actually see that this folder exists.
If <VAR
CLASS="REPLACEABLE"
>identifier</VAR
> does not have the <SPAN
CLASS="QUOTE"
>"l"</SPAN
>
right on this folder, the folder is effectively invisible to
<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>.</P
></DD
><DT
>r</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may open this folder.
Note that if <VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
knows the name of this folder, it can open it even if
<VAR
CLASS="REPLACEABLE"
>identifier</VAR
> does not the <SPAN
CLASS="QUOTE"
>"l"</SPAN
>
right on this folder.</P
></DD
><DT
>s</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may mark messages in this folder as seen, or unseen.</P
></DD
><DT
>t</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may mark messages in this folder as deleted, or undeleted.</P
></DD
><DT
>w</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may change other status flags of messages in this folder.
May also add or remove custom keywords on individual messages.</P
></DD
><DT
>x</DT
><DD
><P
><VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
may delete this folder (which includes renaming this folder as another
mailbox's subfoler.</P
></DD
></DL
></DIV
><DIV
CLASS="REFSECT3"
><A
NAME="AEN138"
></A
><H4
>Negative rights</H4
><P
>An ACL entry of <SPAN
CLASS="QUOTE"
>"-identifier"</SPAN
> and <SPAN
CLASS="QUOTE"
>"rights"</SPAN
>
is called a <SPAN
CLASS="QUOTE"
>"negative right"</SPAN
>, which
explicitly removes <SPAN
CLASS="QUOTE"
>"rights"</SPAN
> from <SPAN
CLASS="QUOTE"
>"identifier"</SPAN
>.
More than one <SPAN
CLASS="QUOTE"
>"identifier"</SPAN
> is usually used to determine the
actual rights someone has for the given folder.
The actual access rights are determined by taking all rights from all
applicable <VAR
CLASS="REPLACEABLE"
>identifier</VAR
>, than subtracting any
negative rights, as specified in the following section.</P
></DIV
><DIV
CLASS="REFSECT3"
><A
NAME="AEN148"
></A
><H4
>Identifiers</H4
><P
>Access rights on a given folder are computed by obtained the rights
on the following identifiers, then subtracting the negative rights on the
same identifiers:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>owner</TT
></DT
><DD
><P
>The owner of the maildir containing this folder.
The maildir's INBOX's ACL defaults to all rights for its owner.
A new folder's ACL is the same as its parent's ACL.
In all cases, trying to remove the <SPAN
CLASS="QUOTE"
>"a"</SPAN
> right from the owner
(either directly or using a negative right) results in an error.</P
></DD
><DT
><TT
CLASS="LITERAL"
>anyone</TT
></DT
><DD
><P
>This identifier refers literally to every userid.
The associated rights (or negative rights) are always used.</P
></DD
><DT
><TT
CLASS="LITERAL"
>anonymous</TT
></DT
><DD
><P
>This is a synonym from <SPAN
CLASS="QUOTE"
>"anyone"</SPAN
>.</P
></DD
><DT
><TT
CLASS="LITERAL"
>user=</TT
><VAR
CLASS="REPLACEABLE"
>loginid</VAR
></DT
><DD
><P
>Rights (or negative rights) for IMAP account <SPAN
CLASS="QUOTE"
>"loginid"</SPAN
>.
<DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
>NOTE:</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
><SPAN
CLASS="QUOTE"
>"loginid"</SPAN
> is what's logged to syslog after a succesful
login.
In some situations <SPAN
CLASS="QUOTE"
>"loginid"</SPAN
> is not exactly the actual login ID
used by the IMAP client.</P
></TD
></TR
></TABLE
></DIV
></P
></DD
></DL
></DIV
><P
>Consider the following access control list:</P
><DIV
CLASS="INFORMALEXAMPLE"
><P
></P
><A
NAME="AEN181"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>owner       aceilrstwx
anyone      lr
user=john   w
-user=mary  r</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>This access control list specifies that the folder's owner has complete
control over the mailbox; everyone else can see it and open it,
except for <SPAN
CLASS="QUOTE"
>"mary"</SPAN
> who can see that the mailbox exists, but
can't open it; additionally, <SPAN
CLASS="QUOTE"
>"john"</SPAN
> can change the status and
keywords of individual messages (but not mark them as deleted/undeleted or
seen/unseen, which requires additional rights).</P
></DIV
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN186"
></A
><H2
>OPTIONS</H2
><P
><B
CLASS="COMMAND"
>maildiracl -reset <VAR
CLASS="REPLACEABLE"
>maildir</VAR
></B
></P
><P
>This command resets access control lists in
<TT
CLASS="FILENAME"
><VAR
CLASS="REPLACEABLE"
>maildir</VAR
></TT
>
which as a path to a maildir.
Under certain conditions, the files where a folder's ACLs are saved may
continue to exist after the folder is removed.
The <TT
CLASS="LITERAL"
>-reset</TT
> options goes through
<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>
and removes all stale ACL files for removed folders.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
>NOTE:</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>The <TT
CLASS="APPLICATION"
>Courier-IMAP</TT
> server normally performs this maintenance
function automatically.
It is not necessary to run this command under normal conditions.</P
></TD
></TR
></TABLE
></DIV
><P
><B
CLASS="COMMAND"
>maildiracl -list
<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>
<VAR
CLASS="REPLACEABLE"
>folder</VAR
></B
></P
><P
>This command
lists the access control lists set for <VAR
CLASS="REPLACEABLE"
>folder</VAR
>.
<VAR
CLASS="REPLACEABLE"
>folder</VAR
> must be either
<SPAN
CLASS="QUOTE"
>"INBOX"</SPAN
> or <SPAN
CLASS="QUOTE"
>"INBOX.folder.subfolder"</SPAN
>, which is the
same naming convention for <TT
CLASS="APPLICATION"
>Courier-IMAP</TT
>.</P
><P
><B
CLASS="COMMAND"
>maildiracl -set
<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>
<VAR
CLASS="REPLACEABLE"
>folder</VAR
>
<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
<VAR
CLASS="REPLACEABLE"
>rights</VAR
></B
></P
><P
>Puts <VAR
CLASS="REPLACEABLE"
>identifier</VAR
> (which may begin with a minus
sign to specify a negative right) and
<VAR
CLASS="REPLACEABLE"
>rights</VAR
> in
<VAR
CLASS="REPLACEABLE"
>folder</VAR
>'s access control list.
Existing rights for
<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
(or <VAR
CLASS="REPLACEABLE"
>identifier</VAR
>) are replaced by
<VAR
CLASS="REPLACEABLE"
>rights</VAR
> unless <SPAN
CLASS="QUOTE"
>"rights"</SPAN
> begins with
<SPAN
CLASS="QUOTE"
>"+"</SPAN
> or <SPAN
CLASS="QUOTE"
>"-"</SPAN
>, which modifies the existing rights
by adding or removing from them accordingly.
Some examples:</P
><DIV
CLASS="INFORMALEXAMPLE"
><P
></P
><A
NAME="AEN225"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>maildiracl -set /home/user1/Maildir INBOX.Sent user=john lr

maildiracl -set /home/user2/Maildir INBOX.Notes anyone -r

maildiracl -set /home/user3/Maildir INBOX.Private -user=tom +r</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
>NOTE:</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Observe that the last command <I
CLASS="EMPHASIS"
>revokes</I
> the <SPAN
CLASS="QUOTE"
>"r"</SPAN
>
right from <SPAN
CLASS="QUOTE"
>"tom"</SPAN
>, by adding it as a negative right.</P
></TD
></TR
></TABLE
></DIV
><P
><B
CLASS="COMMAND"
>maildiracl -delete
<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>
<VAR
CLASS="REPLACEABLE"
>folder</VAR
>
<VAR
CLASS="REPLACEABLE"
>identifier</VAR
></B
></P
><P
>This command removes <VAR
CLASS="REPLACEABLE"
>identifier</VAR
>
from
<VAR
CLASS="REPLACEABLE"
>folder</VAR
>'s access control list, if it exists.
Use <SPAN
CLASS="QUOTE"
>"-<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>"</SPAN
> to remove
negative rights.</P
><P
><B
CLASS="COMMAND"
>maildiracl -compute
<VAR
CLASS="REPLACEABLE"
>maildir</VAR
>
<VAR
CLASS="REPLACEABLE"
>folder</VAR
>
[<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>]+</B
></P
><P
>This command takes a list of one or more
<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>s.
All access rights for the
<VAR
CLASS="REPLACEABLE"
>identifier</VAR
>s are combined together, then
any appropriate negative rights are removed, and the result is printed
on standard output.
Use the following procedure to compute access rights the same way as they
are computed by <TT
CLASS="APPLICATION"
>Courier-IMAP</TT
>:</P
><DIV
CLASS="INFORMALEXAMPLE"
><P
></P
><A
NAME="AEN251"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>maildiracl -compute /home/tom46/Maildir INBOX.Sent owner user=tom46</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>This command computes access rights <SPAN
CLASS="QUOTE"
>"tom46"</SPAN
> has on
his own folder.</P
><DIV
CLASS="INFORMALEXAMPLE"
><P
></P
><A
NAME="AEN255"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>maildiracl -compute /home/john34/Maildir INBOX.Public user=tom46</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>This command computes access rights <SPAN
CLASS="QUOTE"
>"tom46"</SPAN
> has on
<SPAN
CLASS="QUOTE"
>"john34"</SPAN
>'s folder.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN260"
></A
><H2
>BUGS</H2
><P
>All identifiers are specified using the <TT
CLASS="LITERAL"
>UTF-8</TT
> character
set.</P
><P
>All non-Latin letters in folder names are specified using the
<TT
CLASS="LITERAL"
>modified-UTF7</TT
> coding as used in IMAP.</P
><P
>This implementation of access control lists is based on
version 2 (or <SPAN
CLASS="QUOTE"
>"ACL2"</SPAN
>) of IMAP
access control lists, which is a work-in-progress.
The existing IMAP ACL,
<A
HREF="http://www.rfc-editor.org/rfc/rfc2086.txt"
TARGET="_top"
>RFC 2086</A
>
is transparently implemented inside the ACL2 model.</P
><P
>If history's of any guidance, ACL2 is subject to change at any time.
Be sure to check the release notes
when upgrading to a newer version of this software.
The <SPAN
CLASS="QUOTE"
>"ACL overview"</SPAN
> portion of this manual page is a
<I
CLASS="EMPHASIS"
>very</I
> brief summary of ACL2, which leaves out optional
parts of ACL2 that are not implemented.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN272"
></A
><H2
>SEE ALSO</H2
><P
><A
HREF="maildirmake.html"
TARGET="_top"
><SPAN
CLASS="CITEREFENTRY"
><SPAN
CLASS="REFENTRYTITLE"
>maildirmake</SPAN
>(1)</SPAN
></A
>,
<A
HREF="maildirkw.html"
TARGET="_top"
><SPAN
CLASS="CITEREFENTRY"
><SPAN
CLASS="REFENTRYTITLE"
>maildirkw</SPAN
>(1)</SPAN
></A
>,</P
></DIV
></BODY
></HTML
>