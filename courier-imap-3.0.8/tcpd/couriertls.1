.\"  <!-- $Id: couriertls.sgml,v 1.2 2002/07/11 18:28:14 mrsam Exp $ -->
.\"  <!-- Copyright 2000-2001 Double Precision, Inc.  See COPYING for -->
.\"  <!-- distribution information. -->
.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "COURIERTLS" "1" "02 September 2004" "Double Precision, Inc." ""

.SH NAME
couriertls \- Courier TLS/SSL protocol wrapper
.SH SYNOPSIS

\fBcouriertls\fR [ \fB\fIoption\fB\fR\fI ...\fR ] \fB\fIprogram\fB\fR \fB\fIarg\fB\fR\fI ...\fR

.SH "DESCRIPTION"
.PP
The \fBcouriertls\fR program is used by applications to encrypt a
network connection using SSL/TLS, without having the application deal with the
gory details of SSL/TLS. \fBcouriertls\fR is used by the Courier
IMAP and ESMTP servers.
.PP
\fBcouriertls\fR is not usually run directly from the commandline.
An application typically creates a network connection, then runs
\fBcouriertls\fR with appropriate options to encrypt the network
connection with SSL/TLS.
.SH "OPTIONS"
.TP
\fB-host=\fIhost\fB, -port=\fIport\fB\fR
These options are
used instead of \fB-remotefd\fR, mostly for debugging purposes.
\fBcouriertls\fR connects to the specified server and immediately
starts SSL/TLS negotation when the connection is established.
.TP
\fB-localfd=\fIn\fB\fR
Read and write data to encrypt via SSL/TLS from file descriptor
\fIn\fR\&.
.TP
\fB-statusfd=\fIn\fB\fR
Write SSL negotiation status to file
descriptor \fIn\fR, then close this file descriptor.
If SSL starts
succesfully, reading on \fIn\fR gets an immediate EOF.
Otherwise, a
single line of text - the error message - is read; the file descriptor is
closed; and \fBcouriertls\fR terminates.
.TP
\fB-printx509=\fIn\fB\fR
Print the x509 certificate on file
descriptor \fIn\fR then close it.  The x509 certificate is printed before
SSL/TLS encryption starts.  The application may immediately read the
certificate after running \fBcouriertls\fR, until the file
descriptor is closed.
.TP
\fB-remotefd=\fIn\fB\fR
File descriptor \fIn\fR is the network connection
where SSL/TLS encryption is to be used.
.TP
\fB-server\fR
Negotiate server side of the SSL/TLS connection.
If this option is not used the client side of the SSL/TLS connection is
negotiated.
.TP
\fB-tcpd\fR
\fBcouriertls\fR is being called from
\fBcouriertcpd\fR, and the remote socket is present on descriptors
0 and 1.  \fB-tcpd\fR means, basically, the same as
\fB-remotefd=0\fR, but \fBcouriertls\fR closes file
descriptor 1, and redirects file descriptor 1 to file descriptor 2.
.TP
\fB-verify=\fIdomain\fB\fR
Verify that \fIdomain\fR is set in
the CN field of the trusted X.509 certificate presented by the SSL/TLS
peer. TLS_TRUSTCERTS must be initialized (see below), and the certificate
must be signed by one of the trusted certificates. The CN field can
contain a wildcard: CN=*.example will match
\fB-verify=foo.example.com\fR\&. For
SSL/TLS clients,
\fBTLS_VERIFYPEER\fR must be set to PEER (see below).
.TP
\fB-protocol=\fIproto\fB\fR
Send \fIproto\fR protocol
commands before enabling SSL/TLS on the remote connection. \fIproto\fR is
either "smtp" or "imap".
This is a debugging option that can be used to
troubleshoot SSL/TLS with a remote IMAP or SMTP server.
.PP
If the \fB-remotefd=\fIn\fB\fR option is not
specified, the rest of
the command line specifies the program to run -- and its arguments -- whose
standard input and output is encrypted via SSL/TLS over the network
connection.  If the program is not specified, the standard input and output of
\fBcouriertls\fR itself is encrypted.
.SH "ENVIRONMENT VARIABLES"
.PP
\fBcouriertls\fR reads the following environment variables in
order to configure the SSL/TLS protocol:
.TP
\fBTLS_PROTOCOL=\fIproto\fB\fR
Set the protocol version.  The possible versions are:
SSL2, SSL3,
TLS1\&.
.TP
\fBTLS_CIPHER_LIST=\fIcipherlist\fB\fR
Optionally set the list of protocol ciphers to be used.
See OpenSSL's documentation for more information.
.TP
\fBTLS_TIMEOUT=\fIseconds\fB\fR
Currently not implemented, and
reserved for future use.  This is supposed to be an inactivity timeout,
but it's not yet implemented.
.TP
\fBTLS_DHCERTFILE=\fIfilename\fB\fR
PEM file that stores our
Diffie-Hellman cipher pair. When OpenSSL is compiled to use Diffie-Hellman
ciphers instead of RSA you must generate a DH pair that will be used.  In
most situations the DH pair is to be treated as confidential, and
\fIfilename\fR must not be world-readable.
.TP
\fBTLS_CERTFILE=\fIfilename\fB\fR
The certificate to use.
\fBTLS_CERTFILE\fR is required for SSL/TLS servers, and is optional
for SSL/TLS clients.
\fIfilename\fR must not be world-readable.
.TP
\fBTLS_TRUSTCERTS=\fIpathname\fB\fR
Load trusted root certificates
from \fIpathname\fR\&.  \fIpathname\fR
can be a file or a directory. If a
file, the file should contain a list of trusted certificates, in PEM
format. If a directory, the directory should contain the trusted
certificates, in PEM format, one per file and hashed using OpenSSL's
\fBc_rehash\fR script. \fBTLS_TRUSTCERTS\fR is used by
SSL/TLS clients (by
specifying the \fB-domain\fR option) and by SSL/TLS servers
(\fBTLS_VERIFYPEER\fR is set to PEER or
REQUIREPEER).
.TP
\fBTLS_VERIFYPEER=\fIlevel\fB\fR
Whether to verify peer's
X.509 certificate.  The exact meaning of this option depends upon whether
\fBcouriertls\fR is used in the client or server mode.
In server mode:
NONE - do not request an X.509 certificate from the client;
PEER - request an optional X.509 certificate from the
client, if the client returns one,
the SSL/TLS connection is shut down unless the certificate is signed by a
trusted certificate authority (see TLS_TRUSTCERTS);
REQUIREPEER - same as
PEER, except that the SSL/TLS connects is also shut down if the client
does not return the optional X.509 certificate.  In client mode:
NONE - ignore the server's X.509 certificate;
PEER - verify the server's
X.509 certificate according to the \fB-domain\fR option,
(see above).
.SH "SEE ALSO"
.PP
\fBcouriertcpd\fR(1),
\fBcourier\fR(8)\&.
