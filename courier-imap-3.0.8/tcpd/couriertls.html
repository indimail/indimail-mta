<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><link rel='stylesheet' type='text/css' href='manpage.css'>
  <!-- $Id: couriertls.sgml,v 1.2 2002/07/11 18:28:14 mrsam Exp $ -->
  <!-- Copyright 2000-2001 Double Precision, Inc.  See COPYING for -->
  <!-- distribution information. -->
<meta name="MSSmartTagsPreventParsing" content="TRUE">
<link rel="icon" href="icon.gif" type="image/gif" />
<TITLE
>couriertls</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"></HEAD
><BODY
CLASS="REFENTRY"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><H1
><A
NAME="COURIERTLS"
></A
>couriertls</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN10"
></A
><H2
>Name</H2
>couriertls&nbsp;--&nbsp;Courier TLS/SSL protocol wrapper</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN13"
></A
><H2
>Synopsis</H2
><P
><B
CLASS="COMMAND"
>couriertls</B
> [<VAR
CLASS="REPLACEABLE"
>option</VAR
>...] {<VAR
CLASS="REPLACEABLE"
>program</VAR
>} {<VAR
CLASS="REPLACEABLE"
>arg</VAR
>...}</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN22"
></A
><H2
>DESCRIPTION</H2
><P
>The <B
CLASS="COMMAND"
>couriertls</B
> program is used by applications to encrypt a
network connection using SSL/TLS, without having the application deal with the
gory details of SSL/TLS. <B
CLASS="COMMAND"
>couriertls</B
> is used by the Courier
IMAP and ESMTP servers.</P
><P
><B
CLASS="COMMAND"
>couriertls</B
> is not usually run directly from the commandline.
An application typically creates a network connection, then runs
<B
CLASS="COMMAND"
>couriertls</B
> with appropriate options to encrypt the network
connection with SSL/TLS.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN30"
></A
><H2
>OPTIONS</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-host=<VAR
CLASS="REPLACEABLE"
>host</VAR
>, -port=<VAR
CLASS="REPLACEABLE"
>port</VAR
></DT
><DD
><P
>These options are
used instead of <VAR
CLASS="OPTION"
>-remotefd</VAR
>, mostly for debugging purposes.
<B
CLASS="COMMAND"
>couriertls</B
> connects to the specified server and immediately
starts SSL/TLS negotation when the connection is established.</P
></DD
><DT
>-localfd=<VAR
CLASS="REPLACEABLE"
>n</VAR
></DT
><DD
><P
>Read and write data to encrypt via SSL/TLS from file descriptor
<VAR
CLASS="REPLACEABLE"
>n</VAR
>.</P
></DD
><DT
>-statusfd=<VAR
CLASS="REPLACEABLE"
>n</VAR
></DT
><DD
><P
>Write SSL negotiation status to file
descriptor <VAR
CLASS="REPLACEABLE"
>n</VAR
>, then close this file descriptor.
If SSL starts
succesfully, reading on <VAR
CLASS="REPLACEABLE"
>n</VAR
> gets an immediate EOF.
Otherwise, a
single line of text - the error message - is read; the file descriptor is
closed; and <B
CLASS="COMMAND"
>couriertls</B
> terminates.</P
></DD
><DT
>-printx509=<VAR
CLASS="REPLACEABLE"
>n</VAR
></DT
><DD
><P
>Print the x509 certificate on file
descriptor <VAR
CLASS="REPLACEABLE"
>n</VAR
> then close it.  The x509 certificate is printed before
SSL/TLS encryption starts.  The application may immediately read the
certificate after running <B
CLASS="COMMAND"
>couriertls</B
>, until the file
descriptor is closed.</P
></DD
><DT
>-remotefd=<VAR
CLASS="REPLACEABLE"
>n</VAR
></DT
><DD
><P
>File descriptor <VAR
CLASS="REPLACEABLE"
>n</VAR
> is the network connection
where SSL/TLS encryption is to be used.</P
></DD
><DT
>-server</DT
><DD
><P
>Negotiate server side of the SSL/TLS connection.
If this option is not used the client side of the SSL/TLS connection is
negotiated.</P
></DD
><DT
>-tcpd</DT
><DD
><P
><B
CLASS="COMMAND"
>couriertls</B
> is being called from
<B
CLASS="COMMAND"
>couriertcpd</B
>, and the remote socket is present on descriptors
0 and 1.  <VAR
CLASS="OPTION"
>-tcpd</VAR
> means, basically, the same as
<VAR
CLASS="OPTION"
>-remotefd=0</VAR
>, but <B
CLASS="COMMAND"
>couriertls</B
> closes file
descriptor 1, and redirects file descriptor 1 to file descriptor 2.</P
></DD
><DT
>-verify=<VAR
CLASS="REPLACEABLE"
>domain</VAR
></DT
><DD
><P
>Verify that <VAR
CLASS="REPLACEABLE"
>domain</VAR
> is set in
the CN field of the trusted X.509 certificate presented by the SSL/TLS
peer. TLS_TRUSTCERTS must be initialized (see below), and the certificate
must be signed by one of the trusted certificates. The CN field can
contain a wildcard: <TT
CLASS="LITERAL"
>CN=*.example</TT
> will match
<VAR
CLASS="OPTION"
>-verify=foo.example.com</VAR
>. For
SSL/TLS clients,
<VAR
CLASS="ENVAR"
>TLS_VERIFYPEER</VAR
> must be set to PEER (see below).</P
></DD
><DT
>-protocol=<VAR
CLASS="REPLACEABLE"
>proto</VAR
></DT
><DD
><P
>Send <VAR
CLASS="REPLACEABLE"
>proto</VAR
> protocol
commands before enabling SSL/TLS on the remote connection. <VAR
CLASS="REPLACEABLE"
>proto</VAR
> is
either "<TT
CLASS="LITERAL"
>smtp</TT
>" or "<TT
CLASS="LITERAL"
>imap</TT
>".
This is a debugging option that can be used to
troubleshoot SSL/TLS with a remote IMAP or SMTP server.</P
></DD
></DL
></DIV
><P
>If the <VAR
CLASS="OPTION"
>-remotefd=<VAR
CLASS="REPLACEABLE"
>n</VAR
></VAR
> option is not
specified, the rest of
the command line specifies the program to run -- and its arguments -- whose
standard input and output is encrypted via SSL/TLS over the network
connection.  If the program is not specified, the standard input and output of
<B
CLASS="COMMAND"
>couriertls</B
> itself is encrypted.</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN103"
></A
><H2
>ENVIRONMENT VARIABLES</H2
><P
><B
CLASS="COMMAND"
>couriertls</B
> reads the following environment variables in
order to configure the SSL/TLS protocol:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>TLS_PROTOCOL=<VAR
CLASS="REPLACEABLE"
>proto</VAR
></DT
><DD
><P
>Set the protocol version.  The possible versions are:
<TT
CLASS="LITERAL"
>SSL2</TT
>, <TT
CLASS="LITERAL"
>SSL3</TT
>,
<TT
CLASS="LITERAL"
>TLS1</TT
>.</P
></DD
><DT
>TLS_CIPHER_LIST=<VAR
CLASS="REPLACEABLE"
>cipherlist</VAR
></DT
><DD
><P
>Optionally set the list of protocol ciphers to be used.
See OpenSSL's documentation for more information.</P
></DD
><DT
>TLS_TIMEOUT=<VAR
CLASS="REPLACEABLE"
>seconds</VAR
></DT
><DD
><P
>Currently not implemented, and
reserved for future use.  This is supposed to be an inactivity timeout,
but it's not yet implemented.</P
></DD
><DT
>TLS_DHCERTFILE=<VAR
CLASS="REPLACEABLE"
>filename</VAR
></DT
><DD
><P
>PEM file that stores our
Diffie-Hellman cipher pair. When OpenSSL is compiled to use Diffie-Hellman
ciphers instead of RSA you must generate a DH pair that will be used.  In
most situations the DH pair is to be treated as confidential, and
<VAR
CLASS="REPLACEABLE"
>filename</VAR
> must not be world-readable.</P
></DD
><DT
>TLS_CERTFILE=<VAR
CLASS="REPLACEABLE"
>filename</VAR
></DT
><DD
><P
>The certificate to use.
<VAR
CLASS="ENVAR"
>TLS_CERTFILE</VAR
> is required for SSL/TLS servers, and is optional
for SSL/TLS clients.
<VAR
CLASS="REPLACEABLE"
>filename</VAR
> must not be world-readable.</P
></DD
><DT
>TLS_TRUSTCERTS=<VAR
CLASS="REPLACEABLE"
>pathname</VAR
></DT
><DD
><P
>Load trusted root certificates
from <VAR
CLASS="REPLACEABLE"
>pathname</VAR
>.  <VAR
CLASS="REPLACEABLE"
>pathname</VAR
>
can be a file or a directory. If a
file, the file should contain a list of trusted certificates, in PEM
format. If a directory, the directory should contain the trusted
certificates, in PEM format, one per file and hashed using OpenSSL's
<B
CLASS="COMMAND"
>c_rehash</B
> script. <VAR
CLASS="ENVAR"
>TLS_TRUSTCERTS</VAR
> is used by
SSL/TLS clients (by
specifying the <VAR
CLASS="OPTION"
>-domain</VAR
> option) and by SSL/TLS servers
(<VAR
CLASS="ENVAR"
>TLS_VERIFYPEER</VAR
> is set to <TT
CLASS="LITERAL"
>PEER</TT
> or
<TT
CLASS="LITERAL"
>REQUIREPEER</TT
>).</P
></DD
><DT
>TLS_VERIFYPEER=<VAR
CLASS="REPLACEABLE"
>level</VAR
></DT
><DD
><P
>Whether to verify peer's
X.509 certificate.  The exact meaning of this option depends upon whether
<B
CLASS="COMMAND"
>couriertls</B
> is used in the client or server mode.
In server mode:
<TT
CLASS="LITERAL"
>NONE</TT
> - do not request an X.509 certificate from the client;
<TT
CLASS="LITERAL"
>PEER</TT
> - request an optional X.509 certificate from the
client, if the client returns one,
the SSL/TLS connection is shut down unless the certificate is signed by a
trusted certificate authority (see TLS_TRUSTCERTS);
<TT
CLASS="LITERAL"
>REQUIREPEER</TT
> - same as
PEER, except that the SSL/TLS connects is also shut down if the client
does not return the optional X.509 certificate.  In client mode:
<TT
CLASS="LITERAL"
>NONE</TT
> - ignore the server's X.509 certificate;
<TT
CLASS="LITERAL"
>PEER</TT
> - verify the server's
X.509 certificate according to the <VAR
CLASS="OPTION"
>-domain</VAR
> option,
(see above).</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN164"
></A
><H2
>SEE ALSO</H2
><P
><A
HREF="couriertcpd.html"
TARGET="_top"
><SPAN
CLASS="CITEREFENTRY"
><SPAN
CLASS="REFENTRYTITLE"
>couriertcpd</SPAN
>(1)</SPAN
></A
>,
<A
HREF="courier.html"
TARGET="_top"
><SPAN
CLASS="CITEREFENTRY"
><SPAN
CLASS="REFENTRYTITLE"
>courier</SPAN
>(8)</SPAN
></A
>.</P
></DIV
></BODY
></HTML
>