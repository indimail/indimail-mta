#
#
# $Id: iwebadmin.spec.in,v 1.28 2018-03-31 20:41:17+05:30 Cprogrammer Exp mbhangui $
%undefine _missing_build_ids_terminate_build
%define _unpackaged_files_terminate_build 1
%global debug_package %{nil}

%if %{defined _project}
# define if building on openSUSE build service
%define build_on_obs       1
%global reconfigure_mode   0
%else
%define _project           local
%define build_on_obs       0
%global reconfigure_mode   1
%global _hardened_build    1
%endif

%define _prefix            @prefix@
%define sysconfdir         @sysconfdir@
%define see_base           For a description of IndiMail visit http://www.indimail.org

%if %build_on_obs != 0
# change mysqlPrefix to /usr for openSUSE buildservice
%define mysqlPrefix        /usr
%else
%define mysqlPrefix        @mysql_prefix@
%endif

Summary: Web Administration GUI for IndiMail User Administration
Name: iwebadmin
Version: @version@
Release: 1.1%{?dist}

%if %build_on_obs == 1
License: GPL-3.0+
%else
License: GPLv3
%endif
Group: System Environment/Base
Source0:  http://downloads.sourceforge.net/indimail/%{name}-%{version}.tar.gz
Source2: %{name}-%{version}-rpmlintrc

URL: http://www.indimail.org
AutoReqProv: No
BuildRequires: rpm gcc make binutils coreutils grep
BuildRequires: glibc glibc-devel procps cpio
BuildRequires: sed gettext-devel
BuildRequires: findutils
BuildRequires: gzip autoconf automake libtool indimail-devel libindimail
%if %{undefined rhel_version}
BuildRequires: sharutils
%else
%if 0%{?rhel_version} != 600 && 0%{?rhel_version} != 700
BuildRequires: sharutils
%endif
%endif

%if %build_on_obs == 1
BuildRequires: mysql-devel libidn-devel
%else
BuildRequires: mysql-devel
%endif
%if %{undefined centos_version} && %{undefined rhel_version}
BuildRequires: chrpath
%endif
%if 0%{?suse_version}
BuildRequires: -post-build-checks  
#!BuildIgnore: post-build-checks  
%endif

Requires: coreutils grep /bin/sh glibc /usr/sbin/useradd /usr/sbin/groupadd
Requires: procps /usr/bin/awk indimail > 1.6
Requires: ezmlm-idx > 7.2
BuildRoot: %(mktemp -ud %{_tmppath}/%{name}-%{version}-%{release}-XXXXXX)
Excludeos: windows 

%description
iwebadmin provides a Web frontend for administering IndiMail Users

%{see_base}

%prep
%setup -q

%build
autoreconf -fiv
./configure --prefix=%{_prefix} \
  --sysconfdir=%{sysconfdir} \
  --libdir=%{_libdir} \
  --enable-ezmlmdir=%{_prefix}/bin --disable-ipauth --disable-trivial-password \
  --enable-mysqlprefix=%{mysqlPrefix} \
  --enable-modify-quota \
  --enable-htmldir=@htmldir@ \
  --enable-cgibindir=@cgibindir@ \
  --enable-imagedir=@imagedir@ \
  --enable-htmllibdir=@htmllibdir@

%install
[ "$RPM_BUILD_ROOT" != "/" ] && /bin/rm -fr $RPM_BUILD_ROOT
%{__make} -s DESTDIR=%{buildroot}
%{__make} -s DESTDIR=%{buildroot} install-strip

if [ -x /usr/bin/chrpath ] ; then
  /usr/bin/chrpath -d %{buildroot}@cgibindir@/iwebadmin
fi

%files
%defattr(-,root,root,-)
%if "%{_prefix}" != "/usr"
%dir %attr(555,root,qmail)               %{_prefix}
%endif
%dir %attr(755,root,qmail)               @htmllibdir@
%dir %attr(755,root,qmail)               @htmllibdir@/html
%dir %attr(755,root,qmail)               @htmllibdir@/lang

# binary
%attr(6555,root,indimail)                @cgibindir@/iwebadmin

#html
%attr(444,root,root)                     @htmllibdir@/html/add_autorespond.html
%attr(444,root,root)                     @htmllibdir@/html/add_forward.html
%attr(444,root,root)                     @htmllibdir@/html/add_listdig.html
%attr(444,root,root)                     @htmllibdir@/html/add_listmod.html
%attr(444,root,root)                     @htmllibdir@/html/add_listuser.html
%attr(444,root,root)                     @htmllibdir@/html/add_mailinglist-idx.html
%attr(444,root,root)                     @htmllibdir@/html/add_mailinglist-no-idx.html
%attr(444,root,root)                     @htmllibdir@/html/add_user.html
%attr(444,root,root)                     @htmllibdir@/html/change_password.html
%attr(444,root,root)                     @htmllibdir@/html/change_password_success.html
%attr(444,root,root)                     @htmllibdir@/html/colortable
%attr(444,root,root)                     @htmllibdir@/html/del_autorespond_confirm.html
%attr(444,root,root)                     @htmllibdir@/html/del_forward_confirm.html
%attr(444,root,root)                     @htmllibdir@/html/del_listdig.html
%attr(444,root,root)                     @htmllibdir@/html/del_listmod.html
%attr(444,root,root)                     @htmllibdir@/html/del_listuser.html
%attr(444,root,root)                     @htmllibdir@/html/del_mailinglist_confirm.html
%attr(444,root,root)                     @htmllibdir@/html/del_user_confirm.html
%attr(444,root,root)                     @htmllibdir@/html/footer.html
%attr(444,root,root)                     @htmllibdir@/html/header.html
%attr(444,root,root)                     @htmllibdir@/html/main_menu.html
%attr(444,root,root)                     @htmllibdir@/html/mod_autorespond.html
%attr(444,root,root)                     @htmllibdir@/html/mod_dotqmail.html
%attr(444,root,root)                     @htmllibdir@/html/mod_mailinglist-idx.html
%attr(444,root,root)                     @htmllibdir@/html/mod_user.html
%attr(444,root,root)                     @htmllibdir@/html/setremotecatchall.html
%attr(444,root,root)                     @htmllibdir@/html/show_autorespond.html
%attr(444,root,root)                     @htmllibdir@/html/show_digest_subscribers.html
%attr(444,root,root)                     @htmllibdir@/html/show_forwards.html
%attr(444,root,root)                     @htmllibdir@/html/show_login.html
%attr(444,root,root)                     @htmllibdir@/html/show_mailinglist.html
%attr(444,root,root)                     @htmllibdir@/html/show_moderators.html
%attr(444,root,root)                     @htmllibdir@/html/show_subscribers.html
%attr(444,root,root)                     @htmllibdir@/html/show_users.html

#language files
%attr(444,root,root)                     @htmllibdir@/lang/bg
%attr(444,root,root)                     @htmllibdir@/lang/cs
%attr(444,root,root)                     @htmllibdir@/lang/da
%attr(444,root,root)                     @htmllibdir@/lang/de
%attr(444,root,root)                     @htmllibdir@/lang/en
%attr(444,root,root)                     @htmllibdir@/lang/es
%attr(444,root,root)                     @htmllibdir@/lang/fi
%attr(444,root,root)                     @htmllibdir@/lang/fr
%attr(444,root,root)                     @htmllibdir@/lang/hu
%attr(444,root,root)                     @htmllibdir@/lang/it
%attr(444,root,root)                     @htmllibdir@/lang/ja
%attr(444,root,root)                     @htmllibdir@/lang/lt
%attr(444,root,root)                     @htmllibdir@/lang/nl
%attr(444,root,root)                     @htmllibdir@/lang/no
%attr(444,root,root)                     @htmllibdir@/lang/pl
%attr(444,root,root)                     @htmllibdir@/lang/pt-br
%attr(444,root,root)                     @htmllibdir@/lang/ru
%attr(444,root,root)                     @htmllibdir@/lang/sk
%attr(444,root,root)                     @htmllibdir@/lang/sv
%attr(444,root,root)                     @htmllibdir@/lang/tr
%attr(444,root,root)                     @htmllibdir@/lang/zh-cn

%attr(444,root,root) %config(noreplace)  @sysconfdir@/iwebadmin_perm_list
#images
%attr(444,root,root)                     @imagedir@/delete.png
%attr(444,root,root)                     @imagedir@/disabled.png
%attr(444,root,root)                     @imagedir@/lowerleft.png
%attr(444,root,root)                     @imagedir@/lowermiddle.png
%attr(444,root,root)                     @imagedir@/lowerright.png
%attr(444,root,root)                     @imagedir@/main.png
%attr(444,root,root)                     @imagedir@/main1.png
%attr(444,root,root)                     @imagedir@/main2.png
%attr(444,root,root)                     @imagedir@/middleleft1.png
%attr(444,root,root)                     @imagedir@/middleleft2.png
%attr(444,root,root)                     @imagedir@/middlelogin.png
%attr(444,root,root)                     @imagedir@/middleright1.png
%attr(444,root,root)                     @imagedir@/modify.png
%attr(444,root,root)                     @imagedir@/pixel.png
%attr(444,root,root)                     @imagedir@/radio-off.png
%attr(444,root,root)                     @imagedir@/radio-on.png
%attr(444,root,root)                     @imagedir@/trash.png
%attr(444,root,root)                     @imagedir@/upperleft.png
%attr(444,root,root)                     @imagedir@/uppermiddle1.png
%attr(444,root,root)                     @imagedir@/uppermiddle2.png
%attr(444,root,root)                     @imagedir@/upperright.png
%attr(644,root,root)                     @docdir@/README
%attr(644,root,root)                     @docdir@/AUTHORS
%attr(644,root,root)                     @docdir@/COPYING
%attr(644,root,root)                     @docdir@/README.hooks


%clean
%{__rm} -rf %{buildroot}

# fix changelog for openSUSE buildservice
%changelog
