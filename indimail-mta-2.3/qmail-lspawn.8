.TH qmail-lspawn 8
.SH NAME
qmail-lspawn \- schedule local deliveries
.SH SYNOPSIS
.B qmail-lspawn
.I defaultdelivery
.SH DESCRIPTION
.B qmail-lspawn
reads a series of local delivery commands from descriptor 0,
invokes
.B qmail-local
to perform the deliveries,
and prints the results to descriptor 1.
It passes
.I defaultdelivery
to
.B qmail-local
as the default delivery instruction.

.B qmail-lspawn
invokes
.B qmail-local
asynchronously,
so the results may not be in the same order as the commands. If the environment
variable QMAILLOCAL is defined the executable defined by QMAILLOCAL is invoked
instead.

.B qmail-lspawn
sets the environment variable MESSID pointing message file in the queue.

For each recipient address,
.B qmail-lspawn
finds out which local user controls that address.
It first checks the
.B qmail-users
mechanism; if the address is not listed there, it invokes
.BR qmail-getpw .
.B qmail-lspawn
then runs
.B qmail-local
under the user's uid and gid.
It does not set up any supplementary groups. If the environment variable AUTHSELF is set,
.B qmail-lspawn
treats an empty mailbox name as a trash address. If connecton to MySQL fails,

.SH Virtual Package Functionality
\fBqmail-lspawn\fR can load an external library to add functionality. The virtual package
can be loaded by setting the environment variable \fBVIRTUAL_PKG_LIB\fR. This is set to
\fIlibindimail\fR.\fIso\fR by default.

Following functions should be provided by the shared library for adding features to
qmail-lspawn - isvirtualdomain(), vauth_open(), vauth_getpw(), vclose(). If such a
library is opened \fBqmail-lspawn\fR connects to MySQL(1) and sets the environment variable
\fBPWSTRUCT\fR having the passwd structure for the user. The environment variable is set to
"No such user" in case the user is not found in the local MySQL database. This
environment variable can be used by delivery agents without having to read the passwd
file or a database. For a user-cluster domain, if a mail is injected for a user not
found in the local MySQL database, \fBqmail-lspawn\fR will set PWSTRUCT to
"No such user". However, a delivery agent like \fBvdelivermail(8)\fR reroutes the
email to the correct destination host which has the user account, using \fBqmail-remote\fR.

.B
qmail-lspawn goes ahead without attempting to load external library if AUTHSELF was not set.

.SH "SEE ALSO"
envelopes(5),
qmail-users(5),
qmail-getpw(8),
qmail-send(8),
qmail-local(8)
