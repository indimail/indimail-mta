File INSTALL-RPM, Version 2.2
DATE: Mon May  8 22:28:26 IST 2017

This section covers installing IndiMail from rpm/deb. This is the easy way to install IndiMail.
If you are looking for something more simpler, then you need the Install IndiMail for
dummies - instructions for which are in the file Quick-INSTALL-2.2.

There is also an Installation for Experts. For that read INSTALL-2.2. I would
recommend you to go through the file INSTALL-2.2 so that you undertand IndiMail
better. INSTALL-2.2 gives instructions for installing from source and could be
challenging for those who are not accustomed with compilation, make, GNU autotools process.

PLEASE DON'T HESITATE to join IndiMail group at https://groups.google.com/forum/#!forum/indimail

You will also find this file as 
http://downloads.sourceforge.net/indimail/INSTALL-RPM-2.2

IndiMail also has yum/apt-get repositories for RPM/Deb of most of the Linux Distros at

http://download.opensuse.org/repositories/home:/indimail/

The latest RPM/Deb (for yet to be released version and can have untested code) can be found at

http://download.opensuse.org/repositories/home:/mbhangui/

You can install indimail using yum by using the following command (depending on
your architecture)

# yum install indimail
   or
# dnf install indimail

What the RPM/Deb does
---------------------

It depends on whether you are Installing, upgrading or removing IndiMail using the rpm
version. Following are the steps carried out during RPM/Deb installation.

A) Package Installation/Upgrade
   1. Stops IndiMail services (in case the system already has IndiMail installed)
   2. Add users (indimail, alias, qmaild, qmaill, qmailp, qmailq, qmailr, qmails, qscand)
      and groups (indimail, nofiles, qmail, qscand)
   3. Installs files/binaries in /var/indimail
   4. Installs services under supervise in /service
       smtp, smtp - odmr, qmtp, qmqp, qmail-send, imap/pop3, indisrvr, inlookup, pwdlookup,
       clamav antivirus service, freshclam - virus signature update service,
       bogofilter spam filter service
   5. Installs (for installation only) MySQL database for use by IndiMail
      (database in /var/indimail/mysqldb/data and logs in /var/indimail/mysqldb/logs)
   6. Installs 5 queues in /var/indimail/queue (queue1, queue2, ... queue5)
   7. Install MTA as the alterntive MTA. Creates link sendmail in /usr/sbin or
      /usr/lib to /usr/bin/sendmail
   8. Creates directory for supervise logs in /var/log/indimail
   9. Sets up svscan to be run by init (/etc/inittab), upstart (/etc/event.d) or
      by systemctl (/lib/systemd/system)

B) Package Removal
   1. Stops IndiMail services (in case the system already has IndiMail installed)
   2. Delete users (indimail, alias, qmaild, qmaill, qmailp, qmailq, qmailr, qmails, qscand)
      and groups (indimail, nofiles, qmail, qscand)
   3. Removes files/binaries in /var/indimail
   4. Removes services under supervise in /service
       smtp, smtp - odmr, qmtp, qmqp, qmail-send, imap/pop3, indisrvr, inlookup, pwdlookup,
       clamav antivirus service, freshclam - virus signature update service,
       bogofilter spam filter service
   5. removes svscan to be run by init (/etc/inittab) or by upstart (/etc/event.d). removes
      all startup scripts
   6. Sets the original sendmail as the MTA.
   NOTE: MySQL database is not removed, config files in /etc/indimail/etc,
         /etc/indimail/control, /etc/indimail/users, .qmail files in /var/indimail/alias,
         domain information in /var/indimail/domains are not removed.

What the RPM/Deb does not do
------------------------
1. Install and configure MySQL (See How to install MySQL below)
2. Configure IndiMail

How to INSTALL
--------------
You need to have MySQL installed on your system (see below on how to install). You can also use an
available rpm for MySQL from www.mysql.com

1) Package Install Instruction
   ---------------------------
   % sudo rpm -ivh indimail-2.2-1.i386.rpm
   % sudo dpkg -i indimail_2.2-1_386.deb

2) Package Upgrade Instruction
   ---------------------------
   % sudo rpm -Uvh indimail-2.2-1.i386.rpm
   % sudo dpkg -i indimail_2.2-1_386.deb

3) Package Removal Instrucation
   ----------------------------
   % sudo rpm -e indimail-2.2-1.i386.rpm
   % sudo dpkg -r indimail_2.2-1_386.deb

Start IndiMail Services
-----------------------
   Review the email in /var/indimail/alias/.qmail-postmaster, before starting services

   % sudo service indimail start         # (works on all systems)
       or
   % sudo /usr/sbin/initsvc -on # (works on all systems)
       or
   % sudo init q                         # (if your system uses traditional init)
       or
   % sudo /sbin/initctl emit qmailstart  # (if your system uses upstart - ubuntu/fedora10
                                           &above)
       or
   % sudo /bin/launchctl load /System/Library/LaunchDaemons/indimail.plist
   % sudo service indimail start        # (If you are on Mac OSX)

The RPM/Deb installation deliberately installs MySQL and fetchmail services in down state.
This is for you to review your MySQL installation and configuration. For fetchmail service
to run, you need to create /var/indimail/etc/fetchmailrc file. You can use fetchmailconf
for configuring fetchmail. To have these services started automatically during reboot,
delete the files /service/mysql.3306/down and /service/fetchmail/down . After deleting
the file you can use the following to start MySQL

    % sudo /usr/bin/svc -u /service/mysql.3306

NOTE: Please disable MySQL from getting started up by the system by executing the
      chkconfig command

      % sudo chkconfig mysqld off

If you want to use the MySQL started by the system, then do not delete the file
/service/mysql.3306/down and do not issue the above svc command. In such a case
you will need to tell IndiMail on how to connect to MySQL.

The information for IndiMail to connect to IndiMail is maintained in the file

/etc/indimail/control/host.mysql    # for non-clustered setup

and

/etc/indimail/control/host.cntrl    # for clustered setup
/etc/indimail/control/host.master   # for clustered setup

The format for this file is

mysql_host:mysql_user:mysql_pass:mysql_socket

or

mysql_host:mysql_user:mysql_pass:mysql_port

Proceed to SECTION 8, STEP 2 in the file INSTALL-2.2 for further instruction on 
configuration of IndiMail

Log files are creaed in /var/log/indimail/*


How to install MySQL
--------------------

NOTE: Replace 5.5.2-m2 with your favourite version
    You can download mysql-5.5.2-m2.tar.gz from dev.mysql.com
    Install MySQL 5.5.2-m2 with MD5 cd3254f29561953ffb7c023cb1b825d2
    (You can install MySQL 5.1.x and greater)
    current working directory /home/local/src
    % You can download mysql-5.5.2-m2.tar.gz from dev.mysql.com
    % gunzip -c mysql-5.5.2-m2.tar.gz |tar xf -
    % cd mysql-5.5.2-m2
    % ./configure --prefix=/usr --enable-local-infile
    % make -s DESTDIR=staging_directory
    % sudo make install-strip DESTDIR=staging_directory
    cd ..
