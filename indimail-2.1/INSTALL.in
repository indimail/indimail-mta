File INSTALL.indimail, Version @version@
DATE: @DATE@

PLEASE DON'T HESITATE to join IndiMail group at https://groups.google.com/forum/#!forum/indimail

Installation Instructions
*************************

Copyright (C) 1994, 1995, 1996, 1999, 2000, 2001, 2002, 2004, 2005,
2006, 2007, 2008, 2009, 2010 Free Software Foundation, Inc.

This file is free documentation; the Free Software Foundation gives
unlimited permission to copy, distribute and modify it.

This section covers installing IndiMail. If you're an experienced system administrator, you
can install IndiMail following the directions below. If you are in a hurry, you can directly
jump to the Section 'Installation Steps' below. However, I would recommend you to go through
the Checklist below to understand what is involved in setting up a full featured mail server.

You will also find this file as 
http://downloads.sourceforge.net/indimail/INSTALL-@version@

There is also a 'Installation for Dummies'. For that read INSTALL-RPM. You will also
find the INSTALL-RPM file as
http://downloads.sourceforge.net/indimail/INSTALL-RPM-@version@

This document is complicated as it involves installing from multiple sources. However, there
is a crash course on IndiMail installation if you want to skip the above
two documents and directly install from the RPM/Deb. Read the file Quick-INSTALL-@version@.
You will also find the file as
http://downloads.sourceforge.net/indimail/Quick-INSTALL-@version@

Using Quick-INSTALL it is possible to setup a fully functional mail server in
flat 30 minutes and in less than 10 commands;

Installation of IndiMail using source involves going through ten sections. Don't say that
I didn't warn you. You may jump to Section 1 below if you are in a hurry and have some Unix
experience under your belt. If you have ideas on how to simplify this documentation further,
do write to me. In case you get stuck, do write to me
at "Manvendra Bhangui" <manvendra@indimail.org>

Checklist
=========

You need to have answers to the following ready before starting the installation.

   1.  Whether you want a full featured mailstore or just a relay server installation
   2.  Default Domain name for your Mail Server (mailstore)
       1. postmaster email account
       2. abuse account
   3.  What Filesystem to use (XFS, EXT4 for Maildirs, ext2 for queue)? (mailstore)
   4.  Filesystem where you will have your queue (mailstore, relayserver)
   5.  Filesystem where you will have your user's home directory (mailstore)
   6.  Filesystem where you will have the MySQL data files and logs (mailstore, clusterinfo)
   7   Filesystem where you will have the supervise log files
   8.  A MySQL database to hold the user cluster information (clusterinfo)
   9.  A MySQL database to hold local user information for each host which is part of the user
       cluster (mailstore)
   10. Userids, passwords for the MySQL Database (mailstore, clusterinfo)
   11. Estimation of Load (mailstore, relayserver, clusterinfo)
   12. IP addresses (Mailserver, relayservers, clusterinfo)
   13. MX records to be setup (relayserver)
   14. Access to root (mailstore, relayserver, clusterinfo)
   15. Broad level features required (SPAM/Virus Filter, IMAP, POP3, WebMail) (mailstore)
   16. Whom should the daily mail statistics reports be sent to.

TERMS
=====

  * mailstore   - A host which keeps the user's maildir. I may also refer sometimes a mailstore
                  as a mailserver.
  * relayserver - A host which accepts mail from the internet (port 25) and/or the users
                  (port 587)
  * clusterinfo - A host which hosts the MySQL database having the user cluster information
                  (only if you want to install single domain multi-host mailstores). A clusterinfo
                  helps to extend a domain across multiple mailstores. I may refer the cluserinfo
                  sometimes as the 'central database' or hostcntrl.

Before starting the installation, there are a few things you need to think about.

  * If possible, install IndiMail on a "practice" system. This will give you a chance to make
    mistakes without losing important mail or interrupting mail service to your users. You can
    also use

    DESTDIR=staging_directory

    to install indimail in a staging directory before copying to the actual destination.
    Pre-pending the variable DESTDIR to each target in this way provides for staged installs, where
    the installed files are not placed directly into their expected location but are instead
    copied into a temporary location (DESTDIR). However, installed files maintain their relative
    directory structure and any embedded file names will not be modified.
    DESTDIR support is commonly used in package creation. It is also helpful to users who want to
    understand what a given package will install where, and to allow users, who don't normally have
    permissions to install into protected areas, to build and install before gaining those
    permissions.
    Finally, it can be useful with tools such as stow, where code is installed in one place but
    made to appear to be installed somewhere else using symbolic links or special mount operations.
  * If you don't have a spare system, and your system is already handling mail using sendmail, smail,
    or some other MTA, you can install and test most pieces of IndiMail without interfering with the
    existing service.
  * When migrating a system from some other MTA to IndiMail, even if you've got some IndiMail
    experience under your belt, it's a good idea to formulate a plan.


Requirements
============

IndiMail will install and run on most UNIX and UNIX-like systems, but there are few requirements:

  * Around 300 megabytes of diskspace for all the packages (you will download this in the build
    area).
  * About 800 megabytes of free space in the build area during the build. After the build, you can
    free about 500 megabytes by doing make clean
  * Around 80 megabytes for the binaries, documentation, and configuration files.
  * A safe filesystem for the queue. qmail's reliability guarantee requires that the queue reside
    on a filesystem with traditional BSD FFS semantics. Most modern local filesystems meet these
    requirements with one important exception: the link() system call is often
    asynchronous--meaning that the results of the link() operation might not have been written to
    disk when the link() call returns. Bruce Guenter's syncdir library is used by IndiMail
    to work around this problem.
  * Sufficient disk space for the queue. Small single-user systems only need a couple megabytes.
    Large servers may need a couple gigabytes.
  * A filesystem for the user's home directories where mail will be delivered.
  * A compatible operating system. Most flavors of UNIX are acceptable which have GNU Compilation
    tools (autoconf/automake/libtool/texinfo/emacs).
    NOTE: autoconf 2.69 and above is required.
  * A complete, functioning C development system including a compiler, system header files, and
    libraries. The installation steps will guide you through the installation process.
  * Commands like gzip, bzip2, tar, vi, etc. If you can't find a compiler installed, you'll have to
    locate one and install it. Contact your administrator or OS vendor.
  * MySQL 5.1.x or greater. You can make IndiMail work with 5.0 or less but you will have to
    do some manual tweaking with MySQL database and configuration to make MySQL work with
    IndiMail (read INSTALL-MYSQL for more information).
  * Access to a domain name server (DNS) is highly recommended. Without one, qmail can only send
    to remote systems configured in its smtproutes config file.
  * Adequate network connectivity. IndiMail was designed for well-connected systems, so you
    probably don't want to try to use it for a mailing list server on a 28.8k dial-up. The
    fetchmail package was designed to make Mail more compatible with poorly-connected systems
    works well with IndiMail. IndiMail also provides On Demand Mail Relay Protocol (ODMR) for
    such systems. The installation and configuration for fetchmail is also discussed.
  * IndiMail supports the concept of staged installation. You need to specify
    make DESTDIR=path_to_staging_directory when doing the build. Also svctool (see below) can
    be passed an extra argument --destdir=path_to_staging_directory to create/modify all
    configuration files in the staging area alone. Using staged installation, the administrator
    can install IndiMail on a live system without disturbing an existing running installation.
    To upgrade, all that is required is to move all files from the staged directories to the
    actual production directories. The Directory tree structure in the
    staged area is exactly the same as would be present in the production directory.

#################################################################################################
Installation Steps
==================

For more information, read Basic Installation instructions at the bottom. In all the steps below
(in the make command) you may omit DESTDIR=staging_directory in the make command in case

a) you are doing this on a fresh system or
b) in case you are installing this on a live IndiMail System and do not wish
   to do make install or make install-strip immediately.
c) IndiMail follows FHS. The base directory is installed in @indimaildir@. You may want to set the following
   in your .profile, or equivalent startup file
   PATH=$PATH:@prefix@/bin:@prefix@/sbin

Which user should I use to run the commands listed below ?

If a command is prefixed with the '%' sign, it means that it was run using a non-privilege id. e.g.
% df -k
If a command is prefixed with the '#' sign, it means that it was run using root. e.g.
# df -k

I usually prefer to run privileged commands like this (so that I don't get fond of login in as root)

% sudo df -k

########### SECTION 1  ##### DISK SPACE Check ###########################
1. check for diskspace
    % df
      or
    % df -k 

    Determine which disk partition you install IndiMail software

    Prepare Source Directory Structure in the disk partition selected
    you have to extract minimum of 10 sources as per the directory
    structure below. You may skip extraction of nssd-1.1, fetchmail-6.3.19,
    depending on whether you require them. Most probably you have downloaded
    indimail-@version@.tar.gz only. You require to additionally download the
    following sources mentioned below. Except for qmail, ucspi-tcp, bogofilter,
    fetchmail, all the sources are available at indimail.sourceforge.net.
    The link from which you can download the sources are mentioned in SECTION 3
    below. Also remember that IndiMail requires patch to be applied to qmail,
    ucspi-tcp, courier-imap, bogofilter and fetchmail to make all
    components work seamlessly with each other.

    NOTE: nssd does not compile on Mac OS X

    +-/home/local/src/indimail/.+
                               .
                               . libdkim-1.4         (4.0  Mb)
                               . indimail-@version@  (50   Mb)
                               . qmail-1.03          (21   Mb)
                               . ucspi-tcp-0.88      (4.0  Mb)
                               . nssd-1.1            (2.0  Mb)
                               . pam-multi-1.1       (3.0  Mb)
                               . logalert-0.3        (2.0  Mb)
                               . flash-0.9.4         (4.3  Mb)
                               . altermime-0.3.10    (1.5  Mb)
                               . ripmime-1.4.0.9     (2.1  Mb)
                               . mpack-1.6           (1.5  Mb)
                               . fortune-1.1         (8.4  Mb)
                               . courier-imap-4.17.2 (75   Mb)
                               . bogofilter-1.2.4    (11.6 Mb)
                               . fetchmail-6.3.26   (10.5 Mb)
                               . iwebadmin-1.2      (3.0  Mb)
                               ------------------------------
                                 Total              (200  Mb)

########### SECTION 2  ##### USER/GROUP Creation ########################
1. add groups and users and home directory
    For Linux (I presume this should hold good for OS like Solaris too)
    You will have to run this commands under root. The commands may be
    different for the OS you are running. Please consult your OS man pages/documentation
    for the exact syntax.

    % su
    # groupadd -g 555 indimail
    # groupadd -g 556 nofiles
    # groupadd -g 557 qmail
    # groupadd -g 558 qscand

    # useradd -M -g indimail -u 555 -d @indimaildir@ indimail
    # useradd -M -g nofiles  -u 556 -d @indimaildir@/alias  -s /bin/false alias
    # useradd -M -g nofiles  -u 557 -d @indimaildir@        -s /bin/false qmaild
    # useradd -M -g nofiles  -u 558 -d @indimaildir@        -s /bin/false qmaill
    # useradd -M -g nofiles  -u 559 -d @indimaildir@        -s /bin/false qmailp
    # useradd -M -g qmail    -u 560 -d @indimaildir@        -s /bin/false qmailq
    # useradd -M -g qmail    -u 561 -d @indimaildir@        -s /bin/false qmailr
    # useradd -M -g qmail    -u 562 -d @indimaildir@        -s /bin/false qmails
    # useradd -M -g qscand   -u 563 -d @indimaildir@/qscanq -G qmail,qscand -s /bin/false qscand

#   on a debian system omit the -M option above

    For Mac OS X 10.5.4 or greater

    # dscl . -create /Groups/indimail PrimaryGroupID 555
    # dscl . -create /Users/indimail UniqueID 555
    # dscl . -create /Users/indimail home @indimaildir@
    # dscl . -create /Users/indimail PrimaryGroupID 555
    # dscl . -create /Users/indimail UserShell /bin/bash
    # dscl . -create /Users/indimail RealName indimail

    # dscl . -create /Groups/nofiles PrimaryGroupID 556
    # dscl . -create /Groups/qmail   PrimaryGroupID 557
    # dscl . -create /Groups/qscand  PrimaryGroupID 558

    # dscl . -create /Users/alias    UniqueID 556
    # dscl . -create /Users/alias    home @indimaildir@/alias
    # dscl . -create /Users/alias    PrimaryGroupID 556
    # dscl . -create /Users/alias    UserShell /bin/bash
    # dscl . -create /Users/alias    RealName alias

    # dscl . -create /Users/qmaild   UniqueID 557
    # dscl . -create /Users/qmaild   home @indimaildir@
    # dscl . -create /Users/qmaild   PrimaryGroupID 556
    # dscl . -create /Users/qmaild   UserShell /bin/bash
    # dscl . -create /Users/qmaild   RealName qmaild

    # dscl . -create /Users/qmaill   UniqueID 558
    # dscl . -create /Users/qmaill   home @indimaildir@
    # dscl . -create /Users/qmaill   PrimaryGroupID 556
    # dscl . -create /Users/qmaill   UserShell /bin/bash
    # dscl . -create /Users/qmaill   RealName qmaill

    # dscl . -create /Users/qmailp   UniqueID 559
    # dscl . -create /Users/qmailp   home @indimaildir@
    # dscl . -create /Users/qmailp   PrimaryGroupID 556
    # dscl . -create /Users/qmailp   UserShell /bin/bash
    # dscl . -create /Users/qmailp   RealName qmailp

    # dscl . -create /Users/qmailq   UniqueID 560
    # dscl . -create /Users/qmailq   home @indimaildir@
    # dscl . -create /Users/qmailq   PrimaryGroupID 557
    # dscl . -create /Users/qmailq   UserShell /bin/bash
    # dscl . -create /Users/qmailq   RealName qmailq

    # dscl . -create /Users/qmailr   UniqueID 561
    # dscl . -create /Users/qmailr   home @indimaildir@
    # dscl . -create /Users/qmailr   PrimaryGroupID 557
    # dscl . -create /Users/qmailr   UserShell /bin/bash
    # dscl . -create /Users/qmailr   RealName qmailr

    # dscl . -create /Users/qmails   UniqueID 562
    # dscl . -create /Users/qmails   home @indimaildir@
    # dscl . -create /Users/qmails   PrimaryGroupID 557
    # dscl . -create /Users/qmails   UserShell /bin/bash
    # dscl . -create /Users/qmails   RealName qmails

    # dscl . -create /Users/qscand UniqueID 563
    # dscl . -create /Users/qscand home @indimaildir@/qscanq
    # dscl . -create /Users/qscand PrimaryGroupID 558
    # dscl . -create /Users/qscand UserShell /bin/false
    # dscl . -create /Users/qscand RealName qscand
    # dscl . -append /Groups/qmail GroupMembership qscand

    If you don't want to see the above added  users in the login-window,
    you might want to use the following command

    # defaults write /Library/Preferences/com.apple.loginwindow HiddenUsersList \
        -array-add indimail alias qmaild qmaill qmailp qmailq qmailr qmails qscand \
         mysql
    # exit

    RedHat and other linux systems place useradd and groupadd in
    the /usr/sbin directory.

NOTE: the home directory of indimail must exist before you continue with
the installation.

########### SECTION 3  ##### SOFTWARE INSTALLATION ######################
3. Download and Extract Software

    Create a Work Directory

    # mkdir -p /home/local/src
    % cd /home/local/src
    % wget http://downloads.sourceforge.net/indimail/INSTALL-@version@ # This file
    % wget http://downloads.sourceforge.net/indimail/INSTALL-RPM-@version@
    % wget http://downloads.sourceforge.net/indimail/INSTALL-MYSQL-@version@
    % wget http://downloads.sourceforge.net/indimail/Quick-INSTALL-@version@
    % wget http://downloads.sourceforge.net/indimail/package.checksums # MD5 sum of all the packages
    % wget http://downloads.sourceforge.net/indimail/indimail-@version@.tar.gz
    % wget http://downloads.sourceforge.net/indimail/libdkim-1.4.tar.gz
    % wget http://downloads.sourceforge.net/indimail/libsrs2-1.0.18.tar.gz
    % wget http://downloads.sourceforge.net/courier/courier-imap-4.17.2.tar.bz2
    % wget http://downloads.sourceforge.net/indimail/flash-0.9.4.tar.gz
    % wget http://downloads.sourceforge.net/indimail/altermime-0.3.10.tar.gz
    % wget http://downloads.sourceforge.net/indimail/ripmime-1.4.0.9.tar.gz
    % wget http://downloads.sourceforge.net/indimail/mpack-1.6.tar.gz
    % wget http://downloads.sourceforge.net/indimail/fortune-1.1.tar.gz
    % wget http://downloads.sourceforge.net/indimail/nssd-1.1.tar.gz
    % wget http://downloads.sourceforge.net/indimail/pam-multi-1.1.tar.gz
    % wget http://downloads.sourceforge.net/indimail/logalert-0.3.tar.gz
    % wget http://downloads.sourceforge.net/indimail/iwebadmin-1.2.tar.gz

    You may omit STEP 1 if you already have a working installation of MySQL and would want to use
    the existing MySQL installation with IndiMail. You may also omit STEP 2 in cause you do not
    need DKIM Signatures for signing for verification

    ##### STEP 1  ##### Install MySQL #########################
    Install MySQL 5.5.2-m2 with MD5 cd3254f29561953ffb7c023cb1b825d2
    (You can install MySQL 5.1.x and greater)
    current working directory /home/local/src
    % You can download mysql-5.5.2-m2.tar.gz from dev.mysql.com
    % gunzip -c mysql-5.5.2-m2.tar.gz |tar xf -
    % cd mysql-5.5.2-m2
    % ./configure --prefix=@mysql_prefix@ --enable-local-infile
    % make -s DESTDIR=staging_directory
    % sudo make install-strip DESTDIR=staging_directory
    cd ..

    NOTE: You may install any version of MySQL you like. The steps would be similar. You
    can also choose to install MariaDB. MariaDB is a drop-in replacement for MySQL
    New versions of MySQL use cmake.

    % cmake . -DCMAKE_INSTALL_PREFIX=@mysql_prefix@ -DENABLED_LOCAL_INFILE=1
    % make -s DESTDIR=staging_directory
    % sudo make install-strip DESTDIR=staging_directory
    cd ..

    You can read the transition guide at

    http://forge.mysql.com/wiki/Autotools_to_CMake_Transition_Guide

    ##### STEP 2  ##### Install libdkim-1.4 ###################
    Install libdkim-1.4 (libdkim-1.4.tar.bz2) MD5 3871d9e0c211bea2aaefbcb96971682e
    current working directory /home/local/src
    Download the libdkim package. The latest tested libdkim package is
    libdkim-1.4.tar.bz2

    % gunzip -c libdkim-1.4.tar.gz | tar xf -
    % cd libdkim-1.4
    % ./configure --prefix=@prefix@ --mandir=@mandir@ \
        --libdir=@libdir@
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..

    NOTE: UPGRADE Information. You can always upgrade to the latest version of libdkim
    by doing ./configure <same_parameters_as_earlier_install> ; make ; make install-strip

    ##### STEP 3  ##### Install libsrs2-1.0.18 ################
    Install libsrs2-1.0.18 (libsrs2-1.0.18.tar.gz MD5 5a70a83818781551a7bfba31ffc97f8b
    current working directory /home/local/src
    Download the libsrs2 package. The latest tested libsrs2 package is
    libsrs2-1.0.18.tar.gz

    % gunzip -c libsrs2-1.0.18.tar.gz | tar xf -
    % cd libsrs2-1.0.18
    % ./configure --prefix=@prefix@ --mandir=@mandir@ \
        --libdir=@libdir@
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..

    ##### STEP 4  ##### MOST IMPORTANT STEP ###################
    Install IndiMail. This step involves extracting both indimail-@version@.tar.gz and
    qmail-1.03.tar.gz. It is important that the extracted qmail source directory (qmail-1.03)
    is present for ./configure to detect qmail. You can also extract optional
    packages (flash, altermime, ripmime, mpack, fortune, nssd, pam-multi, logalert, fetchmail).
    The configure script will detect these packages if present in /home/local/src

    This step also involves applying a patch to qmail-1.03. This patch adds many features
    missing in stock qmail/netqmail installations.

    current working directory /home/local/src
    Download the indimail package from http://www.indimail.org

    % gunzip -c indimail-@version@.tar.gz | tar xf -

    Download qmail-1.03 MD5 622f65f982e380dbe86e6574f3abcb7c. The latest tested qmail
    package is qmail-1.03.tar.gz

    % wget http://cr.yp.to/software/qmail-1.03.tar.gz
    % gunzip -c qmail-1.03.tar.gz | tar xf -
    % gunzip -c indimail-@version@/Patches-2.0/qmail-1.03.patch.gz | patch -p0

    change first line in qmail-1.03/conf-qmail to @indimaildir@
    change first line in qmail-1.03/conf-shared to @shareddir@
    change first line in qmail-1.03/conf-prefix to @prefix@
    change first line in qmail-1.03/conf-libexec to @libexecdir@
    change first line in qmail-1.03/conf-sysconfdir to @sysconfdir@

    % cd indimail-@version@
    % ./configure \
        --prefix=@prefix@ \
        --libexecdir=@libexecdir@ \
        --sysconfdir=@sysconfdir@ \
        --with-pkgconfigdir=@pkgconfigdir@ \
        --datarootdir=@shareddir@ \
        --mandir=@prefix@/share/man \
        --enable-shareddir=@shareddir@ \
        --enable-servicedir=@servicedir@ \
        --enable-domaindir=@indimaildir@
        --enable-qmaildir=@indimaildir@ \
        --enable-modbase=@prefix@/lib/indimail \
        --enable-moduledir=@moduledir@
        --enable-logdir=@logdir@ \
        --enable-basepath=@basepath@ \
        --enable-indiuser=indimail \
        --enable-indigroup=indimail \
        --enable-default-domain=@defaultdomain@ \
        --enable-log-name=indimail \
        --enable-mysqlprefix=@mysql_prefix@ \
        --enable-roaming-users=y \
        --enable-relay-clear-minutes=30 \
        --enable-tcprules-prog=@prefix@/bin/tcprules \
        --enable-tcpserver-file=@sysconfdir@/tcp.smtp \
        --enable-logging=e \
        --enable-mysql-logging=y \
        --enable-auth-logging=y \
        --enable-hardquota=5242880 \
        --enable-maildir-quota=y \
        --enable-large-site=n \
        --enable-user-cluster=y \
        --enable-qmail-ext=y \
        --enable-ip-alias-domains=y \
        --enable-valias=y \
        --enable-vfilter=y \
        --enable-file-locking=c \
        --enable-file-sync=n \
        --enable-make-seekable=y \
        --enable-passwd=y \
        --enable-domain-limits=y \
        --enable-query-cache=y \
        --enable-random-balancing=y \
        --enable-password-hash=md5 \
        --enable-mysql-escape=y \
        --enable-md5-crypt=n \
        --enable-sha256-crypt=n \
        --enable-sha512-crypt=n \
        --enable-ipv6=y \
        --enable-offensive=n

    NOTES: To get a complete list of configure options type: ./configure --help
    If you change --enable-indiuser or --enable-indigroup to something different from
    indimail:indimail, change conf-users or conf-groups in qmail-1.03 subdirectory

    % make -s [DESTDIR=staging_directory]

    Run the following command to create all default users

    % sudo sh ./svctool --config=users --nolog
    Once you have created all users required by IndiMail you can
    continue the make below

    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..

    You can omit DESTDIR=staging_directory if you do not have a running indimail system.
    Staged installation is required if you have a running indimail system. Staged installation
    installs indimail in a staging area. You will have to manually copy the staging area to the
    production directories, after shutting down indimail

    The above 'sudo make -s install-strip' installs indimail.
    'sudo make -s install-strip' also shuts down indimail (if running). You may want to start
    indimail at the end of the installation by running the command

    % sudo @prefix@/bin/initsvc -on (see SECTION 5. Start your services below)

    BUT DO NOT START THE SERVICES NOW (unless you are upgrading IndiMail)

    NOTE: UPGRADE Information. You can always upgrade to the latest version of qmail by
    applying the latest patch qmail-1.03.patch.gz available in the indimail source patch
    subdirectory to the orignal qmail package.
    Then do ./configure <same_parameters_as_earlier_install> ; make ; make install-strip
    You can always upgrade to the latest version of IndiMail by doing extracting IndiMail and
    ./configure <same_parameters_as_earlier_install> ; make ; make install-strip

    ##### STEP 5  ##### UCSPI TCP #############################
    Install ucspi-tcp MD5 39b619147db54687c4a583a7a94c9163
    current working directory /home/local/src
    Download the ucspi-tcp package. The latest published ucspi-tcp package is ucspi-tcp-0.88.tar.gz.
    % wget http://cr.yp.to/ucspi-tcp/ucspi-tcp-0.88.tar.gz
    % gunzip -c ucspi-tcp-0.88.tar.gz | tar xf -
    % gunzip -c indimail-@version@/Patches-2.0/ucspi-tcp-0.88.patch.gz | patch -p0

    ensure that mysql_config is in the path. This is needed by ucspi-tcp to detect
    MySQL libraries.

    change first line in conf-home to @prefix@
    change first line in conf-shared to @shareddir@

    % cd ucspi-tcp-0.88
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install [DESTDIR=staging_directory]
    % cd ..

    NOTE: UPGRADE Information. You can always upgrade to the latest version of ucpsi
    by applying the latest patch available in the indimail source patch subdirectory
    to the orignal ucspi-tcp package.
    Then do ./configure <same_parameters_as_earlier_install> ; make ; make install-strip

    ##### STEP 6  ##### Courier IMAP/POP3 #####################
    Install courier-imap (courier-imap-4.17.2.tar.bz2) MD5 345d76780408bd511f97e8fcfed491a6
    current working directory /home/local/src
    Download the courier-imap package. The latest tested courier-imap package is
    courier-imap-4.17.2.tar.bz2. The patch brings up the version upto courier-imap to be
    compatible with IndiMail.

    % bzip2 -d -c courier-imap-4.17.2.tar.bz2 | tar xf -
    % gunzip -c indimail-@version@/Patch-1.0/courier-imap-4.17.2.patch.gz | patch -p0
    % cd courier-imap-4.17.2

   x-------------------------------- Mac OS X ONLY -----------------------------------------x
   |% bzip2 -d -c courier-imap-3.0.8.tar.bz2 | tar xf -                                     |
   |If you are on Mac OS X 10.5.x you will need to apply courier-imap-3.0.8-1.2.patch and   |
   |a supplement patch                                                                      |
   |% gunzip -c indimail-@version@/Patch-1.0/courier-imap-3.0.8-1.2.patch.gz | patch -p0      |
   |% gunzip -c indimail-@version@/Patch-1.0/courier-imap-3.0.8-1.2.mac-supplement.patch.gz \ |
   | | patch -p0                                                                            |
   |% cd courier-imap-3.0.8                                                                 |
   x----------------------------------------------------------------------------------------x

    % ./configure --prefix=@prefix@ --disable-root-check --bindir=@prefix@/bin \
        --with-redhat \
        --mandir=@mandir@ \
        --libdir=@libdir@ \
        --sysconfdir=@sysconfdir@ \
        --with-certsdir=@sysconfdir@/control \
        --libexecdir=@libexecdir@ \
        --datarootdir=@shareddir@ \
        --without-authchangepwdir \
        --without-authpam --without-authcustom \
        --without-authpwd --with-authshadow
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..
    
    NOTE: UPGRADE Information. You can always upgrade to the latest version of courier-imap
    by applying the latest patch available in the indimail source patch subdirectory
    to the orignal courier-imap package.
    Then do ./configure <same_parameters_as_earlier_install> ; make ; make install-strip
    Also, remember that IndiMail can work with any IMAP/POP3 server that provides authentication
    using PAM or getpwnam(3), getspnam(3). This happens transparently by using pam-multi(8) in
    conjunction with nssd(8)

    ##### STEP 7  ##### SPAM Filter ###########################
    Install Bogofilter (http://www.bogofilter.org) MD5 d0a5eebb3274b23ceabe766a6443a1c5 
    current working directory /home/local/src
    Download the bogofilter package. The latest tested bogofilter package is
    bogofilter-1.2.4.tar.bz2. 

    % wget http://downloads.sourceforge.net/bogofilter/bogofilter-1.2.4.tar.bz2
    % bzip2 -d -c bogofilter-1.2.4.tar.bz2 | tar xf -
    % gunzip -c indimail-@version@/Patch-1.0/bogofilter-1.2.4.patch.gz | patch -p0
    % cd bogofilter-1.2.4
    % autoreconf -fi
    % ./configure --prefix=@prefix@ --sysconfdir=@sysconfdir@ --enable-indimail \
         --libexecdir=@libexecdir@ \
         --mandir=@mandir@
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..
    NOTE: If you are installing bogofilter on Mac OS X, you may need to install
    Berkeley db (libdb)

    # Training Bogofilter ##### SPAM Filter #######################################
    OK, now onto the corpus description.  It's split into three parts, as follows:
    - spam: 500 spam messages, all received from non-spam-trap sources.
    - easy_ham: 2500 non-spam messages.  These are typically quite easy to
      differentiate from spam, since they frequently do not contain any spammish
      signatures (like HTML etc).
    - hard_ham: 250 non-spam messages which are closer in many respects to
      typical spam: use of HTML, unusual HTML markup, coloured text,
      "spammish-sounding" phrases etc.
    - easy_ham_2: 1400 non-spam messages.  A more recent addition to the set.
    - spam_2: 1397 spam messages.  Again, more recent.
    ###############################################################################

    % mkdir training
    % cd training
    Download spam ham corpus from http://spamassassin.apache.org/publiccorpus/
    % wget http://spamassassin.apache.org/publiccorpus/20030228_easy_ham_2.tar.bz2
    % wget http://spamassassin.apache.org/publiccorpus/20030228_easy_ham.tar.bz2
    % wget http://spamassassin.apache.org/publiccorpus/20030228_hard_ham.tar.bz2
    % wget http://spamassassin.apache.org/publiccorpus/20030228_spam.tar.bz2
    % wget http://spamassassin.apache.org/publiccorpus/20050311_spam_2.tar.bz2
    % for i in *.bz2; do bzip2 -d -c $i | tar xf -; done
    % @prefix@/bin/bogofilter -d @sysconfdir@ -B -s spam
    % @prefix@/bin/bogofilter -d @sysconfdir@ -B -s spam_2
    % @prefix@/bin/bogofilter -d @sysconfdir@ -B -n easy_ham
    % @prefix@/bin/bogofilter -d @sysconfdir@ -B -n easy_ham_2
    % @prefix@/bin/bogofilter -d @sysconfdir@ -B -n hard_ham
    % sudo chown indimail:indimail @sysconfdir@/wordlist.db
    % cd ..

    NOTE: A copy of wordlist.db is present in indimail-@version@/data.
    So you can skip all the above and just execute the two commands below i.e.
    % sudo cp indimail-@version@/data/worldlist.db @sysconfdir@
    % sudo chown indimail:indimail @sysconfdir@/wordlist.db

    NOTE: UPGRADE Information. You can always upgrade to the latest version of bogofilter
    by applying the latest patch available in the indimail source patch subdirectory
    to the orignal latest available bogofilter package.
    Then do ./configure <same_parameters_as_earlier_install> ; make ; make install-strip

    ##### STEP 8  ## Optional STEP ##### Fetchmail ############
    Install fetchmail MD5 61b66faad044afa26e142bb1791aa2b3  
    current working directory /home/local/src
    Download the fetchmail package. The latest tested fetchmail package tested is
    fetchmail-6.3.26.tar.bz2.

    % wget http://downloads.sourceforge.net/fetchmail/fetchmail-6.3.26.tar.bz2
    % xz -d -c fetchmail-6.3.26.tar.bz2 | tar xf -
    % gunzip -c indimail-@version@/Patch-1.0/fetchmail-6.3.26.patch.gz | patch -p0
    % cd fetchmail-6.3.26
    % autoreconf -fi
    % ./configure --prefix=@prefix@ --enable-indimail \
        --sysconfdir=@sysconfdir@ \
        --enable-binprefix=@prefix@ \
        --datarootdir=@shareddir@ \
        --libexecdir=@libexecdir@ \
        --libdir=@libdir@ \
        --mandir=@mandir@ \
        --with-ssl
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..

    NOTE: UPGRADE Information. You can always upgrade to the latest version of fetchmail
    by applying the latest patch available in the indimail source patch subdirectory
    to the orignal latest available fetchmail package.
    Then do ./configure <same_parameters_as_earlier_install> ; make ; make install-strip

    ##### STEP 9 ## Optional STEP ## nssd ####################
    Install nssd MD5 cbb373d0cd43c96aa12dd76608a3af09
    current working directory /home/local/src
    Download the nssd package from http://www.indimail.org

    % wget http://downloads.sourceforge.net/indimail/nssd-1.1.tar.gz
    % gunzip -c nssd-1.1.tar.gz | tar xf -
    % cd nssd-1.1
    % ./configure --prefix=@prefix@ --sysconfdir=@sysconfdir@ \
        --mandir=@mandir@ --libexecdir=@libexecdir@ \
        --enable-mysqlprefix=@mysql_prefix@ \
        --libdir=@libdir@ \ # /usr/lib or /usr/lib64 on a 32/64bit system
        --enable-default-domain=indimail.org
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..

    NOTE: UPGRADE Information. You can always upgrade to the latest version of fetchmail
    by downloading the latest nssd package
    Then do ./configure <same_parameters_as_earlier_install> ; make ; make install-strip

    ##### STEP 10 ## Optional STEP ## iwebadmin ###############
    Install iwebadmin MD5 c4a98f4907825969d5f69f7c73b7a0f5
    % wget http://downloads.sourceforge.net/indimail/iwebadmin-1.2.tar.gz
    % gunzip -c iwebadmin-1.2.tar.gz | tar xf -
    % cd iwebadmin-1.2
    % ./configure --prefix=/usr \
        --sysconfdir=@sysconfdir@ \
        --enable-ezmlmdir=@indimaildir@ \
        --disable-ipauth --disable-trivial-password \
        --enable-modify-quota \
        --enable-mysqlprefix=@mysql_prefix@ \
        --enable-htmldir=/var/www/html \
        --enable-cgibindir=/var/www/cgi-bin \
        --enable-imagedir=/var/www/html/images/iwebadmin \
        --enable-htmllibdir=@shareddir@/iwebadmin
    % make -s [DESTDIR=staging_directory]
    % sudo make -s install-strip [DESTDIR=staging_directory]
    % cd ..

    NOTE: UPGRADE Information. You can always upgrade to the latest version of iwebadmin
    by downloading the latest iwebadmin package
    Then do ./configure <same_parameters_as_earlier_install> ; make ; make install-strip

########### SECTION 4  ### Configuration and SETUP ######################
4. run svctool

    The steps in SECTION 3 above would have installed indimail, qmail, courier-imap, bogofilter
    (optionally fetchmail, nssd, iwebadmin)

    The steps below will help you to install a fresh MySQL database, configure MySQL and have a
    service installed under supervise which will start MySQL along with all other IndiMail services.

    The commands below will create configuration and service for running mysql. The command also
    creates a default MySQL database for IndiMail in @indimaildir@/mysqldb/data and MySQl
    logs to go in @indimaildir@/mysqldb/logs.

    ##### STEP 1  ## MySQL Configuration and Database Creation ##################
    a) Create MySQL configuration (@sysconfdir@/indimail.cnf)
    % sudo @prefix@/sbin/svctool --config=mysql --mysqlPrefix=@mysql_prefix@ \
     --mysqlport=3306 --mysqlsocket=/tmp/mysql.sock
    You can have a section [indimail] in @sysconfdir@/indimail.cnf for parameters specific
    to indimail

    b) Create a new MySQL database
    % sudo @prefix@/sbin/svctool --config=mysqldb --mysqlPrefix=@mysql_prefix@ \
        --databasedir=@indimaildir@/mysqldb --default-domain=indimail.org \
        --base_path=@basepath@

    ##### STEP 2  ## MySQL Startup ############################
    If you plan to use an existing MySQL server, read INSTALL-MYSQL in indimail-@version@/doc
    directory and proceed to STEP 3 after that. The instructions below are for MySQL to be
    managed by supervise and hence will require you to disable MySQL startup in your OS
    startup/boot scripts.

    Remove mysqld startup in boot scripts
    % sudo chkconfig mysqld off
    % sudo /etc/init.d/mysqld stop

    Some operating systems also use `/etc/rc.local' or `/etc/init.d/boot.local' to start additional
    services on startup. You must remove any invocation of mysqld_safe from these scripts.

    Create service in supervise to start mysqld
    % sudo @prefix@/sbin/svctool --mysql=3306 --servicedir=@servicedir@ \
        --mysqlPrefix=@mysql_prefix@ --databasedir=@indimaildir@/mysqldb \
        --config=@sysconfdir@/indimail.cnf --default-domain=indimail.org

    ##### STEP 3  ## Default Control Files ##################
    The command below creates all necessary configuration for running a domain 'indimail.org' on
    your host. You may want to replace indimail.org with your domain

    % sudo @prefix@/sbin/svctool --config=qmail --postmaster=postmaster@indimail.org \
        --default-domain=indimail.org

    ##### STEP 4  ## SMTP Service ##################
    Stop sendmail and remove from the startup.
    % sudo chkconfig sendmail off
    % sudo /etc/init.d/sendmail stop
    if you don't have clamav installed, don't give the --qhpsi command below

    The commands below will create service for the MTA (both smtp and delivery process). The
    number of queues can be adjusted by you. The commands below create 5 queues.
    % sudo @prefix@/sbin/svctool --smtp=25 --servicedir=@servicedir@ \
        --query-cache --password-cache \
        --qbase=@indimaildir@/queue --qcount=5 --qstart=1 \
        --cntrldir=control --localip=0 --maxdaemons=150 --maxperip=25 --persistdb \
        --starttls --fsync --syncdir --memory=104857600 --chkrecipient --chkrelay --masquerade \
        --min-free=52428800 --content-filter --virus-filter \
        --qhpsi="/usr/bin/clamdscan %s --fdpass --quiet --no-summary" \
        --spamfilter="@prefix@/bin/bogofilter -p -d @sysconfdir@" \
        --logfilter=/tmp/spamfifo --rejectspam=0 --spamexitcode=0 --localfilter --remotefilter \
        --remote-authsmtp=plain --dmasquerade \
        --dkverify=both --dksign=both --private_key=@sysconfdir@/control/domainkeys/indimail \
        --rbl=-rzen.spamhaus.org --rbl=-rdnsbl-1.uceprotect.net

    The command below will create the public and private key for domainkey, dkim signatures

    % sudo @prefix@/bin/dknewkey @sysconfdir@/control/domainkeys/indimail 1024

    If you want to have a message submission port (587) for users to submit outgoing mails
    you can create the Message Submission Port. Note the additional --skipsend option which
    creates a service without delivery process. Mails will be processed by delivery process
    created above for port 25. The message submission port will enforce authenticated SMTP and
    hence you do not require rblsmtpd to frontend the SMTP service.

    % sudo @prefix@/sbin/svctool --smtp=587 --servicedir=@servicedir@ \
        --qbase=@indimaildir@/queue --qcount=5 --qstart=1 --authsmtp --antispoof \
        --query-cache --password-cache \
        --cntrldir=control --localip=0 --maxdaemons=150 --maxperip=25 --persistdb \
        --starttls --fsync --syncdir --memory=104857600 --chkrecipient --chkrelay --masquerade \
        --min-free=52428800 --content-filter --virus-filter \
        --qhpsi="/usr/bin/clamdscan %s --fdpass --quiet --no-summary" \
        --dmasquerade --skipsend \
        --dkverify=both --dksign=both --private_key=@sysconfdir@/control/domainkeys/indimail

    NOTE: You can create a deliver process for port 587 too either by having a different --qbase
    or have a qstart > 5. The point to remember is you can have multiple delivery process as long
    as you do not share a queue between delivery processes.

    If you are going to use the local mail, sendmail, qmail-inject command, they need to figure
    out the queue location. This is done by having a directory called 'defaultqueue' in
    @sysconfdir@/control. Run the following command to create this

    % sudo @prefix@/sbin/svctool --queueParam=defaultqueue \
        --qbase=@indimaildir@/queue --qcount=5 --qstart=1 \
        --min-free=52428800 --fsync --syncdir --virus-filter \
        --qhpsi="/usr/bin/clamdscan %s --fdpass --quiet --no-summary" \
        --dkverify="both" --dksign=both \
        --private_key=@sysconfdir@/control/domainkeys/indimail

    You can implement QMTP service if you want a faster distribution of mails from your
    relay servers. Remember you will also need to create the file
    @sysconfdir@/control/qmtproutes

    % sudo @prefix@/sbin/svctool --qmtp=209 --servicedir=@servicedir@ \
        --qbase=@indimaildir@/queue --qcount=5 --qstart=1 --cntrldir=control --localip=0 \
        --maxdaemons=75 --maxperip=25 --fsync --syncdir --memory=104857600 --min-free=52428800

    If you want a centralized mail queue, you can implement QMQP service. Like QMTP, QMQP
    is much faster than SMTP.
    % sudo @prefix@/sbin/svctool --qmqp=628 --servicedir=@servicedir@ \
        --qbase=@indimaildir@/queue --qcount=5 --qstart=1 --cntrldir=control --localip=0 \
        --maxdaemons=75 --maxperip=25 --fsync --syncdir --memory=104857600 --min-free=52428800

    The above will create a QMQP service for a centralized queue. On servers which do not have
    its own queue, you need to create @sysconfdir@/control/qmqpservers containing the IP address
    of the server which has the QMQP service running.

    You can implement Greylisting as described at
    http://www.gossamer-threads.com/lists/qmail/users/136740?page=last
    by executing the command

    % sudo @prefix@/sbin/svctool --greylist=1999 --servicedir=@servicedir@ --min-resend-min=2 \
        --resend-win-hr=24 --timeout-days=30 --context-file=greylist.context \
        --hash-size=65536 --save-interval=5 --whitelist=greylist.white --use-greydaemon

    If you decide to use greylisting, have the following in tcp.smtp

    :allow,GREYIP=":" in the file @sysconfdir@/tcp.smtp

    ##### STEP 5  ## IMAP/POP3 Service ##################
    The commands below will create listeners for IMAP and POP3 service.

    % sudo @prefix@/sbin/svctool --imap=143 --servicedir=@servicedir@ --localip=0 \
        --query-cache --maxdaemons=150 --maxperip=25 \
        --default-domain=indimail.org --memory=52428800 --starttls
    % sudo @prefix@/sbin/svctool --imap=993 --servicedir=@servicedir@ --localip=0 \
        --query-cache --maxdaemons=150 --maxperip=25 \
        --default-domain=indimail.org --memory=52428800 \
        --postmaster=postmaster@indimail.org --ssl
    % sudo @prefix@/sbin/svctool --pop3=110 --servicedir=@servicedir@ --localip=0 \
        --query-cache --maxdaemons=150 --maxperip=25 \
        --default-domain=indimail.org --memory=52428800 --starttls
    % sudo @prefix@/sbin/svctool --pop3=995 --servicedir=@servicedir@ --localip=0 \
        --maxdaemons=150 --maxperip=25 \
        --default-domain=indimail.org --memory=52428800 \
        --postmaster=postmaster@indimail.org --ssl

    The below four command will create proxies (ssl and non-ssl) for IMAP and POP3. These
    will be required if you decide to split your users belonging to a single domain across
    multiple hosts.

    % sudo @prefix@/sbin/svctool --imap=4143 --servicedir=@servicedir@ --localip=0 \
        --query-cache --maxdaemons=150 --maxperip=25 --starttls \
        --tlsprog=@prefix@/bin/sslerator \
        --default-domain=indimail.org --memory=52428800 --proxy=143
    % sudo @prefix@/sbin/svctool --imap=4990 --servicedir=@servicedir@ --localip=0 \
        --query-cache --maxdaemons=150 --maxperip=25 \
        --default-domain=indimail.org --memory=52428800 --proxy=143 \
        --postmaster=postmaster@indimail.org --ssl
    % sudo @prefix@/sbin/svctool --pop3=4110 --servicedir=@servicedir@ --localip=0 \
        --query-cache --maxdaemons=150 --maxperip=25 --starttls \
        --tlsprog=@prefix@/bin/sslerator \
        --default-domain=indimail.org --memory=52428800 --proxy=110
    % sudo @prefix@/sbin/svctool --pop3=4995 --servicedir=@servicedir@ --localip=0 \
        --query-cache --maxdaemons=150 --maxperip=25 \
        --default-domain=indimail.org --memory=52428800 --proxy=110 \
        --postmaster=postmaster@indimail.org --ssl

    If you have used the --ssl option above, you can quickly generate a self-signed X.509 key for
    IMAP/POP3 over SSL by running the following command. This command should be run
    after editing the files @sysconfdir@/imapd.cnf, @sysconfdir@/pop3d.cnf

    the command additionally creates a self-signed X.509 certificate for SMTP over SSL. i.e.

    % sudo @prefix@/sbin/svctool --config=cert --postmaster=youremail@yourdomain

    ##### STEP 6  ## Query Pooling/Caching/Lookup Service ##################
    The command below creates InLookup service with 5 threads. This provides qmail-smtpd, IMAP
    and POP3 services to do high speed user lookups and password authentication.

    % sudo @prefix@/sbin/svctool --inlookup=infifo --servicedir=@servicedir@ \
        --cntrldir=@sysconfdir@/control --threads=5 \
        --password-cache --query-cache

    ##### STEP 7  ## SPAM/VIRUS Filtering Service ##################
    Install clamav (see instructions for your OS)
    # check your clamav installation for your OS distribution. e.g

    # fedora
    % sudo yum install clamav-data clamav-server clamav-filesystem clamav-lib clamav-update clamav

    Edit /usr/lib/tmpfiles.d/clamd.scan.conf with the following line
    d /var/run/clamd.scan 0750 qscand qmail

    # for Ubuntu
    % sudo apt-get install clamav clamav-daemon
    % sudo update-rc.d -f clamav-daemon disable
    % sudo update-rc.d -f clamav-daemon remove

    # CentOS 6
    % sudo rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
    % sudo yum install clamav clamd
    % sudo chkconfig clamd off

    # CentOS 7
    % sudo yum -y install epel-release
    % sudo yum -y update
    % sudo yum -y install clamav-server clamav-data clamav-update clamav-filesystem clamav clamav-scanner-systemd \
       clamav-lib clamav-server-systemd

    The commands below will create services for virus scanning and spam filter.

    % sudo @prefix@/sbin/svctool --qscanq --servicedir=@servicedir@ --clamdPrefix=/usr \
        --scanint=200
    % sudo @prefix@/sbin/svctool --config=clamd
    % sudo @prefix@/sbin/svctool --config=bogofilter

    ##### STEP 8  ## Password Lookup Service ##################
    The command below creates Password Lookup Service using Name Service Switch (NSS). It extends
    functions like getpwnam(), getspnam(), etc to look at indimail MySQL tables.

    % sudo @prefix@/sbin/svctool --pwdlookup=/tmp/nssd.sock --threads=5 --timeout=-1 \
        --mysqlhost=localhost --mysqluser=indimail --mysqlpass=ssh-1.5- \
        --mysqlsocket=/tmp/mysql.sock --servicedir=@servicedir@

    ##### STEP 9  ## svscan log Service ##################
    The command below creates a multilog process for logging output of svscan

    % sudo @prefix@/sbin/svctool --svscanlog --servicedir=@servicedir@

   ###### STEP 10 ### Network Access for SMTP/IMAP/POP3 ####################
   Check your @sysconfdir@/tcp.smtp file, @sysconfdir@/tcp.imap file,
   @sysconfdir@/tcp.pop3 file 

    This file should list all the static IP's of your machines
    you want to allow to relay out to the internet.
    
    For example: If you have a whole C class named 192.9.200.X
    either edit @sysconfdir@/tcp.smtp file, or use the following to appened:

    % su
    # echo "192.9.200.:allow,RELAYCLIENT=\"\"" >> @sysconfdir@/tcp.smtp
    # echo ":allow,GREYIP=\":\""               >> @sysconfdir@/tcp.smtp
    # echo "192.9.200.:allow"                  >> @sysconfdir@/tcp.qmtp
    # echo "192.9.200.:allow"                  >> @sysconfdir@/tcp.qmqp
    # echo "192.9.200.:allow,IMAPCLIENT=\"\""  >> @sysconfdir@/tcp.imap
    # echo "192.9.200.:allow,POP3CLIENT=\"\""  >> @sysconfdir@/tcp.pop3
    # echo "192.9.200.:allow"                  >> @sysconfdir@/tcp.poppass
    # exit

    % sudo @prefix@/bin/tcprules @sysconfdir@/tcp.smtp.cdb \
        @sysconfdir@/tcp.smtp.tmp < @sysconfdir@/tcp.smtp
    % sudo @prefix@/bin/tcprules @sysconfdir@/tcp.qmtp.cdb \
        @sysconfdir@/tcp.qmtp.tmp < @sysconfdir@/tcp.qmtp
    % sudo @prefix@/bin/tcprules @sysconfdir@/tcp.qmqp.cdb \
        @sysconfdir@/tcp.qmqp.tmp < @sysconfdir@/tcp.qmqp
    % sudo @prefix@/bin/tcprules @sysconfdir@/tcp.imap.cdb \
        @sysconfdir@/tcp.imap.tmp < @sysconfdir@/tcp.imap
    % sudo @prefix@/bin/tcprules @sysconfdir@/tcp.pop3.cdb \
        @sysconfdir@/tcp.pop3.tmp < @sysconfdir@/tcp.pop3
    % sudo @prefix@/bin/tcprules @sysconfdir@/tcp.poppass.cdb \
        @sysconfdir@/tcp.pop3.tmp < @sysconfdir@/tcp.poppass

    you can add other ip's later, when ever you want.

    ##### STEP 11  ## Optional Services ##################
    Optional Commands
    -----------------
    The command below is required if you need to use ODMR (On Demand Mail Relay Protocol)

    % sudo @prefix@/sbin/svctool --smtp=366 --odmr --servicedir=@servicedir@

    The command below is required in case you need to fetch mails from another host which has
    intermittent connectivty. You require fetchmail if you need to pull emails from a host using
    IMAP, POP3 or ODMR protocol. After creating fetchmail service, create a file 'down' in
    the service directory to prevent fetchmail from getting started automatically. Remove
    the down file when you have configured fetchmailrc file. You can use fetchmailconf
    to generate fetchmailrc file.

    % sudo @prefix@/sbin/svctool --fetchmail --servicedir=@servicedir@ \
        --query-cache --password-cache \
        --qbase=@indimaildir@/queue --qcount=5 --qstart=1 \
        --cntrldir=control --default-domain=indimail.org \
        --qhpsi="/usr/bin/clamdscan %s --fdpass --quiet --no-summary" \
        --spamfilter="@prefix@/bin/bogofilter -p -d @sysconfdir@" --spamexitcode=0 \
        --memory=72428800 --fsync --syncdir \
        --dkverify=both
    % sudo /bin/touch @servicedir@/fetchmail/down

    The command below creates a service for indisrvr which allows you to execute from remote
    IndiMail admin commands

    % sudo @prefix@/sbin/svctool --indisrvr=4000 --servicedir=@servicedir@ \
        --localip=0 --maxdaemons=150 --maxperip=25 --avguserquota=2097152 \
        --certfile=@sysconfdir@/control/servercert.pem --ssl \
        --hardquota=52428800 --base_path=@basepath@

    The command below creates a service for indimail to support poppassd protocol which
    allows you to change passwords over the network.

    % sudo @prefix@/sbin/svctool --poppass=106 --localip=0 --maxdaemons=40 --maxperip-25 \
        --memory=52428800 \
        --certfile=@sysconfdir@/control/servercert.pem --ssl \
        --setpassword=@prefix@/sbin/vsetpass --servicedir=@servicedir@


########### SECTION 5  ### Start Services ###############################
5. Start your services
   IndiMail puts shared libs in @libdir@. You need to put
   @libdir@ in /etc/ld.so.conf.d/indimail.conf

   % su
   # echo @libdir@ > /etc/ld.so.conf.d/indimail-`arch`.conf
   # echo @mysql_libdir@ >> /etc/ld.so.conf.d/indimail-`arch`.conf
   # /sbin/ldconfig
   # exit

   Run the following command to install indimail in startup scripts and have
   sendmail removed. The command below will also install indimail as an
   alternative MTA in case your system has /usr/sbin/alternatives. Additionally
   sendmail will be disabled.

   % sudo /usr/sbin/svctool --config=add-boot

   The above command will install svscanboot (in inittab, /etc/init or /etc/event.d). It
   will also set IndiMail as an alternative MTA and replace /usr/sbin/sendmail or
   /usr/lib/sendmail as link to @prefix@/bin/sendmail

   To make sure that sendmail is disabled on your system

   % sudo chkconfig --list sendmail

   In case sendmail is not disabled
   % sudo chkconfig sendmail off

   Shutdown down sendmail
   % sudo /etc/init.d/sendmail stop

   Make sure that sendmail is linked to @prefix@/bin/sendmail. If not, then do the
   following

   % ln -s @prefix@/bin/sendmail /usr/sbin/sendmail

   On some systems sendmail could be in /usr/lib instead of /usr/sbin

   % ln -s @prefix@/bin/sendmail /usr/lib/sendmail

   FINALLY! To start all services

   % sudo @prefix@/sbin/initsvc -on

   Instead of the above initsvc command, you can also do (a more portable way)

   % sudo service indimail start


########### SECTION 6  ### Verfiy INSTALLATION ##########################
6. Check your installation

   % sudo @prefix@/sbin/svctool --check-install --servicedir=@servicedir@ \
       --qbase=@indimaildir@/queue --qcount=5 --qstart=1

   NOTE: All the above svctool commands, in all previous steps, are in the script
   create_services. You can run this script from IndiMail's source directory to
   create all services with reasonable defaults.

   sudo sh ./create_services --qbase=@indimaildir@/queue --mbase=@basepath@ \
     --mysqlPrefix=@mysql_prefix@

   On Mac OS X you may run

   sudo sh ./create_services --qbase=@indimaildir@/queue --mbase=@basepath@ \
     --mysqlPrefix=@mysql_prefix@ --no-nssd

########### SECTION 7  ### Crontab Entries ##############################
7. Setup crontab for indimail
    Add lines to roots crontab (you may want to edit the file cronlist)

    % su -
    # crontab -u root @sysconfdir@/cronlist
    # exit
    CAUTION: Do not use sudo from a non-privileged user else it will
    overwrite your root user's crontab file

    The following procedure configures MRTG for IndiMail
    % sudo mkdir /var/www/html/mailmrtg
    % sudo cp @sysconfdir@/indimail.mrtg.cfg /var/www/html/mailmrtg
    % sudo indexmaker --title="IndiMail Statistics" --section=title \
        --output=/var/www/html/mailmrtg/index.html \
        @sysconfdir@/indimail.mrtg.cfg


You can go on to add a virtual domain and users if you wish

########### SECTION 8  ### VIRTUAL DOMAIN ADMIN #########################
8. Operations on Virtual Domains
   IndiMail supports two types of virtual domains

   1. Non-Clustered domain - A domain existing on a single server
   2. Clustered domain - A domain extended across multiple servers, with each
      server having its own set of users.
   
   You must decide if you want Non-clustered setup or a clustered setup. If you have millions
   of users, then you must chose clustered setup. Even if you chose to install a non-clustered
   setup, you can always migrate to a clustered setup later.

    ##### STEP 1  #############################################
    Creating a non-clustered Domain
    -------------------------------
    Create configuration for IndiMail to connect to MySQL

    First you need to have all local information stored in MySQL

    % cd @sysconfdir@/control
    % su
    # echo "localhost:indimail:ssh-1.5-:/var/run/mysqld/mysqld.sock" > host.mysql
      or
    # echo localhost > host.mysql

    Ensure MySQL is running

    % sudo @prefix@/bin/svc -u @servicedir@/mysql.3306
    % sudo @prefix@/bin/svstat @servicedir@/mysql.3306
    @servicedir@/mysql.3306: up (pid 11936) 5 seconds

    NOTE: replace localhost, indimail, ssh-1.5-, /tmp/mysql.sock as relevant to your MySQL
    installation. You can use 3306 instead of /tmp/mysql.sock in case your MySQL
    database is on another host.
    you must use host:user:password:socket or host:user:password:port format
    for host.mysql (for IndiMail 1.6.9 and above). Also set your PATH to 
    have @prefix@/bin in the path.

    Creating a Clustered Domain
    ---------------------------
    If you need to setup a cluster of mailstores having the same domain, you need to
    have a common MySQL server to store cluster information for all mailstores.
    After you have setup a MySQL server, you need do the following

    % cd @sysconfdir@/control
    % su
    # echo "mysql_server_ip:indimail:ssh-1.5-:/tmp/mysql.sock" > host.cntrl
       or
    # echo mysql_server_ip > host.cntrl
    # ln -s host.cntrl host.master
    # echo 192.168.1.100 > localiphost (replace 192.168.1.100 with your mailserver/mailstore IP)
    # exit

    Ensure MySQL is running

    % sudo @prefix@/bin/svc -u @servicedir@/mysql.3306
    % sudo @prefix@/bin/svstat @servicedir@/mysql.3306
    @servicedir@/mysql.3306: up (pid 11936) 5 seconds

    NOTE: replace localhost, indimail, ssh-1.5-, /tmp/mysql.sock as relevant to your MySQL
    installation. You can use 3306 instead of /tmp/mysql.sock in case your MySQL
    database is on another host.

    you must use host:user:password:socket or host:user:password:port format
    for host.cntrl (for IndiMail 1.6.9 and above). Also set your PATH to 
    have @prefix@/bin in the path.

    mysql_server_ip ideally should point to a dedicated MySQL server.
    host.cntrl needs to be same for all mailstores. Also you can have host.master
    pointing to another MySQL server. host.master, host.cntrl implements
    MySQL Master / Slave architecture. However, you need to configure master slave
    replication in MySQL.

    ##### STEP 2  #############################################
    Add a virtual domain

    For this example, we will add a domain "indimail.org"

    For a non-clustered domain you would execute the following command

    % su indimail
    % @prefix@/bin/vadddomain indimail.org
        or
    % @prefix@/bin/vadddomain indimail.org password-for-postmaster

    For a clustered domain you would execute the following command

    % su indimail
    % @prefix@/bin/vadddomain -D indimail -S localhost \
        -U indimail -P ssh-1.5- -p 3306 -c indimail.org password-for-postmaster
        or
    % @prefix@/bin/vadddomain -D indimail -S localhost \
        -U indimail -P ssh-1.5- -p 3306 -c indimail.org password-for-postmaster

    vadddomain will modify the following qmail files 
    (default locations used)
    @sysconfdir@/control/locals
    @sysconfdir@/control/rcpthosts
    @sysconfdir@/control/morercpthosts (if rcpthosts > than 50 lines)
    @sysconfdir@/control/virtualdomains
    @sysconfdir@/users/assign
    @sysconfdir@/users/cdb

    It will also create a domains directory 
        ~indimail/domains/indimail.org
        ~indimail/domains/indimail.org/postmaster/Maildir ...

    If you do not specify a password on the command line, it
    will prompt for a password for the postmaster.

    Then it will send a kill -HUP signal to qmail-send telling it
    to re-read the control files.

    Note: setting up DNS MX records for the virtual domain is not
    covered in this INSTALL file.

    ##### STEP 3  #############################################
    Add a new user.

    You can use vadduser to add users.

    % su indimail
    % @prefix@/bin/vadduser newuser@indimail.org
        or
    % @prefix@/bin/vadduser newuser@indimail.org <password-for-newuser>

    ##### STEP 4  #############################################
    Delete a user

    % su indimail
    % @prefix@/bin/vdeluser newuser@indimail.org (for the indimail.org virtualdomain example)

    ##### STEP 5  #############################################
    Delete a virtual domain

    % su indimail
    % @prefix@/bin/vdeldomain indimail.org

    ##### STEP 6  #############################################
    Changing a users password

    % su indimail
    % @prefix@/bin/vpasswd user@indimail.org
            or
    % @prefix@/bin/vpasswd user@indimail.org <password-for-user@indimail.org>

########### SECTION 9 ### RTFM #########################################
9.  Man pages
    A lot of the underlying indimail details are not covered in this
    file. This is on purpose. If you want to find out the internal
    workings of indimail and qmail look into all files in @shareddir@/doc
    and @mandir@/man?

    As a first step, do

    % man indimail

########### SECTION 10 #### SUPPORT INFORMATION #########################
10. Good luck
    Send / Receive Mails
    ====================

    At this stage, your setup is ready to send mails to the outside world. To receive
    mails, you need to create your actual domain (instead of example.com) using vadddomain
    and setup a mail exchanger record for your domain (MX record).
    To send mails, you can either use SMTP or use sendmail (which is actually
    @prefix@/bin/sendmail).

    you can do the following to send a test mail.

    % ( echo 'First M. Last'; uname -a) | mail -s "IndiMail Installation" manvendra@indimail.org

    Replace First M. Last with your name.

    If you have questions about indimail, join the indimail mailing list; You can also use the
    tracker to track all your requests.

    IndiMail has an IRC channel ##indimail and ##indimail-mta

    There are four Mailing Lists for IndiMail

     1. indimail-support  - You can subscribe for Support at https://lists.sourceforge.net/lists/listinfo/indimail-support
                            You can mail indimail-support@lists.sourceforge.net for support
     2. indimail-devel    - You can subscribe at https://lists.sourceforge.net/lists/listinfo/indimail-devel
                            You can mail indimail-devel@lists.sourceforge.net for development activities
     3. indimail-announce - This is only meant for announcement of New Releases or patches. You
                            can subscribe at http://groups.google.com/group/indimail
     4. Archive at Google - http://groups.google.com/group/indimail
                            This groups acts as a remote archive for indimail-support and indimail-devel.

     A Project Tracker is at (Bugs, Feature Requests, Patches, Support Requests)
     http://sourceforge.net/tracker/?group_id=230686

You can also get titbits about IndiMail at

Tips&Tricks - http://indimail.blogspot.com         (WEB)
            - http://feeds.feedburner.com/indimail (RSS)
twitter     - http://twitter.com/indimail
facebook    - http://www.facebook.com/pages/indimail/88063516703?_fb_noscript=1
              (You can become a facebook fan of IndiMail at the above link)
sourceforge - https://sourceforge.net/apps/laconica/indimail/

IndiMail has two YUM / RPM / Deb repositories for most of the Linux Distros at
http://download.opensuse.org/repositories/home:/indimail/
&
http://download.opensuse.org/repositories/home:/mbhangui/

The corresponding install instructions for the two repositories are
https://software.opensuse.org/download.html?project=home%3Aindimail&package=indimail
&
https://software.opensuse.org/download.html?project=home%3Ambhangui&package=indimail

---------- * -------------- * ------------ * -------------- * ------------ * -------------- * ------------
CentOS/Fedora/openSUSE/RedHat NOTES

Install the following for making a build (source build or rpm build)
openssl-devel gcc gcc-c++ bison readline-devel ncurses-devel gettext-devel python-devel
flex autoconf libidn-devel sharutils openldap-devel chrpath pam-devel mysql-devel automake libtool
groff libdb4-devel expect
         
Ubuntu NOTES

You may need to install the following additional packages before you can start the compilation
of most of the packages

% sudo apt-get install libssl-dev
% sudo apt-get install gettext
% sudo apt-get install libncurses5-dev
% sudo apt-get install libpam0g-dev
% sudo apt-get install libreadline-dev
% sudo apt-get install libdb4.8-dev (or libdb-dev)
% sudo apt-get install libldap2-dev
% sudo apt-get install libmysqlclient-dev
% sudo apt-get install libgsl0-dev
% sudo apt-get install byacc
% sudo apt-get install automake autopoint libtool debhelper

# for qmailmrtg you will additionally require
% sudo apt-get install mrtg
% sudo apt-get install apache2

# for fetchmail you will additionally require
% sudo apt-get install flex bison

# for courier-imap you could require
% sudo apt-get install libidn11 libidn11-dev

# To remove MySQL from startup
# update-rc.d -f mysql remove

# To enable indimail at startup
# update-rc.d indimail start 2345 stop 016

openSUSE Notes
==============
# install the following packages
mysql-community-server
libmysqlclient-devel
pam-devel
ncurses-devel readline-devel 
gdbm-devel libdb-4_8-devel 
gcc
gcc-c++
make
bison  
byacc
flex
update-alternatives
libmysqlclient18
libncurses6
libreadline6
lsb-release
openssl
readline-devel
gettext-runtime-mini
autoconf
automake
libtool
gettext-tools-mini
libdb-4_8-devel
libidn-devel
libldap
openldap2-devel
libopenssl-devel
pam
pam-modules
python-devel
sharutils
chrpath

---------- * -------------- * ------------ * -------------- * ------------ * -------------- * ------------
OS X NOTES

Post Install
============

In order to get IndiMail to start automatically when OS X boots, you will need to create a new
startup item containing the IndiMail startup script and paramters list. Create a new startup
directory for IndiMail using the following command:

Mac OS X 10.5.x or later
% sudo cp @shareddir@/boot/indimail.plist /System/Library/LaunchDaemons

NOTE: You can also add @prefix@/sbin/svscanboot to /etc/rc.local

prior to Mac OS X 10.5.x (NOTE: I have not compiled/tested IndiMail on Mac OS X prior to 10.5.x)
% cd ..
% sudo mkdir /Library/StartupItems/IndiMail
% sudo cp @prefix@/bin/qmailctl /Library/StartupItems/IndiMail/IndiMail
% sudo cp @shareddir@/boot/StartupParameters.plist /Library/StartupItems/IndiMail

When you reboot your machine IndiMail will automatically start.

In order to have a Maildir created automatically when a new user is added to the system you will
need to modify the new user template. The new user template can be found in the
/System/Library/User Template/English.lproj directory.

The following four commands will walk you through the Maildir creation process:

% cd /System/Library/User\ Template/English.lproj
% su
# @prefix@/bin/maildirmake Maildir
# echo ./Maildir/ > .qmail
# /Developer/Tools/SetFile -a V Maildir

The last command, SetFile -a V Maildir, will set a special bit in the Maildir meta-file such that
the directory is hidden in the Finder (only works on HFS filesystems). This handy command can
be used for any file/directory that you might want to hide. Originally found on the O'Reilly site
macdevcenter.com -- tip #5 from the article Top Ten Mac OS X Tips for Unix Geeks.

Remember to create a Maildir for each existing user account. You will have to use the SetFile
command on each Maildir individually (if you want to hide them in the Finder). After you create
a Maildir for an existing user, remember to make the user the owner of the of the directory
(using chown).
---------------------------------------------
If you see the new users in the login-window, you might want to use one of the following commands
(depending on which one works for you) to hide them:

% sudo defaults write /Library/Preferences/com.apple.loginwindow HiddenUsersList \
   -array-add indimail alias qmaild qmaill qmailp qmailq qmailr qmails qscand \
   mysql

If the above doesn't work, try this one:

% sudo defaults write /Library/Preferences/com.apple.loginwindow Hide500User -bool YES

(source:http://qmail.jms1.net/djbdns/osx.shtml)
---------- * -------------- * ------------ * -------------- * ------------ * -------------- * ------------

MySQL NOTES
-----------
CREATE USER user [IDENTIFIED BY [PASSWORD] 'password']
    [, user [IDENTIFIED BY [PASSWORD] 'password']] ...
GRANT
    priv_type [(column_list)]
      [, priv_type [(column_list)]] ...
    ON [object_type]
        {
            *
          | *.*
          | db_name.*
          | db_name.tbl_name
          | tbl_name
          | db_name.routine_name
        }
    TO user [IDENTIFIED BY [PASSWORD] 'password']
        [, user [IDENTIFIED BY [PASSWORD] 'password']] ...
    [REQUIRE
        NONE |
        [{SSL| X509}]
        [CIPHER 'cipher' [AND]]
        [ISSUER 'issuer' [AND]]
        [SUBJECT 'subject']]
    [WITH with_option [with_option] ...]

object_type =
    TABLE
  | FUNCTION
  | PROCEDURE

with_option =
    GRANT OPTION
  | MAX_QUERIES_PER_HOUR count
  | MAX_UPDATES_PER_HOUR count
  | MAX_CONNECTIONS_PER_HOUR count
  | MAX_USER_CONNECTIONS count
---------- * -------------- * ------------ * -------------- * ------------ * -------------- * ------------
PS Output
=========
% ps waux
user       pid %cpu %mem    vsz   rss tty      stat start   time command
smmsp     2506  0.0  0.0   9180  1512 ?        Ss   14:21   0:00 sendmail: Queue runner@01:00:00 for /var/spool/clientmqueue
root     31328  0.0  0.0   2944  1024 ?        Ss   15:24   0:00 /bin/sh @prefix@/sbin/svscanboot @servicedir@ @servicedir@1
root     31330  0.0  0.0   1908   388 ?        S    15:24   0:00 @prefix@/sbin/svscan @servicedir@
root     31331  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
qmaill   31332  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/svscan
root     31333  0.0  0.0   1728   268 ?        S    15:24   0:00 @prefix@/sbin/readproctitle @servicedir@ errors: ................................................................................................................................................................................................................................................................................................................................................................................................................
root     31334  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise qmail-imapd-ssl.993
indimail 31335  0.0  0.0   5928  1188 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/qmail-imapd-ssl.993/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.imap.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 993 @prefix@/bin/couriertls -server -tcpd @prefix@/sbin/imaplogin @libexecdir@/imapmodules/authindi @libexecdir@/imapmodules/authpam @prefix@/bin/imapd Maildir
root     31337  0.0  0.0   1744   316 ?        S    15:24   0:00 supervise log
qmaill   31338  0.0  0.0   1756   312 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/imapd-ssl.993
root     31339  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise qmail-pop3d-ssl.995
indimail 31341  0.0  0.0   5928  1184 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/qmail-pop3d-ssl.995/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.pop3.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 995 @prefix@/bin/couriertls -server -tcpd @prefix@/sbin/pop3login @libexecdir@/imapmodules/authindi @libexecdir@/imapmodules/authpam @prefix@/bin/pop3d Maildir
root     31343  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
qmaill   31345  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/pop3d-ssl.995
root     31347  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise pwdlookup
indimail 31348  0.0  0.0  44344  1288 ?        Sl   15:24   0:00 @prefix@/sbin/nssd -d debug
root     31354  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
root     31355  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise indisrvr.4000
root     31356  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
qmaill   31357  0.0  0.0   1756   320 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/pwdlookup
indimail 31358  0.0  0.0   6360  1320 ?        S    15:24   0:00 @prefix@/sbin/indisrvr -i 0 -p 4000 -b 40
qmaill   31360  0.0  0.0   1756   320 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/indisrvr.4000
root     31361  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise qscanq
root     31363  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
qmaill   31364  0.0  0.0   1756   304 ?        S    15:24   0:00 @prefix@/bin/multilog t -* cleanq starting -* deleting: *: not sticky@logdir@/qscanq
root     31366  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise qmail-imapd.143
indimail 31367  0.0  0.0   5928  1204 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/qmail-imapd.143/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.imap.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 143 @prefix@/sbin/imaplogin @libexecdir@/imapmodules/authindi @libexecdir@/imapmodules/authpam @prefix@/bin/imapd Maildir
root     31368  0.0  0.0   1744   316 ?        S    15:24   0:00 supervise log
qmaill   31369  0.0  0.0   1756   320 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/imapd.143
root     31370  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise qmail-pop3d.110
indimail 31371  0.0  0.0   5928  1196 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/qmail-pop3d.110/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.pop3.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 110 @prefix@/sbin/pop3login @libexecdir@/imapmodules/authindi @libexecdir@/imapmodules/authpam @prefix@/bin/pop3d Maildir
root     31372  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
qmaill   31373  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/pop3d.110
root     31374  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise fetchmail
indimail 31375  0.0  0.1   6392  2828 ?        S    15:24   0:03 @prefix@/bin/fetchmail --nodetach -f @sysconfdir@/fetchmailrc
root     31376  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
qmaill   31377  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/fetchmail
root     31379  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise proxy-imapd-ssl.9143
indimail 31380  0.0  0.0   5928  1196 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/proxy-imapd-ssl.9143/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.imap.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 9143 @prefix@/bin/couriertls -server -tcpd @prefix@/bin/proxyimap @prefix@/bin/imapd Maildir
root     31383  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
qmaill   31384  0.0  0.0   1756   328 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/proxyIMAP.9143
root     31387  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise proxy-imapd.4143
indimail 31388  0.0  0.0   5928  1188 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/proxy-imapd.4143/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.imap.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 4143 @prefix@/bin/proxyimap @prefix@/bin/imapd Maildir
root     31393  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
qmaill   31395  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/proxyIMAP.4143
root     31396  0.0  0.0   1744   328 ?        S    15:24   0:00 supervise proxy-pop3d-ssl.9110
indimail 31397  0.0  0.0   5928  1316 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/proxy-pop3d-ssl.9110/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.pop3.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 9110 @prefix@/bin/couriertls -server -tcpd @prefix@/bin/proxypop3 @prefix@/bin/pop3d Maildir
root     31400  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
qmaill   31401  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/proxyPOP3.9110
root     31404  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise freshclam
qscand   31405  0.0  0.0   3500  1332 ?        S    15:24   0:00 @prefix@/bin/freshclam -v --stdout --datadir=@indimaildir@/clamd -f -d -c 2
root     31406  0.0  0.0   1744   316 ?        S    15:24   0:00 supervise log
qmaill   31407  0.0  0.0   1756   320 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/freshclam
root     31408  0.0  0.0   1744   316 ?        S    15:24   0:00 supervise qmail-smtpd.366
indimail 31409  0.0  0.0   5928  1188 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -H -R -l 0 -x @sysconfdir@/tcp.smtp.cdb -c @servicedir@/qmail-smtpd.366/variables/MAXDAEMONS -o -b 150 -u 555 -g 555 0 366 @prefix@/bin/qmail-smtpd indimail.org @prefix@/sbin/vchkpass @prefix@/sbin/systpass /bin/false
root     31414  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
qmaill   31415  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/smtpd.366
root     31418  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise proxy-pop3d.4110
indimail 31420  0.0  0.0   5928  1192 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -c @servicedir@/proxy-pop3d.4110/variables/MAXDAEMONS -C 25 -x @sysconfdir@/tcp.pop3.cdb -X -o -b 40 -H -l 0 -R -u 555 -g 555 0 4110 @prefix@/bin/proxypop3 @prefix@/bin/pop3d Maildir
root     31424  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
qmaill   31425  0.0  0.0   1756   320 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/proxyPOP3.4110
root     31426  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise qmail-send.25
root     31427  0.0  0.0   1748   308 ?        S    15:24   0:00 qmail-daemon ./Maildir/
root     31428  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise log
root     31429  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise qmail-smtpd.25
indimail 31430  0.0  0.0   5928  1184 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -H -R -l 0 -x @sysconfdir@/tcp.smtp.cdb -c @servicedir@/qmail-smtpd.25/variables/MAXDAEMONS -o -b 75 -u 555 -g 555 0 25 @prefix@/bin/qmail-smtpd indimail.org @prefix@/sbin/vchkpass @prefix@/sbin/systpass /bin/false
qmaill   31431  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/deliver.25
root     31435  0.0  0.0   1744   328 ?        S    15:24   0:00 supervise log
qmaill   31437  0.0  0.0   1756   324 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/smtpd.25
qmails   31438  0.0  0.0   1928   420 ?        S    15:24   0:00 qmail-send
root     31439  0.0  0.0   1744   324 ?        S    15:24   0:00 supervise clamd
root     31440  0.0  0.0   6456  1392 ?        S    15:24   0:00 qmail-lspawn ./Maildir/
qmailr   31441  0.0  0.0   6468  1396 ?        S    15:24   0:00 qmail-rspawn
qmailq   31442  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
qmails   31443  0.0  0.0   1900   388 ?        S    15:24   0:00 qmail-todo
qmails   31445  0.0  0.0   1928   416 ?        S    15:24   0:00 qmail-send
root     31446  0.0  0.0   6456  1392 ?        S    15:24   0:00 qmail-lspawn ./Maildir/
root     31447  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
qscand   31449  0.0  3.1  67996 65068 ?        S    15:24   0:01 @prefix@/sbin/clamd
qmailq   31450  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
qmails   31453  0.0  0.0   1928   428 ?        S    15:24   0:00 qmail-send
qmailr   31454  0.0  0.0   6468  1396 ?        S    15:24   0:00 qmail-rspawn
root     31455  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise qmail-spamlog
indimail 31456  0.0  0.0   1740   280 ?        S    15:24   0:00 @prefix@/bin/qmail-cat /tmp/spamfifo
qmaill   31457  0.0  0.0   1756   320 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/clamd
root     31458  0.0  0.0   6456  1428 ?        S    15:24   0:00 qmail-lspawn ./Maildir/
qmails   31461  0.0  0.0   1928   424 ?        S    15:24   0:00 qmail-send
qmailq   31462  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
root     31463  0.0  0.0   6456  1432 ?        S    15:24   0:00 qmail-lspawn ./Maildir/
root     31464  0.0  0.0   1744   316 ?        S    15:24   0:00 supervise log
qmaill   31465  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/spamlog
qmails   31467  0.0  0.0   1928   428 ?        S    15:24   0:00 qmail-send
qmailr   31468  0.0  0.0   6468  1528 ?        S    15:24   0:00 qmail-rspawn
root     31469  0.0  0.0   6456  1564 ?        S    15:24   0:00 qmail-lspawn ./Maildir/
qmailr   31470  0.0  0.0   6468  1404 ?        S    15:24   0:00 qmail-rspawn
qmailq   31471  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
qmails   31472  0.0  0.0   1900   404 ?        S    15:24   0:00 qmail-todo
qmails   31473  0.0  0.0   1900   396 ?        S    15:24   0:00 qmail-todo
qmailr   31474  0.0  0.0   6468  1400 ?        S    15:24   0:00 qmail-rspawn
qmailq   31475  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
qmailq   31476  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
root     31477  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise mysql.3306
root     31478  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
mysql    31479  0.0  0.3  36652  6364 ?        Sl   15:24   0:00 @mysql_prefix@/libexec/mysqld --defaults-file=@sysconfdir@/indimail.cnf --port=3306 --basedir=@mysql_prefix@ --datadir=@indimaildir@/mysqldb/data --myisam-recover=backup,force --memlock --skip-external-locking --delay-key-write=all --skip-safemalloc --sql-mode=NO_BACKSLASH_ESCAPES --log=@indimaildir@/mysqldb/logs/logquery --log-output=FILE --log-isam=@indimaildir@/mysqldb/logs/logisam --log-slow-queries=@indimaildir@/mysqldb/logs/logslow --log-queries-not-using-indexes --log-warnings=2 --pid-file=/tmp/mysql.3306.pid
qmaill   31480  0.0  0.0   1756   324 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/mysql.3306
qmails   31481  0.0  0.0   1900   404 ?        S    15:24   0:00 qmail-todo
qmails   31482  0.0  0.0   1928   420 ?        S    15:24   0:00 qmail-send
root     31483  0.0  0.0   6456  1528 ?        S    15:24   0:00 qmail-lspawn ./Maildir/
qmailq   31485  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
qmailq   31486  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
qmailq   31487  0.0  0.0   1872   372 ?        S    15:24   0:00 qmail-clean
root     31488  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise inlookup.infifo
indimail 31489  0.0  0.0   6356  1260 ?        S    15:24   0:00 @prefix@/sbin/inlookup -i 5
qmailr   31490  0.0  0.0   6468  1396 ?        S    15:24   0:00 qmail-rspawn
qmails   31491  0.0  0.0   1900   400 ?        S    15:24   0:00 qmail-todo
root     31492  0.0  0.0   1744   320 ?        S    15:24   0:00 supervise log
qmaill   31493  0.0  0.0   1756   316 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/inlookup.infifo
qmailq   31494  0.0  0.0   1872   372 ?        S    15:24   0:00 qmail-clean
indimail 31495  0.0  0.0   6572   860 ?        S    15:24   0:00 @prefix@/sbin/inlookup -i 5
indimail 31496  0.0  0.0   6572   860 ?        S    15:24   0:00 @prefix@/sbin/inlookup -i 5
qmailq   31497  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
indimail 31498  0.0  0.0   6572   860 ?        S    15:24   0:00 @prefix@/sbin/inlookup -i 5
indimail 31499  0.0  0.0   6572   860 ?        S    15:24   0:00 @prefix@/sbin/inlookup -i 5
indimail 31500  0.0  0.0   6572   860 ?        S    15:24   0:00 @prefix@/sbin/inlookup -i 5
qmails   31501  0.0  0.0   1900   392 ?        S    15:24   0:00 qmail-todo
qmailq   31502  0.0  0.0   1872   368 ?        S    15:24   0:00 qmail-clean
root      1056  0.0  0.0   1740   316 ?        S    15:24   0:00 supervise qmail-qmtpd.209
indimail  1078  0.0  0.0   6640  1108 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -H -R -l 0 -x @sysconfdir@/tcp.qmtp.cdb -c @servicedir@/qmail-qmtpd.209/variables/MAXDAEMONS -o -b 75 -u 555 -g 555 0 209 @prefix@/bin/qmail-qmtpd
qmaill    1089  0.0  0.0   1756   336 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/qmtpd.209
root      1058  0.0  0.0   1740   316 ?        S    15:24   0:00 supervise qmail-qmqpd.628
indimail  1102  0.0  0.0   6640   836 ?        S    15:24   0:00 @prefix@/bin/tcpserver -v -H -R -l 0 -x @sysconfdir@/tcp.qmqp.cdb -c @servicedir@/qmail-qmqpd.628/variables/MAXDAEMONS -o -b 75 -u 555 -g 555 0 628 @prefix@/bin/qmail-qmqpd
qmaill    1110  0.0  0.0   1756   288 ?        S    15:24   0:00 @prefix@/bin/multilog t @logdir@/qmqpd.628
---------- * -------------- * ------------ * -------------- * ------------ * -------------- * ------------
Basic Installation
==================

Briefly, the shell commands `./configure; make; make install' should
configure, build, and install this package.  The following
more-detailed instructions are generic; see the `INSTALL*' files for
instructions specific to this package.

   The `configure' shell script attempts to guess correct values for
various system-dependent variables used during compilation.  It uses
those values to create a `Makefile' in each directory of the package.
It may also create one or more `.h' files containing system-dependent
definitions.  Finally, it creates a shell script `config.status' that
you can run in the future to recreate the current configuration, and a
file `config.log' containing compiler output (useful mainly for
debugging `configure').

   It can also use an optional file (typically called `config.cache'
and enabled with `--cache-file=config.cache' or simply `-C') that saves
the results of its tests to speed up reconfiguring.  Caching is
disabled by default to prevent problems with accidental use of stale
cache files.

   If you need to do unusual things to compile the package, please try
to figure out how `configure' could check whether to do them, and mail
diffs or instructions to the address given in the `README.cdb' so they can
be considered for the next release.  If you are using the cache, and at
some point `config.cache' contains results you don't want to keep, you
may remove or edit it.

   The file `configure.ac' (or `configure.in') is used to create
`configure' by a program called `autoconf'.  You need `configure.ac' if
you want to change it or regenerate `configure' using a newer version
of `autoconf'.

The simplest way to compile this package is:

  1. `cd' to the directory containing the package's source code and type
     `./configure' to configure the package for your system.

     Running `configure' might take a while.  While running, it prints
     some messages telling which features it is checking for.

  2. Type `make' to compile the package.

  3. Optionally, type `make check' to run any self-tests that come with
     the package.

  4. Type `make install' to install the programs and any data files and
     documentation.

  5. You can remove the program binaries and object files from the
     source code directory by typing `make clean'.  To also remove the
     files that `configure' created (so you can compile the package for
     a different kind of computer), type `make distclean'.  There is
     also a `make maintainer-clean' target, but that is intended mainly
     for the package's developers.  If you use it, you may have to get
     all sorts of other programs in order to regenerate files that came
     with the distribution.

  6. Often, you can also type `make uninstall' to remove the installed
     files again.

Compilers and Options
=====================

Some systems require unusual options for compilation or linking that the
`configure' script does not know about.  Run `./configure --help' for
details on some of the pertinent environment variables.

   You can give `configure' initial values for configuration parameters
by setting variables in the command line or in the environment.  Here
is an example:

     ./configure CC=c99 CFLAGS=-g LIBS=-lposix

   *Note Defining Variables::, for more details.

Compiling For Multiple Architectures
====================================

You can compile the package for more than one kind of computer at the
same time, by placing the object files for each architecture in their
own directory.  To do this, you can use GNU `make'.  `cd' to the
directory where you want the object files and executables to go and run
the `configure' script.  `configure' automatically checks for the
source code in the directory that `configure' is in and in `..'.

   With a non-GNU `make', it is safer to compile the package for one
architecture at a time in the source code directory.  After you have
installed the package for one architecture, use `make distclean' before
reconfiguring for another architecture.

Installation Names
==================

By default, `make install' installs the package's commands under
`/usr/local/bin', include files under `/usr/local/include', etc.  You
can specify an installation prefix other than `/usr/local' by giving
`configure' the option `--prefix=PREFIX'.

   You can specify separate installation prefixes for
architecture-specific files and architecture-independent files.  If you
pass the option `--exec-prefix=PREFIX' to `configure', the package uses
PREFIX as the prefix for installing programs and libraries.
Documentation and other data files still use the regular prefix.

   In addition, if you use an unusual directory layout you can give
options like `--bindir=DIR' to specify different values for particular
kinds of files.  Run `configure --help' for a list of the directories
you can set and what kinds of files go in them.

   If the package supports it, you can cause programs to be installed
with an extra prefix or suffix on their names by giving `configure' the
option `--program-prefix=PREFIX' or `--program-suffix=SUFFIX'.

Optional Features
=================

Some packages pay attention to `--enable-FEATURE' options to
`configure', where FEATURE indicates an optional part of the package.
They may also pay attention to `--with-PACKAGE' options, where PACKAGE
is something like `gnu-as' or `x' (for the X Window System).  The
`README' should mention any `--enable-' and `--with-' options that the
package recognizes.

   For packages that use the X Window System, `configure' can usually
find the X include and library files automatically, but if it doesn't,
you can use the `configure' options `--x-includes=DIR' and
`--x-libraries=DIR' to specify their locations.

Specifying the System Type
==========================

There may be some features `configure' cannot figure out automatically,
but needs to determine by the type of machine the package will run on.
Usually, assuming the package is built to be run on the _same_
architectures, `configure' can figure that out, but if it prints a
message saying it cannot guess the machine type, give it the
`--build=TYPE' option.  TYPE can either be a short name for the system
type, such as `sun4', or a canonical name which has the form:

     CPU-COMPANY-SYSTEM

where SYSTEM can have one of these forms:

     OS KERNEL-OS

   See the file `config.sub' for the possible values of each field.  If
`config.sub' isn't included in this package, then this package doesn't
need to know the machine type.

   If you are _building_ compiler tools for cross-compiling, you should
use the option `--target=TYPE' to select the type of system they will
produce code for.

   If you want to _use_ a cross compiler, that generates code for a
platform different from the build platform, you should specify the
"host" platform (i.e., that on which the generated programs will
eventually be run) with `--host=TYPE'.

Sharing Defaults
================

If you want to set default values for `configure' scripts to share, you
can create a site shell script called `config.site' that gives default
values for variables like `CC', `cache_file', and `prefix'.
`configure' looks for `PREFIX/share/config.site' if it exists, then
`PREFIX/etc/config.site' if it exists.  Or, you can set the
`CONFIG_SITE' environment variable to the location of the site script.
A warning: not all `configure' scripts look for a site script.

Defining Variables
==================

Variables not defined in a site shell script can be set in the
environment passed to `configure'.  However, some packages may run
configure again during the build, and the customized values of these
variables may be lost.  In order to avoid this problem, you should set
them in the `configure' command line, using `VAR=value'.  For example:

     ./configure CC=/usr/local2/bin/gcc

causes the specified `gcc' to be used as the C compiler (unless it is
overridden in the site shell script).

Unfortunately, this technique does not work for `CONFIG_SHELL' due to
an Autoconf bug.  Until the bug is fixed you can use this workaround:

     CONFIG_SHELL=/bin/bash /bin/bash ./configure CONFIG_SHELL=/bin/bash

`configure' Invocation
======================

`configure' recognizes the following options to control how it operates.

`--help'
`-h'
     Print a summary of the options to `configure', and exit.

`--version'
`-V'
     Print the version of Autoconf used to generate the `configure'
     script, and exit.

`--cache-file=FILE'
     Enable the cache: use and save the results of the tests in FILE,
     traditionally `config.cache'.  FILE defaults to `/dev/null' to
     disable caching.

`--config-cache'
`-C'
     Alias for `--cache-file=config.cache'.

`--quiet'
`--silent'
`-q'
     Do not print messages saying which checks are being made.  To
     suppress all normal output, redirect it to `/dev/null' (any error
     messages will still be shown).

`--srcdir=DIR'
     Look for the package's source code in directory DIR.  Usually
     `configure' can determine that directory automatically.

`configure' also accepts some other, not widely useful, options.  Run
`configure --help' for more details.
---------- * -------------- * ------------ * -------------- * ------------ * -------------- * ------------
