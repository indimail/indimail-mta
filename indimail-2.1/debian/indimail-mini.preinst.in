#!/bin/sh
set -e
prefix=@prefix@
rm=/bin/rm

ID=`id -u`
if [ $ID -ne 0 ] ; then
	echo "You are not root" >&2
	exit 1
fi
#
# Create user/groups indimail. Do not report any problems if it already
# exists.
#

case "$1" in
    install|upgrade)
	${rm} -f /tmp/indimail-devel.install /tmp/indimail-devel.upgrade
	touch /tmp/indimail-devel.$1
	nscd_up=`ps -ef |grep nscd |grep -v grep|wc -l`
	if [ $nscd_up -ge 1 ] ; then
		if [ -x /etc/init.d/nscd ] ; then
			/etc/init.d/nscd stop
		fi
	fi
	echo "Adding IndiMail users/groups"
	/usr/bin/getent group indimail  > /dev/null || /usr/sbin/groupadd -r -g 555 indimail || true
	if [ $? = 4 ] ; then
		/usr/sbin/groupadd indimail
	fi
	/usr/bin/getent group nofiles   > /dev/null || /usr/sbin/groupadd nofiles  || true
	/usr/bin/getent group qmail     > /dev/null || /usr/sbin/groupadd qmail    || true

	${rm} -f /var/spool/mail/indimail

	/usr/bin/getent passwd indimail > /dev/null || /usr/sbin/useradd -r -g indimail -u 555 -d ${prefix} indimail || true
	if [ $? = 4 ] ; then
		/usr/sbin/useradd -r -g indimail -d ${prefix} indimail
	fi
	if [ $nscd_up -ge 1 ] ; then
		if [ -x /etc/init.d/nscd ] ; then
			/etc/init.d/nscd start
		fi
	fi
	;;

    abort-upgrade)
    ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
