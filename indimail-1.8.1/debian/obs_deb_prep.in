#!/bin/sh
set -e
#
# Unpacker for OpenSUSE build service
#
version=@version@

clamav_version=@clamav_version@
libdkim_version=@libdkim_version@
courier_version=@courier_version@
bogofilter_version=@bogofilter_version@
fetchmail_version=@fetchmail_version@
nssd_version=@nssd_version@
#
pam_multi_version=@pam_multi_version@
altermime_version=@altermime_version@
ripmime_version=@ripmime_version@
flash_version=@flash_version@
mpack_version=@mpack_version@
logalert_version=@logalert_version@
fortune_version=@fortune_version@

for i in indimail-"$version" qmail-1.03 ucspi-tcp-0.88 clamav-"$clamav_version" \
	libdkim-"$libdkim_version" courier-imap-"$courier_version" nssd-"$nssd_version" \
	pam-multi-"$pam_multi_version" altermime-"$altermime_version" \
	ripmime-"$ripmime_version" flash-"$flash_version" mpack-"$mpack_version" \
	logalert-"$logalert_version" fortune-"$fortune_version" \
	bogofilter-"$bogofilter_version" fetchmail-"$fetchmail_version"
do
	/bin/rm -rf $i
	if [ -f ../SOURCES/$i.tar.gz ] ; then
		echo "extracting $i.tar.gz"
		gunzip -c ../SOURCES/$i.tar.gz |tar xf -
	elif [ -f ../SOURCES/$i.tar.bz2 ] ; then
		echo "extracting $i.tar.bz2"
		bzip2 -d -c ../SOURCES/$i.tar.bz2|tar xf -
	else
		echo "no source archive for $i"
		exit 1
	fi
	if [ " $i" = " bogofilter-"$bogofilter_version"" -o " $i" = " fetchmail-"$fetchmail_version"" ] ; then
		continue
	fi
	if [ -f indimail-"$version"/patches/$i.patch.gz ] ; then
		echo "applying patch for $i"
		gunzip -c indimail-"$version"/patches/$i.patch.gz | patch -p0 > /dev/null
	elif [ -f indimail-"$version"/patches/$i.patch ] ; then
		echo "applying patch for $i"
		patch -p0 < indimail-"$version"/patches/$i.patch > /dev/null
	fi
done
# Local Stuff
if [ -f ../SOURCES/debian_qmail.patch ] ; then
	echo "applying debian_qmail.patch"
	patch -p0 < ../SOURCES/debian_qmail.patch
fi
exit 0
