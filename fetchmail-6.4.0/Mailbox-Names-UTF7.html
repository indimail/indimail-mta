<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>IMAP4r1 Mailbox Names vs. Unicode</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>IMAP4r1 Mailbox Names vs. Unicode</h1>
<span id="author">Matthias_Andree_(ed.)_and_Mark_Crispin</span><br />
<span id="email"><code>&lt;<a href="mailto:matthias.andree@gmx.de">matthias.andree@gmx.de</a>&gt;</code></span><br />
<span id="revnumber">version 1.001,</span>
<span id="revdate">2010-05-28</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<hr />
<div class="sidebarblock">
<div class="content">
<div class="title">Acknowledgment</div>
<div class="paragraph"><p>This article would not have been possible without the
substantial contributions from Mark Crispin.
&mdash; Matthias Andree, editor</p></div>
</div></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Abstract</div>
<div class="paragraph"><p>IMAP4rev1 is a widely used Internet Standards Track Protocol for remote
email access. Its adoption to international environments posed
interpretation problems as the construction and interpretation of
mailbox names, it particularly raised the question if there was
contractictory information within IMAP4rev1.</p></div>
<div class="paragraph"><p>This article describes the problem, and shows that IMAP4rev1 is
consistent with respect to mailbox names. We document how the evolution
of Unicode character sets and transformation formats made the
interpretation of the IMAP4rev1 standard difficult, and how it is to
interpret properly.</p></div>
<div class="paragraph"><p>Finally, we show that UTF-7, which is used in IMAP4rev1 to encode
mailbox names, does not impose artificial restrictions on the Unicode
character set.</p></div>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_imap_mailbox_names_in_rfc_3501">1. IMAP Mailbox Names in RFC-3501</h2>
<div class="sectionbody">
<div class="paragraph"><p>In May 2010, some confusion arose on the getmail mailing list around a bug
report to Debian that complained getmail4 wouldn&#8217;t allow non-ASCII characters
in an IMAP folder name <a href="http://bugs.debian.org/513116">Debian Bug#513116</a>, and
the interpretation of support of international mailbox names
vs. <a href="http://tools.ietf.org/html/rfc3501">RFC-3501</a>. It seemed at first
glance that IMAP4rev1 were limited to the Basic Multilingual Plane of
Unicode.</p></div>
<div class="sect2">
<h3 id="_problem_statement">1.1. Problem statement</h3>
<div class="paragraph"><p>Notably, RFC-3501 mandates that mailbox names are 7-bit, however clients are
supposed to accept 8-bit data and interpret it as UTF-8.  This is apparently
contradictory or extraneous, because 7-bit ASCII data need not be encoded.</p></div>
<div class="paragraph"><p>Let us look at the IMAP4rev1 standard:</p></div>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>5.1.    Mailbox Naming</p></div>
<div class="paragraph"><p>Mailbox names are 7-bit.  Client implementations MUST NOT attempt to
create 8-bit mailbox names, and SHOULD interpret any 8-bit mailbox names
returned by LIST or LSUB as UTF-8.  Server implementations SHOULD
prohibit the creation of 8-bit mailbox names, and SHOULD NOT return
8-bit mailbox names in LIST or LSUB.  See section 5.1.3 for more
information on how to represent non-ASCII mailbox names. [&#8230;]</p></div>
</div>
<div class="attribution">
<em>RFC3501</em><br />
&#8212; Mark Crispin
</div></div>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p>5.1.3.  Mailbox International Naming Convention</p></div>
<div class="paragraph"><p>By convention, international mailbox names in IMAP4rev1 are specified
using a modified version of the UTF-7 encoding described in [UTF-7].
Modified UTF-7 may also be usable in servers that implement an earlier
version of this protocol. [&#8230;]</p></div>
</div>
<div class="attribution">
<em>RFC3501</em><br />
&#8212; Mark Crispin
</div></div>
<div class="paragraph"><p>This appears to be contradictory, because UTF-7 is not UTF-8. However, a UTF-7
mailbox name is not an 8-bit mailbox name, hence the clause "interpret any
8-bit mailbox names &#8230; as UTF-8" does not apply. Mark writes:</p></div>
</div>
<div class="sect2">
<h3 id="_clarification">1.2. Clarification</h3>
<div class="paragraph"><p><em>by Mark Crispin</em></p></div>
<div class="paragraph"><p>8-bit octets are prohibited in mailbox names.  Clients MUST use 7-bit
names, and servers MUST reject CREATE commands that contain 8-bit
octets.</p></div>
<div class="paragraph"><p>However, clients MUST also interpret any 8-bit names in a list of
mailbox names (from LIST or LSUB) as UTF-8.</p></div>
<div class="paragraph"><p>To understand the history here, we must go back to the 1990s where
people (in spite of being told not to do so) were writing IMAP2 clients
and servers which used ISO-8859-1 and Shift-JIS mailbox names.  At that
time, it was by no means certain that UTF-8 would become the standard
Internet character set; I played an important role in making that
happen, but that was still a few years in the future.</p></div>
<div class="paragraph"><p>The adoption of UTF-8 offered a chance to exterminate non-UTF-8 8-bit
mailbox names, and in 1996 the current rules were adopted.  The
transition to IMAP4 (which required substantial changes to any IMAP2
servers) provided an opportunity to exterminate these non-interoperable
names once and for all.</p></div>
<div class="paragraph"><p>The modified UTF-7 was a temporary expedient to allow non-ASCII mailbox
names while remaining with the 7-bit framework.  Had punycode existed at
the time, it would have been a much better choice than UTF-7.  But
punycode did not exist for several years later with IDN.  In fact,
punycode was created because people learned the problems of UTF-7 from
IMAP.</p></div>
<div class="paragraph"><p>The intent was always to move to a UTF-8 only environment and leave
behind UTF-7.  When that happens, clients will start encountering UTF-8
names.  It is therefore necessary to tell clients that, even though they
are not permitted to send them, they need to be written to handle them
so they work properly when the restriction is relaxed in the future.</p></div>
</div>
<div class="sect2">
<h3 id="_recommendations">1.3. Recommendations</h3>
<div class="paragraph"><p><em>by Mark Crispin</em></p></div>
<div class="paragraph"><p><strong>Options for server implementors</strong></p></div>
<div class="paragraph"><p>From the perspective of a server implementor, you have one of two choices
of how to implement MUTF-7:
<span class="footnote"><br />[editor&#8217;s note: Modified UTF-7 as specified by the ensemble of RFC-2152 and RFC-3501]<br /></span></p></div>
<div class="hdlist"><table>
<tr>
<td class="hdlist1">
[S1]
<br />
</td>
<td class="hdlist2">
<p style="margin-top: 0;">
Ignore it; just forbid 8-bit octets in the CREATE command.
</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[S2]
<br />
</td>
<td class="hdlist2">
<p style="margin-top: 0;">
Convert mailbox names in commands from MUTF-7 to UTF-8.  When doing a
LIST or LSUB, convert mailbox names from UTF-8 to MUTF-7 before sending
them to the client.
</p>
</td>
</tr>
</table></div>
<div class="paragraph"><p>Servers of type [S1] were far more common in the 1990s.  [S2] is more
common today.  However, a client neither knows, nor cares, which type of
server it is because the rules make both servers interoperate the same.</p></div>
<div class="paragraph"><p><strong>Options for client implementors</strong></p></div>
<div class="hdlist"><table>
<tr>
<td class="hdlist1">
[C1]
<br />
</td>
<td class="hdlist2">
<p style="margin-top: 0;">
Ignore it; you&#8217;re an ASCII client.
</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[C2]
<br />
</td>
<td class="hdlist2">
<p style="margin-top: 0;">
Convert mailbox names from UTF-8 to MUTF-7 when sending a command.
When receiving a listing of mailboxes, convert MUTF-7 to UTF-8.
</p>
</td>
</tr>
</table></div>
<div class="paragraph"><p>This all works, and works well.  The routines to do the conversions are
quite straightforward.  The only thing that you can&#8217;t do well are mixed
wildcards with strings with non-ASCII names; and that is primarily a
curiousity since no clients do that with ASCII names.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unicode_ucs_2_utf_16_and_utf_7">2. Unicode, UCS-2, UTF-16, and UTF-7</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Warning" src="data:image/png;base64,
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" />
</td>
<td class="content">
<div class="title">Incomplete specification:</div>This section and its subsections are not normative references,
         and are insufficient to implement UCS-2, UTF-16 or UTF-7 based
         software.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="_ucs_2_and_utf_16">2.1. UCS-2 and UTF-16</h3>
<div class="paragraph"><p><em>by Mark Crispin</em></p></div>
<div class="paragraph"><p>RFC-3501 uses <a href="http://tools.ietf.org/html/rfc2152">RFC-2152</a> by reference.
Some of the confusion on the getmail list arose from the fact that
RFC-2152 talks about UCS-2 representation, which is limited to the Basic
Multilingual Plane (BMP) range U+0000 to U+FFFF.</p></div>
<div class="paragraph"><p>However, RFC-2152 also (page 5) refers to the handling of surrogate
pairs, which are defined in UTF-16 but not UCS-2.</p></div>
<div class="paragraph"><p>The correct interpretation is that the wording in RFC-2152 was written
at a time when "UCS-2" was interpreted as a synonym for "16-bit value"
as opposed to "BMP-only codepoints".  This happens frequently in older
standards.  Since UTF-7 is deprecated, nobody has done the work to
update RFC-2152 to clarify this point.</p></div>
<div class="paragraph"><p>Using surrogate pairs extends the capability of 16-bit words beyond the
BMP range.</p></div>
<div class="paragraph"><p>The 0x0000 to 0xFFFF range comprises so-called surrogates, two character
ranges (0xD800 to 0xDBFF and 0xDC00 to 0xDFFF) of 1024 characters (2<sup>10</sup>)
each. These ranges are technically removed from the BMP (thus there is
no such thing as U+D800); and hence the BMP only contains 64,512
possible codepoints.</p></div>
<div class="paragraph"><p>Both UTF-7 and UTF-16 transformation leverages these ranges to map
Unicode code points in the range from U+010000 to U+10FFFF (which is the
highest Unicode code point) to a pair of UCS-2 characters in the
surrogates ranges.</p></div>
<div class="paragraph"><p>This happens by first subtracting 0x10000, which maps the input into the
range 0x0 to 0xFFFFF, representable in 20 bits. The most significant
10-bit portion is mapped into the range 0xD800…0xDBFF, the least
significant 10-bit portion into the range 0xDC00…0xDFFF, and these two
16-bit values are used in this order.  UTF-7 does a further step of
encoding in modified BASE64.</p></div>
<div class="paragraph"><p>Thus, UTF-7 and UTF-16 both deal with &#8220;16-bit values&#8221; and use the same
surrogate pair mechanism to access non-BMP codepoints.  Although not
strictly accurate (the two are technically independent encodings of
Unicode), it may be helpful to think of UTF-7 as a further encoding of
UTF-16.</p></div>
</div>
<div class="sect2">
<h3 id="_utf_7">2.2. UTF-7</h3>
<div class="paragraph"><p>UTF-7 is a 7-bit representation of Unicode that makes use of character set
shifting. A character that is directly representable represents itself. Other
characters are subjected to a modified BASE64-encoding (that omits the padding
"=" characters at the end of a group) which is preceded by a "+" character
and trailed by a "-" character, which is discarded, or any other character
not in the modified BASE64 set, which remains in the stream.</p></div>
<div class="paragraph"><p>As a special case, the sequence "+-" is a shorthand to represent
the "+" character itself.</p></div>
<div class="paragraph"><p>The modified BASE64 character set uses the characters A-Z, a-z, digits 0-9,
and the characters "+" and "/", omitting "=" to avoid collisions with
RFC-2047 encoding.</p></div>
</div>
<div class="sect2">
<h3 id="_modified_utf_7">2.3. Modified UTF-7</h3>
<div class="paragraph"><p>This works similar to UTF-7, but mandates that printable ASCII characters
0x20&#8230;0x7E except 0x26 (the ampersand "&amp;") represent themselves, and uses yet
another BASE64 alphabet consisting of the upper- and lowercase letters, the
digits, and the characters "+" and ",", with some further rules specified in
RFC-3501. The leading shift character is replaced by the ampersand "&amp;",
the trailing remains "-", and the "&amp;" can be encoded as "&amp;-".</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusions">3. Conclusions</h2>
<div class="sectionbody">
<div class="paragraph"><p>IMAP Clients that want to support international mailbox names should send UTF-7,
and be prepared to handle UTF-7 (if no 8-bit data is found) and UTF-8 (if
8-bit data is found).</p></div>
<div class="paragraph"><p>Modified UTF-7 as per the IMAP RFC #3501 is not limited to the Unicode Basic
Multilingual Plane, but maps the entire Unicode range.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.001<br />
Last updated
 2015-12-04 01:51:55 CET
</div>
</div>
</body>
</html>
