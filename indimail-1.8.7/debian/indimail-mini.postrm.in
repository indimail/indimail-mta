#!/bin/sh
set -e
prefix=@indimaildir@
sysconfdir=/etc
rm=/bin/rm
mv=/bin/mv
rmdir=/bin/rmdir
####################################
ID=`id -u`
if [ $ID -ne 0 ] ; then
	echo "You are not root" >&2
	exit 1
fi

case "$1" in
    purge|remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
    ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

# we are doing upgrade or removal
if [ " $1" = " upgrade" ] ; then
	exit 0
fi

case "$1" in
    failed-upgrade|abort-install|abort-upgrade|disappear)
	exit 0
    ;;
esac
#
# Debian silliness
#
if [ " $1" = " remove" ] ; then
	${rm} -f ${prefix}/bin/qmail-queue ${prefix}/control/idhost || true
	for i in bin
	do
		${rm} -rf ${prefix}/$i || true
	done
	${rmdir} --ignore-fail-on-non-empty ${prefix}/bin 2>/dev/null || true
	${rmdir} --ignore-fail-on-non-empty ${prefix}/control 2>/dev/null || true
	${rmdir} --ignore-fail-on-non-empty ${prefix} 2>/dev/null || true
fi
if [ " $1" = " purge" ] ; then
	nscd_up=`ps -ef |grep nscd |grep -v grep|wc -l`
	if [ $nscd_up -ge 1 ] ; then
		if [ -x ${sysconfdir}/init.d/nscd ] ; then
			${sysconfdir}/init.d/nscd stop
		fi
	fi
	echo "purging configuration"
	echo "removing user indimail"
	/usr/bin/getent passwd indimail > /dev/null && /usr/sbin/userdel indimail >/dev/null || true
	echo "removing group indimail"
	/usr/bin/getent group indimail  > /dev/null && /usr/sbin/groupdel indimail >/dev/null || true
	if [ $nscd_up -ge 1 ] ; then
		if [ -x ${sysconfdir}/init.d/nscd ] ; then
			${sysconfdir}/init.d/nscd start
		fi
	fi
	for i in bin control
	do
		${rm} -rf ${prefix}/$i || true
	done
	${rmdir} --ignore-fail-on-non-empty ${prefix} 2>/dev/null || true
fi
exit 0
